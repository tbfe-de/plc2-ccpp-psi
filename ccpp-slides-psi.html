<!DOCTYPE html>
<head>
<meta charset="utf-8">
  <title></title>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
<style>
  html { background-color: black; }
  body { background-color: white; }
  /* A section is a slide. It's size is 800x600, and this will never change */
  section {
      font-family: Arial, serif;
      font-size: 20pt;
    }
  address, blockquote, dl, fieldset, form, h1, h2, h3, h4, h5, h6, hr, ol, p, pre, table, ul, dl { padding: 10px 20px 10px 20px; }
  h1, h2, h3 {
    text-align: center;
    margin: 10pt 10pt 20pt 10pt;
  }
  ul, ol {
    margin: 10px 10px 10px 50px;
  }
  section.titleslide h1 { margin-top: 200px; }
  h1.title { margin-top: 150px; }
  h1 { font-size: 180%; }
  h2 { font-size: 120%; }
  h3 { font-size: 100%; }
  blockquote { font-style: italic }
  q {
    display: inline-block;
    width: 700px;
    height: 600px;
    background-color: black;
    color: white;
    font-size: 60px;
    padding: 50px;
  }
  footer {
    position: absolute;
    bottom: 10px;
    right: 20px;
  }

  /* Transition effect */
  /* Feel free to change the transition effect for original
     animations. See here:
     https://developer.mozilla.org/en/CSS/CSS_transitions
     How to use CSS3 Transitions: */
  section {
      -moz-transition: left 400ms linear 0s;
      -webkit-transition: left 400ms linear 0s;
      -ms-transition: left 400ms linear 0s;
      transition: left 400ms linear 0s;
  }

  /* Before */
  section { left: -150%; }
  /* Now */
  section[aria-selected] { left: 0; }
  /* After */
  section[aria-selected] ~ section { left: +150%; }

  /* Incremental elements */

  /* By default, visible */
  .incremental > * { opacity: 1; }

  /* The current item */
  .incremental > *[aria-selected] { color: red; opacity: 1; }

  /* The items to-be-selected */
  .incremental > *[aria-selected] ~ * { opacity: 0.2; }
</style>
</head>
<body>
<section class="slide level1" id="section">
<h1 id="section"></h1>
<center>
<p>Professional Embedded C/C++ and Linux System Programming</p>
<p>An Inhouse-Training for <em>Paul Scherrer Institute (<a href="http://psi.ch" title="Paul Scherrer Institute">PSI</a>)</em></p>
<p>Brought to you by <em>Programmable Logic Competence Center (<a href="http://plc2.de" title="Programmable Logic Competence Center">PLC2</a>)</em></p>
<p>Instructor Dipl.-Ing. Martin Weitzel, <em>Techn. Beratung für EDV (<a href="http://tbfe.de" title="Technische Beratung für EDV">TBFE</a>)</em></p>
2014-05-05 to 2014-05-09, Villigen, CH
</center>





</section>
<section class="slide level1" id="part-1-c-and-c---starting-monday">
<h1 id="part-1-c-and-c---starting-monday">Part 1: C and C++ - Starting Monday</h1>
</section>
<section class="slide level1" id="section-1">
<h1 id="section-1"></h1>
<h2 id="welcome">Welcome</h2>
<h3 id="first-let-me-introduce-myself">First let me introduce myself</h3>
<ul class="incremental">
<li>My name is Martin Weitzel.</li>
<li>40 years ago I started studying Electrical Engineering ...</li>
<li>... switching over to Information Technology (Datentechnik) after three years.</li>
<li>I'm working as a freelancer since 1979.</li>
<li>Despite having turned to mainly software development soon in my carreer, I hope I still know some of the basics of electronic circuit design and digital logic.</li>
<li>Therefore I found sometimes to understand the needs of hardware developers better than most of my colleagues with a background in information technology only.</li>
</ul>
</section>
<section class="slide level1" id="section-2">
<h1 id="section-2"></h1>
<h3 id="fields-of-expertise">Fields of Expertise</h3>
<p>Though I have been exposed to much more in the past 35 years, these are the main areas where I feel competent today:</p>
<ul class="incremental">
<li>C/C++ -- mainly by using these languages in projects and teaching their portable use according to the ISO/ANSI standard;</li>
<li>Unix and Linux -- having started with a Unix-Clone named UniFLEX in the early 80s and seen much flavours of *ix before Linux took over;</li>
<li>Tcl/Tk -- a scripting language which is as a nice supplement to compiled languages and also an essential part of a number of Xilinx-tools;</li>
<li>But let's stop wasting time and start right away ...</li>
</ul>
</section>
<section class="slide level1" id="section-3">
<h1 id="section-3"></h1>
<h4 id="teaching-in-internet-times-...">Teaching in Internet Times ...</h4>
<ul>
<li>... all information is at your finger-tips.</li>
<li>So why bother to take a course (like this)?</li>
</ul>
<p>Seriously!</p>
<ul>
<li><p>What Do You expect?</p></li>
<li><p>(Shall I leave now, before we actually started?)</p></li>
</ul>
<p>NO (I hope :-)</p>
</section>
<section class="slide level1" id="section-4">
<h1 id="section-4"></h1>
<h4 id="an-analogy-used-by-p.j.-plauger">An Analogy Used by P.J. Plauger</h4>
<p>Let me draw a bit on a picture used many years ago by <a href="http://en.wikipedia.org/wiki/P._J._Plauger">P.J. Plauger</a> who compared learning and working with C++ with traveling a new, wild country.</p>
<ul class="incremental">
<li>For your first steps it is best to go guided by someone who is familiar with the terrain.</li>
<li>After this phase, stay close to the pathways that have been shown to you as being safe.</li>
<li>From there start to take small detours in those areas you need to know better.</li>
<li>The more you get confident there is no wild beast lurking in some particular dark spot, the more venturous you may go and further explore the (yet) unknwon wilderness.</li>
</ul>
</section>
<section class="slide level1" id="section-5">
<h1 id="section-5"></h1>
<h4 id="here-is-my-offer">Here Is My Offer</h4>
<p>(based on the difficulties I experience when autodidactically acquiring knowledge in fields new to me)</p>
<ul>
<li><p>I mainly show to you what <strong>may be</strong> worth while further exploring yourself.</p></li>
<li><p>Because: &quot;just looking and listening&quot; is OK for a while but doing things yourself is essential to really internalize what you want to learn.</p></li>
<li><p>You may very well explore terrain beside the routes shown to you ...</p></li>
<li><p>... in fact, I'd really welcome this if you try out everything that looks interresting.</p></li>
</ul>
</section>
<section class="slide level1" id="section-6">
<h1 id="section-6"></h1>
<h4 id="while-running-self-guided-...">While Running &quot;Self-Guided&quot; ...</h4>
<p>... I will come to help if:</p>
<ol>
<li><p>The route you are about to take is a dead-end one or one much too hard to follow to reach the destination you want to get at (what I know because I tried it myself in the past but never succeeded);</p></li>
<li><p>You feel you have hit some wall that is seemingly hard to break but I know (because I once was at this point too) that it's not of stone but of a soft material and it is worth while to continue your effort.</p></li>
</ol>
</section>
<section class="slide level1" id="section-7">
<h1 id="section-7"></h1>
<h4 id="what-i-personally-find-challenging">What I Personally Find Challenging</h4>
<ul class="incremental">
<li>Not knowing how - in detail - how we will spent the next five days</li>
</ul>
<ul class="incremental">
<li>Well, there's the agenda I prepared for us, but ...</li>
</ul>
<ul class="incremental">
<li>... you may well just take it as preliminary draft.</li>
</ul>
</section>
<section class="slide level1" id="section-8">
<h1 id="section-8"></h1>
<h4 id="in-detail-please-take-control-about-the-core-themes-yourself">In Detail, PLEASE Take Control About the Core Themes Yourself</h4>
<ul>
<li><p>What is, according to your expectations and requirements, sufficiently covered with an overview.</p></li>
<li><p>Where we should stay a bit longer and have a closer examination.</p></li>
<li><p>What might be added spontaneously because it turned out to be of special interest.</p></li>
</ul>
</section>
<section class="slide level1" id="section-9">
<h1 id="section-9"></h1>
<h4 id="dynamically-shaping-the-course-content-is-of-course-limited">Dynamically Shaping the Course Content is of Course Limited</h4>
<p>By:</p>
<ul>
<li>Topics added in passing should match really common interrest or at least correspond to the large majority's wish.</li>
<li>I'm willing to add topics even if they are close to the borders of my own experience ...</li>
<li>... but it makes no sense if I, myself, have to lean out of the window too far.</li>
</ul>
</section>
<section class="slide level1" id="section-10">
<h1 id="section-10"></h1>
<h4 id="as-a-final-note">As A Final Note</h4>
<p><strong>I don't like to teach facts if I can teach you how to find out!</strong></p>
<ul>
<li>Well: yes, some knowledge is simply factual ...</li>
<li>... but stop adding facts to your knowledge ...</li>
<li>... if you start to recognize a pattern.</li>
</ul>
<p>Rather explore and finally understand the pattern.</p>
<p><strong>At the basic foundation many things are dead simple</strong></p>
<ul>
<li>Try to understand the simple core modell first.</li>
<li>Then refine where necessary to get the details.</li>
</ul>
<p>Well, to get a first foot in between the door and its frame you have to over-simplify sometimes ... a little ...</p>
</section>
<section class="slide level1" id="section-11">
<h1 id="section-11"></h1>
<h2 id="a-tour-of-c">A Tour of C++</h2>
<p>This is the title of small book handed out in addition to the printed training documents.</p>
<p>Its author is <a href="http://www.stroustrup.com" title="Bjarne Stroustrup&#39;s Home Page">Bjarne Stroustrup</a> who originally designed C++ more than 30 years ago and since then until today is involved in improving the language and its standard library.</p>
<p>We will go through the relevant chapters of this book prior to covering the language features mainly by examples.</p>
<p>For brevity references to this book will be named <em>AToC</em> followed by the section number.</p>
</section>
<section class="slide level1" id="section-12">
<h1 id="section-12"></h1>
<h2 id="c-as-foundation-of-c">C as Foundation of C++</h2>
<p>Here is the quick outline of our first lesson:</p>
<ul>
<li>Main Function and Subroutines</li>
<li>Basic Types and Conversions</li>
<li>Operations for Basic Types</li>
<li>Arrays, Pointers and Adress Arithmetic</li>
<li>References vs. Pointers</li>
<li>Scope and Lifetime</li>
</ul>
</section>
<section class="slide level1" id="section-13">
<h1 id="section-13"></h1>
<h3 id="the-very-basics">The Very Basics</h3>
<p>Maybe you know most of this stuff.</p>
<ul>
<li>I will go through rather it quickly.</li>
<li>Please stop me if I'm moving too fast.</li>
</ul>
<p><strong>Feel free to interrupt me with your questions at any time!</strong></p>
<p>But be aware ...</p>
<ul class="incremental">
<li>If it gets annoying you will be sent out of the room ...</li>
</ul>
<ul class="incremental">
<li>... no, just kidding ...</li>
</ul>
<ul class="incremental">
<li>... of course you will be banned completely for the day or even for the rest of the week if you are nerving me with your questions ...</li>
</ul>
<ul class="incremental">
<li>(Oh no, no, NO! - let's go to the next page quickly.)</li>
</ul>
</section>
<section class="slide level1" id="section-14">
<h1 id="section-14"></h1>
<big>
<center>
<p>To put it absolutely clear:</p>
<p>Questions are welcome!</p>
Any time!!
</center>
</big>
</section>
<section class="slide level1" id="section-15">
<h1 id="section-15"></h1>
<h3 id="one---two---three">One - Two - Three</h3>
<ol>
<li><p>Let's firt see what THE GRAND MASTER HILMSELF has to say about his creation in <em>AToC §1, §2, and §3</em> (page 1 to 32).</p></li>
<li><p>Then settle on an idea what's at the core of any micro processor executing a C program based on an <a href="InfoGraphics/ExecutionModel.png">Info-Graphic</a> create by my humble self.</p></li>
<li><p>Finally review some examples that we - or later on you yourself - may want to compile to train your understanding of the topics covered.</p></li>
</ol>
</section>
<section class="slide level1" id="section-16">
<h1 id="section-16"></h1>
<h4 id="each-c-programm-needs-a-function-main">Each C Programm Needs a Function <code>main</code></h4>
<p>This is the minimal C Program:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> main() {
    <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre>
<p>For the complete example see: <a href="CCppCode/Introductory/empty.c">Introductory/empty.c</a></p>
</section>
<section class="slide level1" id="section-17">
<h1 id="section-17"></h1>
<p>In C++ <code>main</code> is special in so far that the <code>return</code> statement may be omitted:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> main() {
}</code></pre>
<p>For the complete example see: <a href="CCppCode/Introductory/empty.cpp">Introductory/empty.cpp</a>.</p>
</section>
<section class="slide level1" id="section-18">
<h1 id="section-18"></h1>
<h4 id="sub-routines">Sub-Routines</h4>
<p>Technically, <code>main</code> is a &quot;sub&quot;-routine called from the <em>run-time start-up module</em>, a small piece of code, partly written in assembly language, that prepares the execution environment for <code>main</code>.</p>
<p>You can roll your own sub-routines:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">void</span> say_hello() {
    printf(<span class="st">&quot;hello, anybody here?</span><span class="ch">\n</span><span class="st">&quot;</span>);
}</code></pre>
<p>To call it from <code>main</code>:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> main() {
    say_hello();
}</code></pre>
</section>
<section class="slide level1" id="section-19">
<h1 id="section-19"></h1>
<p>Some things to note so far:</p>
<ul>
<li>Sub-routines are defined with
<ul>
<li>a return type,</li>
<li>a name and</li>
<li>an argument list.</li>
</ul></li>
<li><p>The return type <code>void</code> says no value is returned.</p></li>
<li><p>The argument list has been empty in all examples so far.</p></li>
<li><p>Also empty argument lists need to be supplied with a call.</p></li>
</ul>
<p>For the complete example see: <a href="CCppCode/Introductory/say_hello.c">Introductory/say_hello.c</a></p>
</section>
<section class="slide level1" id="section-20">
<h1 id="section-20"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas">Something to try out later (if you have no other ideas)</h4>
<ul>
<li><p>Omit the pair of parentheses after <code>say_hello</code> when calling the function in the last example.</p></li>
<li><p>Compile the program - will you get an error message?</p></li>
<li><p>Run the program - will you see any output?</p></li>
<li><p>Explain!</p></li>
</ul>
</section>
<section class="slide level1" id="section-21">
<h1 id="section-21"></h1>
<h4 id="function-arguments">Function Arguments</h4>
<p>Frequently a subroutine is a bit more useful if it does not always the same - which is the reason why there are arguments:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">void</span> greet(<span class="dt">const</span> <span class="dt">char</span> message[]) {
    printf(<span class="st">&quot;%s</span><span class="ch">\n</span><span class="st">&quot;</span>, message);
}

<span class="dt">int</span> main() {
    greet(<span class="st">&quot;hello?&quot;</span>);
    printf(<span class="st">&quot;... hmm, anybody there ...</span><span class="ch">\n</span><span class="st">&quot;</span>);
    greet(<span class="st">&quot;bye, bye!&quot;</span>);
    <span class="co">/* and tip-toeing out of the door */</span>
}</code></pre>
<p>For the complete example see: <a href="CCppCode/Introductory/func_args.c">Introductory/func_args.c</a></p>
</section>
<section class="slide level1" id="section-22">
<h1 id="section-22"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-1">Something to try out later (if you have no other ideas)</h4>
<ul>
<li>Did you actually compile the program?</li>
<li>Did you use <code>gcc</code> or <code>g++</code> for compiling?</li>
<li>What happens if you enable more warnings (add <code>-Wall</code>)?</li>
<li>Why is this different in C and C++.</li>
<li>How can you make both compilers happy?</li>
<li>What happens if you remove the <code>#include</code>-line?</li>
</ul>
</section>
<section class="slide level1" id="section-23">
<h1 id="section-23"></h1>
<h4 id="may-i-add-a-comment-here">May I Add a Comment Here?</h4>
<pre class="sourceCode c"><code class="sourceCode c"><span class="co">/* this is a comment in C,</span>
<span class="co">   it may extend over several</span>
<span class="co">   lines ...</span>

<span class="co">   ... including empty ones</span>
<span class="co">*/</span></code></pre>
<p>(Stolen from PL/1, ehh?)</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="co">// and this comment style was</span>
<span class="co">// added by C++ initially and</span>
<span class="co">// was later adopted by C too</span></code></pre>
<p>(Formerly call <em>C++ Comment Style</em> but now common-place in C too.)</p>
</section>
<section class="slide level1" id="section-24">
<h1 id="section-24"></h1>
<h4 id="the-argument-list-in-more-detail">The Argument List in More Detail</h4>
<p>Don't worry if you don't completely understand what's going inside the argument list (inside parentheses) ...</p>
<ul class="incremental">
<li>... we don't understand either - OK, kidding again, of course we know:</li>
<li>It is a <em>name</em> (<code>message</code> above)</li>
<li>and a <em>type</em> (array of <code>char</code>)</li>
<li>(Types will be covered later, or at least seen in many examples, so don't worry too much now, you will have plenty of opportunities to ask questions if anything is unclear.)</li>
</ul>
</section>
<section class="slide level1" id="section-25">
<h1 id="section-25"></h1>
<h4 id="recursion">Recursion</h4>
<p>Functions may call themselves, what is called recursion.</p>
<ul>
<li>Of course this must be limited somehow, otherwise the program would never come to it's end!</li>
<li>Each recursive invocation works with its own set of arguments.</li>
</ul>
<p>Here is a famous example, calculating the factorial according to its recursive definition:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">unsigned</span> <span class="dt">long</span> factorial(<span class="dt">unsigned</span> <span class="dt">long</span> value) {
    <span class="kw">if</span> (value == <span class="dv">0</span>) <span class="kw">return</span> <span class="dv">1</span>;
    <span class="kw">else</span> <span class="kw">return</span> n*factorial(n<span class="dv">-1</span>);
}</code></pre>
<p>And yes, mathematically 0! is 1, see <a href="http://en.wikipedia.org/wiki/Factorial"><code class="url">http://en.wikipedia.org/wiki/Factorial</code></a>.</p>
<p>For the complete example see <a href="CCppCode/Introductory/factorial.c">Introductory/factorial.c</a>.</p>
</section>
<section class="slide level1" id="section-26">
<h1 id="section-26"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-2">Something to try out later (if you have no other ideas)</h4>
<ul>
<li>In the complete example determine which calls exactly happen if there are no command line arguments and if there are some.</li>
<li>Why in the first case the argument is <code>5uL</code> and not simply <code>5</code>?</li>
<li>What happens if you change <code>uL</code> to <code>UL</code>, or <code>LU</code>, or <code>lu</code> ...?</li>
<li>What happens if you remove it completely?</li>
<li>What happens if you do similar changes to the <code>lu</code> in the <code>printf</code>?</li>
<li>What does the program calculate for command line arguments that are not numbers?</li>
</ul>
</section>
<section class="slide level1" id="section-27">
<h1 id="section-27"></h1>
<h4 id="a-famous-recursion-test">A Famous Recursion Test</h4>
<p>The following function is famous for its deep recursion:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> ackermann(<span class="dt">int</span> m, <span class="dt">int</span> n) {
    <span class="kw">if</span> (m == <span class="dv">0</span>) <span class="kw">return</span> n + <span class="dv">1</span>;
    <span class="kw">else</span> <span class="kw">if</span> (n == <span class="dv">0</span>) <span class="kw">return</span> ackermann(m - <span class="dv">1</span>, <span class="dv">1</span>);
    <span class="kw">else</span> <span class="kw">return</span> ackermann(m - <span class="dv">1</span>, ackermann(m, n - <span class="dv">1</span>));
}</code></pre>
<p>(For the mathematical background see <a href="http://en.wikipedia.org/wiki/Ackermann_function"><code class="url">http://en.wikipedia.org/wiki/Ackermann_function</code></a>.</p>
<p>Looking rather innocent, isn't it?</p>
<p>The following will yield <code>125</code> ...</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> main() {
    printf(<span class="st">&quot;%d</span><span class="ch">\n</span><span class="st">&quot;</span>, ackermann(<span class="dv">3</span>, <span class="dv">4</span>));
}</code></pre>
</section>
<section class="slide level1" id="section-28">
<h1 id="section-28"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-3">Something to try out later (if you have no other ideas)</h4>
<p>Be cautious to try <code>ackermann</code> with a first argument of <code>4</code> or beyond!</p>
<p>Well, what you might try is:</p>
<ul>
<li>m=4 and n=0 (returns quickly) but</li>
<li>m=4 and n=1 (already requires some patience)</li>
</ul>
<p>You may also want to try compiling with some optimisation option like <code>-O2</code> ...</p>
<p>(And <a href="http://32leav.es/?p=674">here</a> is an article delving a little deeper in into this topic.)</p>
</section>
<section class="slide level1" id="section-29">
<h1 id="section-29"></h1>
<h4 id="library-functions">Library Functions</h4>
<p>Maybe you have already noticed or guessed:</p>
<ul>
<li><code>printf</code> is a function too!</li>
<li>But none defined by the progam itself.</li>
<li>Instead it comes from the <em>C Standard Library</em>.</li>
<li>More on this later.</li>
</ul>
</section>
<section class="slide level1" id="section-30">
<h1 id="section-30"></h1>
<h3 id="decide-how-to-continue">Decide How to Continue</h3>
<p>Now its time to decide:</p>
<ul>
<li>do you want to have a short pause</li>
<li>and <strong>in addition</strong> some time to go through the topics once more on your own,</li>
<li>or shall we rather continue together?</li>
</ul>
<p>May be after a pause?</p>
<p>Of how long?</p>
</section>
<section class="slide level1" id="section-31">
<h1 id="section-31"></h1>
<h2 id="the-edit-compile-link-and-run-cycle">The <em>Edit Compile Link and Run</em>-Cycle</h2>
<p>Or rather: <em>Edit Compile Link and</em> <strong>Test</strong> !!</p>
<p>Here again a quick outline of our next lesson:</p>
<ul>
<li>What is a Compilation Unit?</li>
<li>Why Header Files?</li>
<li>Object Files and the Linker</li>
<li>Libraries</li>
<li>Static vs. Dynamic Linking</li>
<li>Dependencies and Makefiles</li>
</ul>
</section>
<section class="slide level1" id="section-32">
<h1 id="section-32"></h1>
<h3 id="what-is-a-compilation-unit">What is a Compilation Unit?</h3>
<p>Of course, as the name says:</p>
<ul>
<li>A unit of code that can be compiled.</li>
<li>Or rather: the <em>smallest</em> unit of code that can be compiled a single unit.</li>
</ul>
<p>Technically it consists of:</p>
<ul>
<li>Data definitions and</li>
<li>Function definitions</li>
</ul>
<p>Both contribute to the initial content of the data and code memory.</p>
</section>
<section class="slide level1" id="section-33">
<h1 id="section-33"></h1>
<h4 id="compilation-unit-examples">Compilation Unit Examples</h4>
<p>A (rather small) compilation unit might look like this:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="co">// This is a compilation unit with a data definition</span>
<span class="dt">const</span> <span class="dt">char</span> greet[] = <span class="st">&quot;hello, world&quot;</span>;</code></pre>
<p>Or like this:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> ackermann(<span class="dt">int</span> m, <span class="dt">int</span> n) {
    <span class="co">// you have seen this, we won&#39;t repeat ourselfs</span>
}

<span class="dt">unsigned</span> <span class="dt">long</span> factorial(<span class="dt">unsigned</span> <span class="dt">long</span> n) {
    <span class="dt">auto</span> result = 1uL;
    <span class="kw">while</span> (n &gt; <span class="dv">1</span>) result *= n--; <span class="co">// uumpf? sic!</span>
    <span class="kw">return</span> result;
}</code></pre>
</section>
<section class="slide level1" id="section-34">
<h1 id="section-34"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-4">Something to try out later (if you have no other ideas)</h4>
<p>Is it possible to compile some completely empty file (given it has a suffix the compiler likes)?</p>
<ul>
<li>Will it work with both, <code>gcc</code> and <code>g++</code>?</li>
<li>What will <code>nm</code> tell you about it?</li>
<li>What <code>objdump</code>?</li>
</ul>
<p>Yes, yes: <code>objdump</code> called with just a filename gives you an error message.</p>
<p>And no, no, NO, NO!! We are not going to explain <code>objdump</code> here in more detail! Get used to <em>read the fine manual</em>.</p>
<p>(If you force someone to answer <em>RTFM</em> too often to your questions, he might feel inclined to substitute a different F-word!)</p>
</section>
<section class="slide level1" id="section-35">
<h1 id="section-35"></h1>
<h3 id="why-header-files">Why Header Files?</h3>
<p>Frequently the need arises to put one and the same information in more than one compilation unit.</p>
<ul>
<li>Duplicating such code manually is ... Pfui Teufel!</li>
<li>To <em>Copy and Paste</em> it is little better.</li>
</ul>
<p>Will you really remember all the places where you once inserted some piece of code verbatim whenever this piece needs to be changed?</p>
<p><strong>Really? Consistently?!</strong></p>
<p>The preprocessor with its <code>#include</code> mechanism will help you out.</p>
</section>
<section class="slide level1" id="section-36">
<h1 id="section-36"></h1>
<h4 id="sharing-information-with-help-of-the-preprocessor">Sharing Information with Help of the Preprocessor</h4>
<p>The most common thing to share between compilation units are data and function definitions (using <code>defs.h</code> as an example below).</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="ot">#include &quot;defs.h&quot;</span>
<span class="co">// ...</span></code></pre>
<p>Because definitions are usually required before any other code, <code>#include</code>-statements typically come first - at the <em>head</em> of the compilation units and hence the files named here are called header files (or headers in short).</p>
<p><strong>To remind you of their nature <code>.h</code> is the suffix commonly used for header files.</strong></p>
</section>
<section class="slide level1" id="section-37">
<h1 id="section-37"></h1>
<h4 id="warning-sloppy-wording-has-just-crossed-the-road">WARNING: Sloppy Wording Has Just Crossed the Road</h4>
<p>Oops - just noticed I use my wording a bit sloppily!</p>
<p>Technically it's more declarations that go into the header file, though, with respect to <code>struct</code>-s or <code>class</code>-es - both covered later - some call these definitions too :-(</p>
<p>Let's agree on the following: In a header file usually goes everything that doesn't actually cause content of code or data segment being created.</p>
<p>(Again this is not quite true with respect to templates, covered later.)</p>
</section>
<section class="slide level1" id="section-38">
<h1 id="section-38"></h1>
<h4 id="header-file-examples">Header File Examples</h4>
<p>If the <code>ackermann</code> and <code>factorial</code> functions were to be called from more than one compilation unit, the following header file content would be appropriate:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> ackermann(<span class="dt">int</span> m, <span class="dt">int</span> n);
<span class="dt">unsigned</span> <span class="dt">long</span> factorial(<span class="dt">unsigned</span> <span class="dt">long</span> n);</code></pre>
<p>The two lines shown above are called <em>function prototypes</em>.</p>
<ul>
<li>They contain the <em>signature</em> but not the implementation.</li>
<li>Argment names are optional.</li>
</ul>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> ackermann(<span class="dt">int</span>, <span class="dt">int</span>);
<span class="dt">unsigned</span> <span class="dt">long</span> factorial(<span class="dt">unsigned</span> <span class="dt">long</span>);</code></pre>
</section>
<section class="slide level1" id="section-39">
<h1 id="section-39"></h1>
<h4 id="header-file-include-guards">Header File Include Guards</h4>
<p>As header files often depend on other header files, their content must be protected against being processed twice.</p>
<p>This is the standard technique:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="ot">#ifndef UTILITY_FUNCTIONS_H</span>
<span class="ot">#define UTILITY_FUNCTIONS_H</span>

    <span class="co">// actual content of utility function header file</span>
    <span class="co">// ...</span>

<span class="ot">#endif</span></code></pre>
</section>
<section class="slide level1" id="section-40">
<h1 id="section-40"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-5">Something to try out later (if you have no other ideas)</h4>
<p>What should never go into a header file is:</p>
<ul>
<li>actual data definitions and/or</li>
<li>function definitions together with their body (= implementation)</li>
<li><strong>except</strong> for functions that are marked <code>inline</code> (discussed later).</li>
</ul>
<p>Don't believe? Just try it out by including the header containing</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> foo() {
    <span class="kw">return</span> <span class="dv">42</span>;
}</code></pre>
<p>in two compilation units and try to link the resulting object files in the same executable!</p>
</section>
<section class="slide level1" id="section-41">
<h1 id="section-41"></h1>
<h3 id="object-files-and-the-linker">Object Files and the Linker</h3>
<p>Creating an executable program usually involves two main steps:</p>
<ul>
<li>Compiling and</li>
<li>Linking</li>
</ul>
<p>Both can be run independantly with the same command that has already been used for full compilation and linking: <code>gcc</code> or <code>g++</code></p>
<p>Put differently:</p>
<p><strong>The above commands are just call wrappers and there are command line options for a more detailed control which parts of the tool-chain will actually be executed.</strong></p>
<p>RTFM!</p>
</section>
<section class="slide level1" id="section-42">
<h1 id="section-42"></h1>
<h4 id="compiling-source-files-to-object-modules">Compiling Source Files to Object Modules</h4>
<p>The command line switch <code>-c</code> (lower case) makes the call wrapper stop after creating the object file.</p>
<ul>
<li><code>gcc -c somefile.c</code>
<ul>
<li>assumes C source code in <code>somefile.c</code></li>
<li>creates object module in <code>somefile.o</code></li>
</ul></li>
<li><code>g++ -c somefile.cpp</code>
<ul>
<li>assumes C++ source code in <code>somefile.cpp</code></li>
<li>creates object module in <code>somefile.o</code></li>
</ul></li>
</ul>
<p>The object file has the name of the source file with the suffic changed to <code>.o</code> (for operating systems in the Unix/Linux tradition).</p>
</section>
<section class="slide level1" id="section-43">
<h1 id="section-43"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-6">Something to try out later (if you have no other ideas)</h4>
<p>You can also stop the call wrapper after other steps:</p>
<ul>
<li>Using the option <code>-E</code> does only the preprocessing step:
<ul>
<li>Output is sent to standard output i.e. (the terminal screen)</li>
<li>You may want to pipe it through a pager (<code>more</code> or <code>less</code>)</li>
</ul></li>
</ul>
<p>Have an <code>#include</code> directive in the compiled source code and note how the included file content appears in the output.</p>
<p>If you are at it, you may want to explore two other preprocessor mechanisms:</p>
<ul>
<li>Macro Replacement (<code>#define XYZ whatever</code>)</li>
<li>Conditional compilation (<code>#if</code> - <code>#else</code> - <code>#endif</code>)</li>
</ul>
</section>
<section class="slide level1" id="section-44">
<h1 id="section-44"></h1>
<h4 id="something-else-to-try-out-later-if-you-have-no-other-ideas">Something else to try out later (if you have no other ideas)</h4>
<ul>
<li>Using the option <code>-S</code> stops before assembling:
<ul>
<li>Output is in a file with the suffix <code>.s</code></li>
<li>It's a text file - you can view it in an editor</li>
<li>But you probably need some basic of assembler programming to really understand it</li>
</ul></li>
</ul>
<p>Are you are interrested in what assembler code results from which source and also want to try different compilers?</p>
<p>Look here: <a href="http://gcc.godbolt.org"><code class="url">http://gcc.godbolt.org</code></a>!</p>
</section>
<section class="slide level1" id="section-45">
<h1 id="section-45"></h1>
<h4 id="linking-object-files-to-executables">Linking Object Files to Executables</h4>
<p>This starts with (one or more) object file(s):</p>
<ul>
<li><code>gcc somefile.o</code>
<ul>
<li>assumes object module in somefile.o</li>
<li>links against the C standard library and</li>
<li>uses the C runtime start up</li>
</ul></li>
<li><code>g++ somefile.o</code>
<ul>
<li>assumes object module in somefile.o</li>
<li>links against the C++ standard library and</li>
<li>uses the C++ runtime startup</li>
</ul></li>
</ul>
<p>So, what makes the difference here, if the file has the same name in both examples (well, just testing if you nodded off).</p>
</section>
<section class="slide level1" id="section-46">
<h1 id="section-46"></h1>
<h4 id="other-tools-applying-to-object-modules">Other Tools Applying to Object Modules</h4>
<p>While it may seem the only use of object modules is to name them to the linker, there are a few other commands of interrest on some occasions.</p>
<ul>
<li><code>size</code> show memory space requirements</li>
<li><code>nm</code> show defined and expected references</li>
</ul>
<p>Both commands can also be used on executable programs, for which they show total size requirements and how the linker resolved and finally assigned unique addresses to named symbols.</p>
<p>Want more details?</p>
<p>RTFM!</p>
</section>
<section class="slide level1" id="section-47">
<h1 id="section-47"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-7">Something to try out later (if you have no other ideas)</h4>
<p>Though not strictly C/C++ programming in the narrow sense of learning the syntax of a language and maybe some library functions, playing with separate compilation of small object modules and using <code>nm</code> to look at the symbols and how they are resolved can be enlightening.</p>
<p>When there is time reiterate this chapter once more by yourself and acquire some practical skills, you will seen have more examples with separate compilation on which you may try this.</p>
<p>Again, it's not strictly C/C++ but it may well give you the certainty to have fully understand the purpose of the Linker tool and how it combines object modules into executable programs.</p>
</section>
<section class="slide level1" id="section-48">
<h1 id="section-48"></h1>
<h4 id="runtime-startup-module-for-c">Runtime Startup Module for C</h4>
<p>The runtime startup module calls the <code>main</code> function in its middle as if it were an ordinary function - there is nothing special a C compiler assumes about it:</p>
<ol>
<li>Command line arguments are taken from the operating system and</li>
<li>prepared to be handed over to <code>main</code> in the expected structure.</li>
<li>Standard <code>FILE</code>s (<code>stdin</code>, <code>stdout</code> and <code>stderr</code>) are prepared.</li>
<li>The <code>main</code> function is actually called (just as an ordinary function)</li>
<li>After <code>main</code> returned, its return value is saved to be finally handed over to the operating system in the last step.</li>
<li><strong>All still open <code>FILE</code>-s</strong> are closed - not only the standard channels - which especially flushes yet unwritten buffers.</li>
<li>The process is terminated, handing over the return value of <code>main</code>.</li>
</ol>
</section>
<section class="slide level1" id="section-49">
<h1 id="section-49"></h1>
<h4 id="something-to-try-out-later-for-the-real-adventurous-souls">Something to try out later (for the real adventurous souls)</h4>
<p>Try to find the code for the runtime startup module linked to C program.</p>
<p>Disassemble!</p>
<p>For Unix/Linux it is probably not really complex.</p>
<p>But you might e.g. try to find out how all still open files are finally closed.</p>
</section>
<section class="slide level1" id="section-50">
<h1 id="section-50"></h1>
<h4 id="runtime-startup-module-for-c-1">Runtime Startup Module for C++</h4>
<p>The additional steps for C++ surround the call to <code>main</code>:</p>
<ul>
<li>before <code>main</code> starts constructors of global objects are called</li>
<li>after <code>main</code> returned destructors of global objects are called</li>
</ul>
<p>Don't get too confused by this constructor/destructor mumbo-jumbo. It will be covered later - for now you don't need to know.</p>
<p>(And you also don't need to know for now that all the d'tors of block local <code>static</code> objects are called too and the order of such calls is exactly the reverse of c'tor calls.)</p>
</section>
<section class="slide level1" id="section-51">
<h1 id="section-51"></h1>
<h4 id="bare-metal-embedded-applications">Bare Metal Embedded Applications</h4>
<p>C applications running embedded without support of an operating system also need a runtime startup module.</p>
<p>It often does less than a runtime startup module for a hosted application in that:</p>
<ul>
<li>None of the standard channels are prepared to be used.</li>
<li>No command line arguments are handed over to <code>main</code>.</li>
<li>In fact, the first function may have a different name and</li>
<li>typically never to returns, i.e. runs in an endless loop.</li>
</ul>
<p>So the runtime startup module may be quite simple as shown in this <a href="Zed-BM/Hello01/startup.s">Example for Zynq/Zedboard</a>.</p>
</section>
<section class="slide level1" id="section-52">
<h1 id="section-52"></h1>
<h3 id="libraries">Libraries</h3>
<p>Many of what a C/C++ program has to do is repetitive in the sense that a set of (decently parametrized) subroutines would be useful in a large number of programs.</p>
<p>A library function already known because it had been used in example is <code>printf</code>.</p>
<p>Such are typically put into a library, which can come in two flavours:</p>
<ul>
<li>Static Libraries - more or less a collection of object modules put into a single file.</li>
<li>Dynamic Libraries - a pre-linked unit of code, similar to an executable but running on behalf of another application.</li>
</ul>
</section>
<section class="slide level1" id="section-53">
<h1 id="section-53"></h1>
<h4 id="static-libraries">Static Libraries</h4>
<p>A static library is a single file, containing any object modules and typically some kind of index to simplify lookup.</p>
<p>For Unix/Linux thefile name suffix of static libraries is usually <code>.a</code> and the content is managed with the <em>Librarian</em> tool <code>ar</code>.</p>
<ul>
<li><code>ar t</code> ... list content</li>
<li><code>ar c</code> ... create a new library</li>
<li><code>ar r</code> ... replace object module(s)</li>
</ul>
<p>The above is only meant as example, for more details have a look at the manual page <code>ar(1)</code>.</p>
</section>
<section class="slide level1" id="section-54">
<h1 id="section-54"></h1>
<h4 id="dynamic-libraries">Dynamic Libraries</h4>
<p>The appropriate view of a <em>Dynamic Library</em> could be that of an executable without a <code>main</code> function. It will be dynamically loaded if it's references satisfy some external references of another executable.</p>
<p><strong>Dynamic Libraries (Windows: DLLs, Unix/Linux Shared Objectes) are closely interweaved with support from an operating system that will load them on request. i.e. connect them to the address space of the process requiring them.</strong></p>
<p>In a sense, for a dynamic library the operating system will do <em>just in time</em> what static linking otherwise does ahead of time.</p>
</section>
<section class="slide level1" id="section-55">
<h1 id="section-55"></h1>
<h3 id="linking-means-connecting-references">Linking Means Connecting References</h3>
<p>The main objective of linking is to connect addresses between separately compiled modules, i.e.:</p>
<ul>
<li>Access to global variables, which ultimately in an executing program all live at their unique address, needs to be adjusted in all referrers.</li>
<li>Same for called subroutines, only with regard to addresses in code memory.</li>
</ul>
</section>
<section class="slide level1" id="section-56">
<h1 id="section-56"></h1>
<h4 id="external-references-what-is-expected">External References (What is Expected)</h4>
<p>Functions defined in other modules have to introduced via their <em>Prototypes</em>:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="kw">extern</span> <span class="dt">int</span> foo(<span class="dt">void</span>);           <span class="co">// no args, return int</span>
<span class="kw">extern</span> <span class="dt">double</span> sqrt(<span class="dt">double</span>);     <span class="co">// double arg, return double</span>
<span class="kw">extern</span> <span class="dt">long</span> atol(<span class="dt">const</span> <span class="dt">char</span> *); <span class="co">// char pointer arg, return long</span></code></pre>
<p>The keyword <code>extern</code> can be - and often is - omitted for function prototypes.</p>
<p>Referencing data items from other modules should always add <code>extern</code>:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="kw">extern</span> <span class="dt">unsigned</span> <span class="dt">int</span> call_count;
<span class="kw">extern</span> <span class="dt">char</span> module_name[];
<span class="kw">extern</span> <span class="dt">float</span> module_version;</code></pre>
</section>
<section class="slide level1" id="section-57">
<h1 id="section-57"></h1>
<h4 id="external-references-in-c">External References in C</h4>
<p>In C the rules when and when not external references must be explicitly named are slightly more complex as in C++. The reason is the age of the language and that any later extensions carefully tried not to break backward compatibility so that legacy code would still compile without any change.</p>
<p>Here are some of the main differences to C++:</p>
<ul>
<li>Extern references for subroutines will be automatically assumed for symbols looking like a function call.</li>
<li>Data references without <code>extern</code> and without an initialisation may be treated as external references and hence <strong>not</strong> cause name clashes across modules.</li>
</ul>
</section>
<section class="slide level1" id="section-58">
<h1 id="section-58"></h1>
<h4 id="external-references-in-c-1">External References in C++</h4>
<p>In C++ the rules are a bit more regular, as when the language was designed there had been no legacy code that could have been broken.</p>
<p>Therefore: C++ could favour a strict <em>definition-references modell</em> for linking (which in C is only optional and most often applied in a relaxed way).</p>
<p><strong>Extern References must be made explicit.</strong></p>
<p>Any unknown symbol used (i.e. undefined and not declared to be <code>extern</code>) causes a compilation error.</p>
</section>
<section class="slide level1" id="section-59">
<h1 id="section-59"></h1>
<h4 id="actual-definitions-what-is-offered">Actual Definitions (What is Offered)</h4>
<p>So that the linker can finally construct a valid executable - or that linking an executable to a dynamic library to be finally linked on loading at runtime can succeed - there must be definitions for</p>
<ul>
<li>each subroutine called from some object module and</li>
<li>each global data item referenced from somewhere.</li>
</ul>
</section>
<section class="slide level1" id="section-60">
<h1 id="section-60"></h1>
<h4 id="data-definitions">Data Definitions</h4>
<p>Definitions of data items look alike their counterparts introducing external references but omit the keyword <code>extern</code> and may optionally pecify give an initial value.</p>
<pre class="sourceCode c"><code class="sourceCode c">unsinged <span class="dt">int</span> call_count;
<span class="dt">char</span> module_name[] = <span class="st">&quot;MyModule Version&quot;</span>;
<span class="dt">float</span> module_version = <span class="fl">0.9</span>;</code></pre>
<p>In C++ <code>extern</code> can be combined with an initialisation which turns the whole construct into a definition.</p>
<p><strong>In fact, in C++ this combination is even to recommend for global constants which otherwise would not be visible accross the boundaries of a compilation unit.</strong></p>
</section>
<section class="slide level1" id="section-61">
<h1 id="section-61"></h1>
<h4 id="what-we---together---could-do-later-if-we-have-no-other-ideas">What we - together - could do later (if we have no other ideas)</h4>
<p>I can show you many of the subtleties and quirks when linking, where the C rules are different in detail from C++, etc.</p>
<p>But I doubt it pays (now) or rather: if you have any strange problems when linking under Unix/Linux with either</p>
<ul>
<li>unresolved externals or</li>
<li>name clashes</li>
</ul>
<p>just send me mail, preferrably with a stripped-down (smallest) failing case and I'll try to explain the details based on the concrete problem you ran into.</p>
</section>
<section class="slide level1" id="section-62">
<h1 id="section-62"></h1>
<h4 id="subroutine-definitions">Subroutine Definitions</h4>
<p>Subroutine definitions are very easily to recognize as they need to include the implementation of the function in a block of code following where the declaration (prototype) ends with a colon.</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> foo() { <span class="kw">return</span> <span class="dv">42</span>; }

<span class="dt">long</span> atol(<span class="dt">const</span> <span class="dt">char</span> *s) {
    <span class="dt">long</span> result = <span class="dv">0</span>;
    <span class="dt">const</span> <span class="dt">int</span> minus = (*s == &#39;-&#39;);
    <span class="kw">if</span> (minus) ++s;
        <span class="kw">while</span> (&#39;<span class="dv">0</span>&#39; &lt;= *s &amp;&amp; *s &lt;= &#39;<span class="dv">9</span>&#39;)
            result = <span class="dv">10</span>*result - (*s++ - &#39;<span class="dv">0</span>&#39;);
    <span class="kw">return</span> !minus ? -result : result;
}</code></pre>
</section>
<section class="slide level1" id="section-63">
<h1 id="section-63"></h1>
<h4 id="something-to-look-at-later-if-you-have-no-other-ideas">Something to look at later (if you have no other ideas)</h4>
<p>YOU: Am I expected to understand the example on the last page ... well, maybe I understand that <code>foo</code> returns the value <code>42</code> each time it's called, but <code>atol</code>?</p>
<p>ME: You need not understand it fully right now, but as you already know a bit about C you might review the code and try to analyse what it does.</p>
<p>YOU: Well, maybe I have an idea, but tell: What's this subtracting <code>'0'</code> from a character, to which the expression <code>*s</code> boils down?</p>
<p>ME: The <em>printable digits</em> in the machine character set are usually not represented with a bit pattern that means 0, 1, 2 etc. if used in a numeric context. Instead, e.g. in ASCII or ISO-8859 character set variants, the code points for the printable digits are 48, 49 etc.</p>
<p>YOU: So you would have to subtract <code>48</code> ...</p>
<p>ME: Yes and specifying exactly this value as <code>'0'</code> makes the program a bit more robust in case you port the code to a machine with a substantially different machine character set like EBCDIC, where the printable digits are at code points 240..249.</p>
<p>YOU: So <code>'0'</code> is just a portable way to say <code>48</code> if compiled for a machine charater set ISO-8859-1 ...</p>
<p>ME: ... yes, and <code>240</code> in an EBCDIC environment, like still in use on some ancient and modern main frames.</p>
<p>YOU: I see, but ... doesn't the code nevertheless depend on the fact that all the printable digits have consecutive code points in the machine character set?</p>
<p>ME: So it is, but this is a requirement which C89, the first ANSI/ISO standard for the C laguage put it into the specifiation and afterwards C89 became part of C++98, the first ISO standard for C++.</p>
<p>YOU: Doesn't this limit the range of character sets that can be supported by C/C++?</p>
<p>ME: Not really - it was found then that even rather exotic character sets that were in use in some large and small machines from on the late 60s had the printable digits at consecutive code points.</p>
<p>YOU: So well, I could also re-code printable letters 'a', 'b', 'c' ... in a <code>char</code> variable to the numeric values 0, 1, 2 ... with the expression <code>ch -'a'</code>?</p>
<p>ME: No, at least not portably, as the letters of the (western) alphabet happen to use consecutive code points in ASCII and ISO-8859-X, they do not so in EBCDIC.</p>
<p>YOU: And therefore the C and C++ standards did not put such an reqirement into the language specification, as it would have limited the range of machines and operating systems were the standard can be implemented?</p>
<p>ME: Let's say &quot;implemented efficiently&quot; as there would of course be always the possibility that C/C++ maps the native machine character set to some internal coding immediately on input and output.</p>
<p>YOU again [after looking at the code for a long time]: Well, I now think I understand what's going on in the code: it turns a sequence of printable characters to its numerical representation in a variable of type <code>long</code>.</p>
<p>ME: So it is.</p>
<p>YOU: But say, isn't the code a bit convoluted, by doing all the calculation as a negative number?</p>
<p>ME: You think it would be more straight forward to do it as shown below?</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">long</span> atol(<span class="dt">const</span> <span class="dt">char</span> *s) {
    <span class="dt">long</span> result = <span class="dv">0</span>;
    <span class="dt">const</span> bool minus = (*s == &#39;-&#39;);
    <span class="kw">if</span> (minus) ++s;
    <span class="kw">while</span> (&#39;<span class="dv">0</span>&#39; &lt;= *s &amp;&amp; *s &lt;= &#39;<span class="dv">9</span>&#39;))
        result = <span class="dv">10</span>*result + (*s++ - &#39;<span class="dv">0</span>&#39;);
    <span class="kw">return</span> minus ? -result : result;
}</code></pre>
<p>YOU: Actually I do - did you write it the other way to confuse the reader?</p>
<p>ME: No I didn't - it has a purpose.</p>
<p>YOU: Which?</p>
<p>ME: Guess!</p>
<p>YOU: Don't know - give me a clue!</p>
<p>ME: Ever heard about representing integral numbers in two's-complement?</p>
<p>YOU: Yes, but ...</p>
<p>ME: ... enough of a clue - ask me later if you really have no idea!</p>
</section>
<section class="slide level1" id="section-64">
<h1 id="section-64"></h1>
<h3 id="static-vs.-dynamic-linking">Static vs. Dynamic Linking</h3>
<p>Viewn from the build process, that turns a set of object modules into a finally executable program, the difference boils down to how the libraries are named - under Linux/Unix:</p>
<ul>
<li><code>libsomelib.a</code> ... names a static library</li>
<li><code>libsomelib.so</code> ... names a dynamic library</li>
</ul>
<p>Often the difference is even a bit more subtle on Unix/Linux: To the linker only <code>somelib</code> is named - i.e. <strong>without</strong> the initial <code>lib</code> in its name - and it decides based on which files are actually found in the library search path based on other settings and defaults whether to chose the static or dynamic version of a library.</p>
</section>
<section class="slide level1" id="section-65">
<h1 id="section-65"></h1>
<h4 id="something-to-find-out-later-if-you-are-a-really-curious-unixlinux-guy">Something to find out later (if you are a really curious Unix/Linux guy)</h4>
<p>There is a program <a href="CCppCode/Introductory/mathfunc.c">Introductory/mathfunc.c</a> which makes use of functions from the <em>Math Library</em> which are not part of the C standard library under Unix/Linux (for historic reasons).</p>
<p>When compiling this program you get an error unless you add <code>-lm</code> to the arguments during the linking step. What the linker will actually use is a static or dynamic library named <code>libm.a</code> or <code>libm.so</code> in some standard path compiled into the linker itself (to which of course can be added too).</p>
<p>Now, you may trace the system calls a program makes (RTFM: strace!) and that way could &quot;watch&quot; which files are tried to open during linking. If you do everything right - i.e. supply the necessary options to <code>strace</code> and maybe <code>grep</code> through the output that is generated - you will detect which <code>libm</code> is accessed ...</p>
<p>... and for a dynamic library you will also be abled to trace access when you run the executable program generated from <code>mathfunc.c</code>.</p>
</section>
<section class="slide level1" id="section-66">
<h1 id="section-66"></h1>
<h4 id="static-linking-in-more-detail">Static Linking in more Detail</h4>
<p>Static linking is - simply put - the process of scanning archive files which contain a set of object modules for modules that satisfy external references of other modules.</p>
<ul>
<li>Some of the subtleties, like adding modules that introduce new external references, are handled automatically by modern tools, so the developer will not have to care.</li>
<li>Still in some cases, like for static libraries mutually depending on each other, it will be necessary to delve a bit deeper, understand what's going on beyond the cover, and eventually change order or add some arguments in the linker command line.</li>
</ul>
</section>
<section class="slide level1" id="section-67">
<h1 id="section-67"></h1>
<h4 id="dynamic-linking-in-more-detail">Dynamic Linking in more Detail</h4>
<p>Though it may already have become obvious:</p>
<ul>
<li><p>Linking dynamically has a first step in which dynamic libraries are named to the linker.</p></li>
<li>During this step the linker just checks whether external references can be principially(!) satisfied with the set of libraries named.</li>
<li><p>In the final executable entries are made which would cause a required library to be loaded when a piece of code or data in it is referenced.</p></li>
<li><p>Actually connecting an executing process to a shared library is done later by the operating system, trapping accesses to unconnected external symbols that need to be satisfied.</p></li>
</ul>
</section>
<section class="slide level1" id="section-68">
<h1 id="section-68"></h1>
<h4 id="something-to-look-at-later-if-you-have-no-other-ideas-1">Something to look at later (if you have no other ideas)</h4>
<p><code>man ldd</code> (RTFM)</p>
</section>
<section class="slide level1" id="section-69">
<h1 id="section-69"></h1>
<h4 id="static-or-dynamic-linking---which-one-should-be-preferred">Static or Dynamic Linking - Which One Should be Preferred?</h4>
<p>The biggest advantage of dynamic linking comes into play if there is a large number of applications, all of which access the same library:</p>
<ul>
<li>The library code needs to be held in memory only once, being mapped by the memory management unit (<a href="http://en.wikipedia.org/wiki/Memory_management_unit">MMU</a>) to every process accessing it.</li>
<li>Even if the dynamic library contains a number of subroutines never ever used by any of these applications, the former advantage may still have a large payoff.</li>
</ul>
</section>
<section class="slide level1" id="section-70">
<h1 id="section-70"></h1>
<h4 id="problems-with-dynamic-linking">Problems with Dynamic Linking</h4>
<p>One of the main sources of failure are search paths, i.e. the list of directories telling the linker where it can find dynamic libraries:</p>
<ul>
<li>It may be named on the command line for linking, but</li>
<li>at runtime it needs to be available in the process' environment.</li>
</ul>
<p>For Unix/Linux it is essential to export the (shell) variable <code>LD_LIBRARY_PATH</code>, containing a colon-separated list of directories where dynamic libraries are placed (much like <code>PATH</code> for executables).</p>
<p>There are other alternatives, like putting the pathname into the executable ... so again: RTFM</p>
</section>
<section class="slide level1" id="section-71">
<h1 id="section-71"></h1>
<h4 id="problems-with-static-linking">Problems with Static Linking</h4>
<p>One of the biggest advantages of static libraries compared to naming object modules explicitely to the Linker is:</p>
<ul>
<li>The Linker automatically pulls (or rather copies) only those object modules actually required because they satisfy some external reference of another module.</li>
<li>This is done recursively, i.e. new external references introduced by an object module pulled from a library may pull more object additional modules.</li>
</ul>
<p><strong>It should be understood that decisions made by the Linker which modules to pull are made statically.</strong></p>
<p>Hence, especially for sloppily structured object modules, subroutines (code and related global data reservations) may be added to an executable though actually never used.</p>
</section>
<section class="slide level1" id="section-72">
<h1 id="section-72"></h1>
<h4 id="linking-programs-for-embedded-targets">Linking Programs for Embedded Targets</h4>
<p>This is not much different from linking in general.</p>
<p>For <em>Bare Metal Applications</em> there is no choice but to link statically because there will be no operating system to connect a shared libray at run time.</p>
<p>Of course, a feature close to dynamic linking <em>might</em> be part of a statically linked function, e.g. available for your target in an advanced support library.</p>
</section>
<section class="slide level1" id="section-73">
<h1 id="section-73"></h1>
<h4 id="historic-note-on-static-libraries">Historic Note on Static Libraries</h4>
<p>You may skip this section without loosing much but if you ever wondered about the many options the Librarian tool <code>ar</code> has, or why there are other tools like <code>ranlib</code> that seem to be associated with static libraries, or why the Linker has special markers as a provisions to put libraries named on its command line into groups, the paragraphs following may help to sched some light on it.</p>
<p>Now it's time to decide: continue reading or <a href="#An%20Alternative%20View%20of%20the%20Unix/Linux-Kernel">skip</a> ...</p>
<p>Once there was Unix in its childhood days (viewn from todays perspective) and this was at a time were resources were rather scarce, as well with respect to computing power as to storage space. To give you an idea about the latter: Early Unix systems could well live with really small hard disk (say 5 MByte), having 20 or even 40 MByte was not little but plenty.</p>
<p>Due to the nature of the original Unix file system each file occupied a multiple of 512 Bytes on disk, i.e. if only a few bytes had to be stored the reminder would not be usable. So, quite a lot of small files would have been a waste of a precious ressource like disk space.</p>
<p>As the hierarchical file system where a directory on the disk could not only contain files but sub-directories, nesting to infinite depth (as long as disk space allows), was one thing Unix was famous for, it seems the natural choice to store collections of object modules should would have been to simply use (sub-) directories which may be named to and then searched by the Linker. But because many object files, as e.g. the standard functions in the C library, were rather small (some 50..200 bytes as a typical size), this choice would have meant to waste a lot of disk space.</p>
<p>Therefore the <em>archive</em>-format was invented, not only for libraries but as a general solution to the *&quot;Collection of Many Small Files&quot;-problem. Hence the name <code>ar</code> which stands for <em>Archiver</em> (tool). It simply put many small files in a sequence, adding a short header before each that contained its name and size, allowing to do a linear search through the archive, skipping members until the desired could be copied out.</p>
<p>New members were easily put at the end (adding to the end of a file was an operation the Unix file system supported efficiently), while replacing members was done by marking the old version invalid and put the new to the end. (Overwriting a file byte by byte would have been available as efficient operation, but new members of an archive replacing old ones often had a different size and hence would not have fitted into the space available for the member to be replaced.)</p>
<p>Now, using the archive format to store object modules posed a new problem: since the main work of the linker was to look for extern references that needed to be satisfied and select object mdoules based on this, it was not unusual that by selecting one module new external references were introduced.</p>
<p>As already mentioned in the early days of Unix also CPU power was a scarce ressource, hence to make linking efficient it was desirable to place the object modules into the archive in a certain order, so that - in a linear search - modules introducing extern references were visited <strong>before</strong> the modules satisfying such references.</p>
<p>In other words: for best performance object modules had to be put into an archive in [tologically sorted] order with respect to their (extern) references, otherwise the Linker would have to run twice over the library. (Though the Linker didn't do this by itself but rather complained about unsatisfied references when the object modules were not accordingly sorted, it was a common solution to name a library twice on the command line in such situations.)</p>
<p>Since with an increasing number of object modules in a library the proper order was more and more difficult to obtain, the utility <code>ranlib</code> was made available, which put an index as first member into the library, helping the linker to do its work without making many passes over the library. So now, since several decades, the problem of having to put object modules in a certain (sequential) order in a static library has completely vanished - as long as only a single library is considered. But it may still be present if multiple libraries are involved that are either specified to the Linker in the wrong order or mutually reference object modules inside each other.</p>
<p>The wrong order case will manifest itself even today if libraries <em>requiring</em> modules in other libraries are named to the Linker <em>after</em> such other libraries. The solution is - of course - to change the order in which these libraries are named to the Linker.</p>
<p>The other case, mutually referencing libraries, is rare in practice, because separate libraries are usually intended for separate and independant reuse and hence dependencies between libraries usually go into one direction only, i.e. dependencies between all of the libraries required in a single project usually build a directed acyclic graph (DAG).</p>
<p>Nevertheless there is a solution if there are such depenencies, which is to group mutually dependent libraries for the linker by placing special markers in the sequence of (library) arguments, indicating the start and the end of a group.</p>
<p>If the linker encounters the start of the group it first notes its still unsatisfied references. Then, if from any library inside the group a module is selected (because it satisfies an external reference of another module) and this module introduce new external references, they are added to the list.</p>
<p>When reaching the end-marker for the group and the initial list has received new members, the libraries in the group are scanned once more, eventually selecting more object modules from their contents. This is repeated until the list no longer grows by new entries, meaning that all yet unsatisfied external references must refer to object modules outside the - possibly rescanned - group and the linker advances to the libraries (or groups) named after the just processed group.</p>
</section>
<section class="slide level1" id="section-74">
<h1 id="section-74"></h1>
<h4 id="an-alternative-view-of-the-unixlinux-kernel">An Alternative View of the Unix/Linux-Kernel</h4>
<p>The Unix/Linux-Kernel may be viewn as a dynamic library available to all (compiled) applications executing as a process.</p>
<p>It has a strictly controlled call interface which typically uses some special machine operations (<a href="http://en.wikipedia.org/wiki/System_call">call gates</a>) as a means of granting additional priveledges when changing to execute in <a href="http://www.linfo.org/kernel_mode.html">kernel mode</a>, compared to <a href="http://www.linfo.org/user_mode.html">user mode</a> where kernel memory can not be directly accessed.</p>
</section>
<section class="slide level1" id="section-75">
<h1 id="section-75"></h1>
<h3 id="dependencies-and-makefiles">Dependencies and Makefiles</h3>
<p>When compiling and linking with the final goal of producing an executable program, staying in full control of depencies between the intermediate and final products and their respective prerequisites can become hard too manage if a dozen or more files are involved.</p>
<p>The usual solution is to leave dependency management to a build system, with <a href="http://mrbook.org/tutorials/make/"><code>make</code></a>, its archetype once grown under Unix`, being still in use today though typically in enhanced variants like <a href="https://www.gnu.org/software/make/manual/make.html">GNU make</a>.</p>
</section>
<section class="slide level1" id="section-76">
<h1 id="section-76"></h1>
<h4 id="something-we-can-do-now-together-or-you-may-do-later-on-your-own">Something we can do now (together) or you may do later (on your own)</h4>
<p>For some of the programs used in this course a first understanding may be gained by reviewing the following examples:</p>
<ul>
<li><a href="CCppCode/RandomNumbers/Makefile">RandomNumbers/Makefile</a> and</li>
<li><a href="CCppCode/Thermostate/Combined_SWIG/Makefile">Thermostate/Combined_SWIG/Makefile</a>.</li>
</ul>
</section>
<section class="slide level1" id="section-77">
<h1 id="section-77"></h1>
<h4 id="something-to-try-out-at-later-if-you-have-no-other-ideas">Something to try out at later (if you have no other ideas)</h4>
<p>Assuming position independant code actually enlarges the memory footprint, how could the Makefile of the thermostate example be extended so that position independant code will only be generated for shared libraries?</p>
<p>And also: can you verify (or negative) the above assumption on code size?</p>
</section>
<section class="slide level1" id="section-78">
<h1 id="section-78"></h1>
<h2 id="linking-between-c-and-c-and-other-languages">Linking between C and C++ and Other Languages</h2>
<p>The outline for this lesson:</p>
<ul>
<li>Calling conventions in general</li>
<li>What is the purpose of <code>extern &quot;C&quot;</code>?</li>
<li>Generating call wrappers with <a href="http://www.swig.org">SWIG</a></li>
</ul>
</section>
<section class="slide level1" id="section-79">
<h1 id="section-79"></h1>
<h3 id="calling-conventions-in-general">Calling Conventions in General</h3>
<p>To put it simple, calling conventions comprise the set of rules by which the caller of a subroutine and the subroutine itself</p>
<ul>
<li>communicate information between each other so that each side gets what it expects where it expects it;</li>
<li>use shared resources like CPU registers so that they do not step on each others feet.</li>
</ul>
</section>
<section class="slide level1" id="section-80">
<h1 id="section-80"></h1>
<h3 id="what-is-the-purpose-of-extern-c">What is the purpose of <code>extern &quot;C&quot;</code>?</h3>
<p>Especially when C++ has to cope with a tool chain that is not really aware of C++ features (i.e. featuress not present in C - like overloading based on argument types), calling conventions might differ between the two languages.</p>
<p>To access some function from a separate module that was compiled with C, the following may be necessary in C++:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">extern</span> <span class="st">&quot;C&quot;</span> <span class="dt">int</span> foo(<span class="dt">int</span>, <span class="dt">const</span> <span class="dt">char</span> *);</code></pre>
</section>
<section class="slide level1" id="section-81">
<h1 id="section-81"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-8">Something to try out later (if you have no other ideas)</h4>
<p>Have a look at the minimal code examples in <a href="CCppCode/Extern_C">Extern_C</a> and make them to compile an link correctly.</p>
<ul>
<li>Manually compile <code>c-module.c</code> and <code>c-main.c</code> into the respective object module files (<code>c-module.o</code> and <code>c-main.o</code>).</li>
<li>Manually link an executable <code>c-main</code> from the object modules.</li>
<li>Do similar for <code>cpp-module.cpp</code> and <code>cpp-main.cpp</code>.</li>
<li>How would you include the result <code>c-module.o</code> into the linking of the <code>cpp-main</code>-executable?</li>
</ul>
</section>
<section class="slide level1" id="section-82">
<h1 id="section-82"></h1>
<h4 id="something-more-challenging-to-try-out-at-later">Something more challenging to try out at later</h4>
<ul>
<li>Redesign the example moving the <code>extern</code> declarations to header files.</li>
<li>How could you - in header file <code>c-module.h</code> - cope with the fact that for a pure C compiler <code>extern &quot;C&quot; ...</code> is rather a syntax error?</li>
<li>Assume <code>void bar(double)</code> were also to be called from <code>c-main.c</code> - can this be achieved?</li>
<li>Could you come up with a <code>Makefile</code> to control the build steps of <code>c-main</code> and <code>cpp-main</code>?</li>
</ul>
<p>HINT (for the second step): search in some online documentation for C++ for the predefined macro <code>__CPLUSPLUS__</code>.</p>
</section>
<section class="slide level1" id="section-83">
<h1 id="section-83"></h1>
<h3 id="generating-call-wrappers-with-swig">Generating call wrappers with <a href="http://www.swig.org">SWIG</a></h3>
<p>A rather interresting thing to know about C and C++ is the ease with which modules implemented in C may be connected with most any of the scripting languages in widespread use today (and even a large number of the more exotic ones).</p>
<p>This is best shown in the example in directory <a href="CCppCode/Thermostate/Combined_SWIG">Thermostate/Combined_SWIG</a>.</p>
</section>
<section class="slide level1" id="section-84">
<h1 id="section-84"></h1>
<h4 id="something-to-look-at-later-if-you-have-no-other-ideas-2">Something to look at later (if you have no other ideas)</h4>
<p>If you actually consider to combine C/C++ modules with software written in a high level scripting language, some pretty good literature to start with is the SWIG-Tutorial: <a href="http://www.swig.org/tutorial.html"><code class="url">http://www.swig.org/tutorial.html</code></a>.</p>
</section>
<section class="slide level1" id="section-85">
<h1 id="section-85"></h1>
<h2 id="the-c-standard-library-overview">The C Standard Library (Overview)</h2>
<p>Outline of this lesson:</p>
<ul>
<li>String Operations</li>
<li>Input and Output</li>
<li>Mathematical Functions</li>
<li>Random Numbers</li>
<li>Raw Memory Access</li>
</ul>
</section>
<section class="slide level1" id="section-86">
<h1 id="section-86"></h1>
<h3 id="string-operations">String Operations</h3>
<p>The C String storage convention is to store individual characters at adjacent memory locations with the last character having the value <code>'\0'</code>.</p>
<p>Refering to the string is via the address of its first character.</p>
<p>Copying strings, comparing strings etc. requires the use of helper functions defined in the header file <code>&lt;string.h&gt;</code>, like:</p>
<ul>
<li><code>strcpy</code>,</li>
<li><code>strcmp</code></li>
</ul>
<p>A very basic use of the latter (in the form of <code>strncmp</code>) can be seen in the example program to guess <a href="CCppCode/Introductory/fgrep.c">Introductory/fgrep.c</a>.</p>
<p>For more information about the available functions look them up in an Online Reference: <a href="http://en.cppreference.com/w/c/string/byte"><code class="url">http://en.cppreference.com/w/c/string/byte</code></a>.</p>
</section>
<section class="slide level1" id="section-87">
<h1 id="section-87"></h1>
<h3 id="input-and-output">Input and Output</h3>
<p>Input and output is done via <code>FILE</code>-s, an opaque data structure and library functions working with it.</p>
<p>These functions are defined in the header file <code>&lt;stdio.h&gt;</code>.</p>
<p>The basic scheme can be seen in the program <a href="CCppCode/Introductory/fgrep.c">Introductory/fgrep.c</a>.</p>
<p>For a glimpse of formatted output see example <a href="CCppCode/Introductory/mathfunc.c">Introductory/mathfunc.c</a>.</p>
<p>For more information about the available functions look them up in an Online Reference: <a href="http://en.cppreference.com/w/c/io"><code class="url">http://en.cppreference.com/w/c/io</code></a>.</p>
</section>
<section class="slide level1" id="section-88">
<h1 id="section-88"></h1>
<h3 id="mathematical-functions">Mathematical Functions</h3>
<p>The header file to include is <code>&lt;math.h&gt;</code>.</p>
<p>A basic example that prints a table of trigonometric functions can be found in <a href="CCppCode/Introductory/mathfunc.c">Introductory/mathfunc.c</a>.</p>
<p>For more information about the available functions look them up in a Online Reference: <a href="http://en.cppreference.com/w/c/numeric/math"><code class="url">http://en.cppreference.com/w/c/numeric/math</code></a>.</p>
</section>
<section class="slide level1" id="section-89">
<h1 id="section-89"></h1>
<h4 id="something-to-do-soon-really-recommended">Something to do soon (really recommended)</h4>
<p>Register a book mark to your favorite online reference, like</p>
<ul>
<li>this one <a href="http://en.cppreference.com/w/"><code class="url">http://en.cppreference.com/w/</code></a></li>
<li>or that <a href="http://www.cplusplus.com/reference/"><code class="url">http://www.cplusplus.com/reference/</code></a></li>
</ul>
<p>because sooner ot later you will have to stand on your own feet and cannot rely one somebody else to drop the matching clickable links.</p>
</section>
<section class="slide level1" id="section-90">
<h1 id="section-90"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-9">Something to try out later (if you have no other ideas)</h4>
<p>More closely review the programs in</p>
<ul>
<li><a href="CCppCode/Introductory/fgrep.c">Introductory/fgrep.c</a> and</li>
<li><a href="CCppCode/Introductory/mathfunc.c">Introductory/mathfunc.c</a>.</li>
</ul>
<p>Add comments where things become clear to you (after some closer inspection) and maybe note down your questions you want to pose when walking through the programs with the instructor later on (probably on the next day).</p>
<p>When actually compiling the program to print the trigonometric functions have a close look to its head comment and try to remember (or find out with help of the fine manual) why there is an <code>-ml</code> in the command line and whether this option needs to be placed exactly there and not before the source file name.</p>
</section>
<section class="slide level1" id="section-91">
<h1 id="section-91"></h1>
<h3 id="random-numbers">Random Numbers</h3>
<p>In C there is a standard function <code>rand</code> which generates pseudo random numbers.</p>
<p>Its use may be very limited for practical reasons, so in C++ it was replaced with a more flexible facility.</p>
<p>See examples <a href="CCppCode/RandomNumbers/dice_rand.c">RandomNumbers/dice_rand.c</a> and <a href="CCppCode/RandomNumbers/dice_random.cpp">RandomNumbers/dice_random.cpp</a>.</p>
</section>
<section class="slide level1" id="section-92">
<h1 id="section-92"></h1>
<h3 id="raw-memory-access">Raw Memory Access</h3>
<p>There are some low level functions that just move around or compare bytes in memory, like:</p>
<ul>
<li><code>memcopy</code></li>
<li><code>memmove</code></li>
<li><code>memcmp</code></li>
</ul>
<p>If you are interrested, you may lookup their use in the online documentation.</p>
</section>
<section class="slide level1" id="section-93">
<h1 id="section-93"></h1>
<h4 id="something-to-look-at-later-if-you-have-no-other-ideas-3">Something to look at later (if you have no other ideas)</h4>
<ul>
<li><p>What is the challenge when copying data between overlapping memory regions?</p></li>
<li><p>Which one of the library functions does it in the right way and why may the other one exist?</p></li>
</ul>
<p>Can you come up with a test program that shows the problem and also compares memory footprint and performance of both versions?</p>
</section>
<section class="slide level1" id="section-94">
<h1 id="section-94"></h1>
<h3 id="basic-types-and-conversions">Basic Types and Conversions</h3>
<p>Conversion between the various arithmetic types are done automatically (i.e. the compiler adds the necessary code for type coercions at runtime) and in addition will typically flag value changing conversions with a warning.</p>
<p>Some practical examples may be found in several programs that have been shown so far and will be shown in future.</p>
</section>
<section class="slide level1" id="section-95">
<h1 id="section-95"></h1>
<h4 id="something-you-might-want-to-do-later-if-you-have-no-other-ideas">Something you might want to do later (if you have no other ideas)</h4>
<p>Write some small programs that demonstrate compiler warnings - or even errors when the uniform initialization syntax new in C++11 is used - in case of value changing or potentially value changing operations.</p>
<p>Furthermore, if you are really hot on this topic find out what <code>numeric_cast</code> in the <a href="http://www.boost.org">Boost Library</a> is good for.</p>
</section>
<section class="slide level1" id="section-96">
<h1 id="section-96"></h1>
<h3 id="operations-for-basic-types">Operations for Basic Types</h3>
<p>Covered in an overview style in AToC $1.5 (from page 5).</p>
<p>Practical examples can be found in most any program presented during this training.</p>
<p>For an embedded software developer working close to the hardware operations on single bits may sometimes be of special interrest, so the next examples will highlight these.</p>
</section>
<section class="slide level1" id="section-97">
<h1 id="section-97"></h1>
<h4 id="bit-operations---a-practical-example">Bit Operations - A Practical Example</h4>
<p>The following is (nearly) an excerpt from the source <a href="CCppCode/Smileys/smiley_zprint1.c">Smileys/smiley_zprint1.c</a>.</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="kw">if</span> (pic_zdata[(i*width + j)/<span class="dv">8</span>] &amp; (<span class="dv">1</span> &lt;&lt; (k++ % <span class="dv">8</span>)))
    putchar(&#39;*&#39;);
<span class="kw">else</span>
    putchar(&#39; &#39;);</code></pre>
<p>Besides indexing, multiplication, division, modulus, and (post-) increment the following bit operators are used:</p>
<ul>
<li>bitwise left shift (<code>&lt;&lt;</code>)</li>
<li>bitwise and (<code>&amp;</code>)</li>
</ul>
</section>
<section class="slide level1" id="section-98">
<h1 id="section-98"></h1>
<h4 id="introducing-temporaries-for-readability">Introducing Temporaries for Readability</h4>
<p>To make the code better understandable the large expression should be broken into smaller parts that can be easily explained by comments:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">const</span> <span class="dt">int</span> effidx = (i*width + j)/<span class="dv">8</span>;             <span class="co">/* effective index */</span>
<span class="dt">const</span> <span class="dt">int</span> bitpos = (k++ % <span class="dv">8</span>);                   <span class="co">/* bit position */</span>
<span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> mask = (<span class="dv">1</span> &lt;&lt; bitpos);       <span class="co">/* bit to mask out */</span>
<span class="dt">const</span> <span class="dt">int</span> prtmark = pic_zdata[effidx] &amp; mask;   <span class="co">/* print marker ? */</span>
<span class="kw">if</span> (prtmark)
    putchar(&#39;*&#39;);
<span class="kw">else</span>
    putchar(&#39; &#39;);</code></pre>
<p>It may be a matter of personal test wether you stay with rather short variable names that you explain in a comment or rather use longer names telling the purpose more clearly and go without a comment.</p>
</section>
<section class="slide level1" id="section-99">
<h1 id="section-99"></h1>
<h4 id="the-conditional-expression">The Conditional Expression</h4>
<p>Using a C specialty, the conditional expression, the output of either an asterisk or a space can be rewritten as:</p>
<pre class="sourceCode c"><code class="sourceCode c">putchar(prtmark ? &#39;*&#39; : &#39; &#39;);</code></pre>
<p>The semantics of this operation are simple:</p>
<ul>
<li>The first part (left to the question mark) is evaluated for its logic value
<ul>
<li><code>true</code> (or anything that is non-zero) or</li>
<li><code>false</code> (or anything that is zero)</li>
</ul></li>
<li>Depending on this, the overall result is
<ul>
<li>either the second operand between <code>?</code> and <code>:</code></li>
<li>or the third operand after <code>:</code></li>
</ul></li>
</ul>
</section>
<section class="slide level1" id="section-100">
<h1 id="section-100"></h1>
<h4 id="structuring-using-spaces">Structuring Using Spaces</h4>
<p>Putting it all into a single expression again, at least the structure imposed by the conditional expression should be made standout a bit better by adding spaces and line breaks:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="co">/* You are not expected to understand this. */</span>
putchar(
    pic_zdata[(i*width + j)/<span class="dv">8</span>] &amp; (<span class="dv">1</span> &lt;&lt; (k++ % <span class="dv">8</span>))
        ? &#39;*&#39;
        : &#39; &#39;
);</code></pre>
<p>(I took the freedom to add a <a href="http://cm.bell-labs.com/who/dmr/odd.html">classic comment</a> above, originating from the source code of Unix Version 6, the precursor of Unix Version 7 which once ran on a DEC PDP/11 and became the first Unix variant used outside Bell Labs in the late 70s.)</p>
</section>
<section class="slide level1" id="section-101">
<h1 id="section-101"></h1>
<h4 id="something-you-might-try-out-if-you-have-no-other-ideas">Something you might try out (if you have no other ideas)</h4>
<p>Among software developers there is often some degree of reluctance to introduce temporaries for redability.</p>
<ul>
<li>Can you second that - do temporaries cause more or slower code?</li>
<li>Or rather negate - i.e. such temporaries are optimised away?</li>
</ul>
</section>
<section class="slide level1" id="section-102">
<h1 id="section-102"></h1>
<h4 id="something-else-you-might-try-out-if-you-have-no-other-ideas">Something else you might try out (if you have no other ideas)</h4>
<p>And what about the conditional expression - what is their influence on the code generated?</p>
<p>To isolate the interresting part you may want to try something like this:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">extern</span> <span class="dt">void</span> bar(<span class="dt">char</span>);
<span class="dt">void</span> foo(<span class="dt">bool</span> b) { <span class="kw">if</span> (b) bar(&#39;*&#39;); <span class="kw">else</span> bar(&#39; &#39;); }</code></pre>
<p>And in comparision:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> foo(<span class="dt">bool</span> b) { bar(b ? &#39;*&#39; : &#39; &#39;); }</code></pre>
<p>Or:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> foo(<span class="dt">bool</span> b) { <span class="dt">const</span> <span class="dt">char</span> c = b ? &#39;*&#39; : &#39; &#39;); bar(c); }</code></pre>
</section>
<section class="slide level1" id="section-103">
<h1 id="section-103"></h1>
<h3 id="pointers-arrays-and-address-arithmetic">Pointers, Arrays and Address Arithmetic</h3>
<p>Arrays decays into pointers whenever their name is used in a context other</p>
<ul>
<li>determining memory space with <code>sizeof</code></li>
<li>applying the <em>address-of</em> operator <code>&amp;</code></li>
</ul>
<p>as demonstrated in <a href="CCppCode/Introductory/sizeof_subtleties.c">Introductory/sizeof_subtleties.c</a></p>
<p>and <a href="CCppCode/Introductory/array_subtleties.c">Introductory/array_subtleties.c</a>.</p>
</section>
<section class="slide level1" id="section-104">
<h1 id="section-104"></h1>
<h4 id="arrays-as-arguments">Arrays as Arguments</h4>
<p>The key point to understand <strong>when arrays are handed over via an argument list</strong> is that the following has the same meaning:</p>
<ul>
<li><code>int *arr</code></li>
<li><code>int arr[]</code></li>
</ul>
<p>Putting it differently: when handing over an array its size gets lost (and hence would have to be specified via another argument to the callee).</p>
</section>
<section class="slide level1" id="section-105">
<h1 id="section-105"></h1>
<h4 id="two-dimensional-arrays">Two Dimensional Arrays</h4>
<p>Here the key point to understand is that the inner dimension <strong>which is specified more to the right</strong> will actually be important for address calculations, i.e. with</p>
<pre class="sourceCode c"><code class="sourceCode c">T data[<span class="dv">15</span>][<span class="dv">25</span>];</code></pre>
<p>in an expression like <code>... data[i][j] ...</code> the offset to calculate from the start address (<code>&amp;data[0][0]</code>) is:</p>
<ul>
<li><code>25*i + j</code> if calculating in units of the size of a single <code>T</code>, or</li>
<li><code>(sizeof (T))*(25*i + j)</code> in a byte-based low level calculation.</li>
</ul>
</section>
<section class="slide level1" id="section-106">
<h1 id="section-106"></h1>
<h4 id="something-to-try-yourself-later-...">Something to try yourself later ...</h4>
<p>In example <a href="CCppCode/Smileys/smiley_print1.c">Smileys/smiley_print1.c</a> there is a two dimensional array handed over to the <code>printer</code> function.</p>
<ul>
<li>Which of the two dimensions in square brackets can be dropped when handing over <code>pic_data</code> via the argument <code>pic</code>?</li>
<li>What happens if you both dimensions in the parameter specification of the argument list are dropped?</li>
<li>Is it possible to hand over the array <code>pic_data</code> as if it had only one dimension and leave it up to <code>printer</code> to interpret the two dimensions as it likes to?</li>
</ul>
<p>If you don't want to try this yourself, just continue to the next section.</p>
</section>
<section class="slide level1" id="section-107">
<h1 id="section-107"></h1>
<h4 id="or-rather-to-look-in-the-solution">... or rather to look in the solution?</h4>
<p>The internal address calculation that is necessary for double indexing shows explicitely in <a href="CCppCode/Smileys/smiley_print2.c">Smileys/smiley_print2.c</a> like this:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">void</span> printer(<span class="dt">int</span> pic[], <span class="dt">int</span> height, <span class="dt">int</span> width) {
    <span class="co">// ...</span>
           putchar(pic[i*width + j] ? &#39;*&#39; : &#39; &#39;);
    <span class="co">// ...</span>
}</code></pre>
<p>But due to the change of the parameter type, also the call now has to change:</p>
<pre class="sourceCode c"><code class="sourceCode c">        printer(pic_data[<span class="dv">0</span>], <span class="dv">14</span>, <span class="dv">25</span>);</code></pre>
<p>Explain!</p>
</section>
<section class="slide level1" id="section-108">
<h1 id="section-108"></h1>
<h3 id="introducing-reference-type-variables">Introducing Reference Type Variables</h3>
<p>At this point I could have inserted about a dozen pages one after the other holding each of the sections from this introductory comparison: <a href="CCppCode/Introductory/ptr_vs_ref.cpp">Introductory/ptr_vs_ref.cpp</a></p>
<p>My proposal is we rather walk through the code together and later on you repeat it once more on yourself, maybe applying small modifications at points of special interrest, like enabling code that will not compile to see what error messages you get from the compiler.</p>
<p>But first some facts that apply universally and should help to understand differences and commonalities.</p>
</section>
<section class="slide level1" id="section-109">
<h1 id="section-109"></h1>
<h4 id="reference-vs.-pointer-type-variables">Reference vs. Pointer Type Variables</h4>
<p>It should be noted that the difference is mainly in the syntax, not in the implementation, because technically both, a pointer and a reference, simply hold an address.</p>
<p>But be aware: if you do an assembly code analyses of a simple program comparing references and pointers, you might not see them at all as the compiler may have taken the chance to optimise them out. The best chance you get is when you compile for debugging (<code>g++ -O0 ...</code>).</p>
</section>
<section class="slide level1" id="section-110">
<h1 id="section-110"></h1>
<h4 id="some-facts-about-pointers">Some Facts About Pointers</h4>
<p>A pointer is more explicit as a reference:</p>
<ul>
<li>A pointer by itself denotes the address it holds and therefore must be explictely derefeneced with <code>*</code> to get to the content.</li>
<li>To initialise (or assign to) a pointer an address must be explicitely specified and therefore, if a pointer is set to point to some variable, the address-of operator (<code>&amp;</code>) has to be prefixed to the variable's name.</li>
<li>Taking the address of the pointer itself gives the memory location where the pointer is stored.</li>
</ul>
</section>
<section class="slide level1" id="section-111">
<h1 id="section-111"></h1>
<h4 id="some-facts-about-rereferences">Some Facts about Rereferences</h4>
<p>A reference is more like an alias:</p>
<ul>
<li>If a reference is set to refer to some variable, only the name of the variable is given - though, behind the scenes, its address is taken too.</li>
<li>Afterwards a reference accesses the content already in its plain use, i.e. dereferencing is always implied.</li>
<li>Applying the adress-of operator (<code>&amp;</code>) to a reference gives the memory location of the variable for which the reference is an alias.</li>
</ul>
</section>
<section class="slide level1" id="section-112">
<h1 id="section-112"></h1>
<h4 id="and-now-its-time-for-the-code-walk">And Now It's Time For the Code Walk</h4>
<p><strong>Remember to repeat this once more on your own!</strong></p>
<p>Also note: though in this demonstration code comparing pointers to references plain variables were used for simplicity, the more realisitic and important use case for pointers and references are function arguments.</p>
<p>And now: <a href="CCppCode/Introductory/ptr_vs_ref.cpp">Introductory/ptr_vs_ref.cpp</a></p>
</section>
<section class="slide level1" id="section-113">
<h1 id="section-113"></h1>
<h4 id="swapping-variables-using-references">Swapping Variables Using References</h4>
<p>This is the classic example to demonstrate references - a function swapping the content of two variables.</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> swap(<span class="dt">int</span> &amp;rx, <span class="dt">int</span> &amp;ry) {
        <span class="dt">const</span> <span class="dt">int</span> tmp = rx;
        rx = ry;
        ry = tmp;
}</code></pre>
<p>At the call site just the variables will have to be named:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> x, y;
<span class="co">// ...</span>
swap(x, y);</code></pre>
</section>
<section class="slide level1" id="section-114">
<h1 id="section-114"></h1>
<h4 id="swapping-variables-using-pointers">Swapping Variables Using Pointers</h4>
<p>The following is the C version with pointers:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">void</span> swap(<span class="dt">int</span> *px, <span class="dt">int</span> *py) {
        <span class="dt">const</span> <span class="dt">int</span> tmp = *px;
        *px = *py;
        *py = tmp;
}</code></pre>
<p>The call site then will have to apply the adress-of operator (<code>&amp;</code>) to the variables:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> x, y;
<span class="co">// ...</span>
swap(x, y);</code></pre>
</section>
<section class="slide level1" id="section-115">
<h1 id="section-115"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-10">Something to try out later (if you have no other ideas)</h4>
<p>Understand commonalities and differences between pointers and references by analysing the assembler code of <a href="CCppCode/Introductory/swap_ref.cpp">Introductory/swap_ref.cpp</a> and that of <a href="CCppCode/Introductory/swap_ptr.c">Introductory/swap_ptr.c</a>.</p>
</section>
<section class="slide level1" id="section-116">
<h1 id="section-116"></h1>
<h4 id="something-else-to-try-out-later-if-you-have-no-other-ideas-1">Something else to try out later (if you have no other ideas)</h4>
<p>This is only remotely related, as it has nothing to do with pointers or references but with swapping. Some people use a seemingly clever trick to swap the content of integral values:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> swap(<span class="dt">int</span> &amp;rx, <span class="dt">int</span> &amp;ry) {
        <span class="dt">const</span> <span class="dt">int</span> tmp = rx;
        rx = ry;
        ry = tmp;
}</code></pre>
<p>A full example with a <code>main</code> program to compile to executable code can be found in <a href="CCppCode/Introductory/swap_xor.c">Introductory/swap_xor.c</a>.</p>
<ul>
<li>Discuss the pros and cons of the above (maybe based on an assembly analysis and comparison with the functions using a temporary).</li>
<li>Can you also spot a possible pitfall where the above fails grossly while it goes harmless with the temporary variable variant?</li>
</ul>
</section>
<section class="slide level1" id="section-117">
<h1 id="section-117"></h1>
<h4 id="reference-or-pointer---which-one-to-prefer">Reference or Pointer - Which One to Prefer?</h4>
<p>The following may be used as a rule of thumb:</p>
<ul>
<li><p>In code that is or may be compiled with pure C, stay with pointers.</p></li>
<li>Otherwise prefer references, <em>unless</em>
<ul>
<li>During its lifetime the referrer will refer to different entities, and/or</li>
<li>you need a simple way to represent: &quot;there's nothing to reference&quot;.</li>
</ul></li>
</ul>
<p>In the latter case, the pointer will have the value <code>nullptr</code> - or <code>0</code> or <code>NULL</code> - see AToC §1.8 (page 12).</p>
<p><strong>Pointers will typically be tested against <code>nullptr</code> before the dereferencing operation (<code>*</code>) is applied!</strong></p>
</section>
<section class="slide level1" id="section-118">
<h1 id="section-118"></h1>
<h4 id="something-advanced-you-might-consider-later-if-you-have-no-other-ideas">Something advanced you might consider later (if you have no other ideas)</h4>
<p>What do YOU think - is there also an equivalent to the <code>nullptr</code> possible with references, could a reference refer to &quot;nothing&quot; (i.e. &quot;nothing valid&quot;).</p>
<ul>
<li>How could it happen deliberately?</li>
<li>How could it happen by accident?</li>
<li>How to test for this case?</li>
</ul>
<p>But especially and most important:</p>
<ul>
<li>Does it make sense?</li>
</ul>
</section>
<section class="slide level1" id="section-119">
<h1 id="section-119"></h1>
<h2 id="static-type-checking-and-robust-code">Static Type Checking and Robust Code</h2>
<p>Data types were one of the major improvements early high level language added to coding in assembler. (The other one was structured control flow.)</p>
<ul>
<li>Viewn at the low level, type safety makes the compiler chose the right operations at assembly level.</li>
<li>Viewn from the high level, type safety turns meaningless operations that are typically rather errors on the side of the developer into compile time errors.</li>
</ul>
</section>
<section class="slide level1" id="section-120">
<h1 id="section-120"></h1>
<h3 id="implicit-type-conversions">Implicit Type Conversions</h3>
<p>These take place between all basic arithmetic types and extend to pointers in both, C and C++, and Booleans (in C++ only).</p>
<ul>
<li>Any arithmetic value which is not zero converts to <code>true</code> as a Boolean or more generally, in any context where it is used as a condition.</li>
<li>Any pointer that does <strong>not</strong> compare equal to <code>nullptr</code> (C++11 only) or <code>0</code> or <code>NULL</code> (traditional notations) is taken to be <code>true</code>.</li>
</ul>
</section>
<section class="slide level1" id="section-121">
<h1 id="section-121"></h1>
<h4 id="implicit-pointer-conversions-in-c">Implicit Pointer Conversions in C</h4>
<p>The rule is:</p>
<ul>
<li>Each kind of typed pointer can be assigned to an untyped pointer (<code>void *</code>).</li>
<li>An untyped pointer (<code>void *</code>) can be assigned to each kind of typed pointer.</li>
</ul>
<p>Though:</p>
<ul>
<li><strong>Differently typed pointers are never compatible with each other.</strong></li>
</ul>
<p>(You see where a major hole is punched into the type system of C, giving proponents of other languages the justification to claim: &quot;C is not strictly type-checked&quot;?)</p>
</section>
<section class="slide level1" id="section-122">
<h1 id="section-122"></h1>
<h4 id="implicit-pointer-conversions-in-c-1">Implicit Pointer Conversions in C++</h4>
<p>The rule is:</p>
<ul>
<li>Each kind of typed pointer can be assigned to an untyped pointer (<code>void *</code>).</li>
<li><strong>An untyped pointer (<code>void *</code>) CAN NOT be assigned to a typed pointer.</strong></li>
</ul>
<p>(C++ is closing a big hole in the type checking system by making these conversions a one-way-road.)</p>
<p>And also:</p>
<ul>
<li>Two differently typed pointers are not directly compatible with each other,</li>
<li>except that a derived class is compatible with its base class(es).</li>
</ul>
<p><strong>More on base and derived classes follow later.</strong></p>
</section>
<section class="slide level1" id="section-123">
<h1 id="section-123"></h1>
<h3 id="explicit-type-conversions">Explicit Type Conversions</h3>
<p>Such are also called <em>Cast Operations</em> and their syntax is:</p>
<ul>
<li><p>A type in round parenthesis followed by an expression in C (and still C++ too because of downward compatibility).</p></li>
<li>One out of four keywords (see next pages)</li>
<li>followed by a type in angle brackets</li>
<li><p>followed by an expression in round parenthesis.</p></li>
</ul>
<p>In both forms the value of the expression is converted to the given type.</p>
<p>(For a rather short coverage see AToC §14.2.4 page 161.)</p>
</section>
<section class="slide level1" id="section-124">
<h1 id="section-124"></h1>
<h4 id="conversion-with-static_cast">Conversion with <code>static_cast</code></h4>
<p>There are two main areas where such can be applied:</p>
<ul>
<li>Avoid warnings for conversions that would result from conversions the compiler applies automatically.</li>
<li>Turn down-casts in class hierarchies into <em>no-ops</em>.</li>
</ul>
<p>For the former see <a href="CCppCode/Introductory/warnings.c">Introductory/warnings.c</a>, <a href="CCppCode/Introductory/no_warnings.c">Introductory/no_warnings.c</a>, and <a href="CCppCode/Introductory/no_warnings.cpp">Introductory/no_warnings.cpp</a>.</p>
<p>The latter will be covered later.</p>
</section>
<section class="slide level1" id="section-125">
<h1 id="section-125"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-11">Something to try out later (if you have no other ideas)</h4>
<p>The following is not directly related to conversion warnings but may be of interest too:</p>
<p>Look up what other warnings <code>gcc</code> and <code>g++</code> are able to issue with</p>
<ul>
<li><code>gcc --help=warning</code> or</li>
<li><code>g++ --help=warning</code>.</li>
</ul>
<p>Can you get <code>gcc</code> and <code>g++</code> to warn about unused variables and arguments and missing return values?</p>
</section>
<section class="slide level1" id="section-126">
<h1 id="section-126"></h1>
<h4 id="something-else-to-try-out-later-if-you-have-no-other-ideas-2">Something else to try out later (if you have no other ideas)</h4>
<p>What happens when you use the new C++-style initialisation for the variables, i.e.</p>
<pre><code>short a{y}; // instead of: short a = y;
int b{3.14};    // instead of: int b = 3.14;</code></pre>
<p>etc. and compile with <code>g++ -std=c++0x ...</code>?</p>
</section>
<section class="slide level1" id="section-127">
<h1 id="section-127"></h1>
<h4 id="conversion-with-const_cast">Conversion with <code>const_cast</code></h4>
<p>Temporarily remove compile time protection from non-modifiable entities.</p>
<p>This may sometimes seem to be required but may have strange effects.</p>
<p>In other words, you might write code like this (for whatever purpose):</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> main() {
    <span class="dt">const</span> <span class="dt">int</span> answer_to_the_ultimate_question_of_life = <span class="dv">42</span>;
    <span class="co">// ...</span>
    <span class="kw">const_cast</span>&lt;<span class="dt">int</span> &amp;&gt;(answer_to_the_ultimate_question_of_life) = <span class="dv">43</span>;
    <span class="co">// ...</span>
}</code></pre>
<p>The full demo is in <a href="CCppCode/Introductory/const_cast.cpp">Introductory/const_cast.cpp</a>.</p>
</section>
<section class="slide level1" id="section-128">
<h1 id="section-128"></h1>
<h4 id="what-we-together-could-do-now-or-you-can-try-on-your-own-later">What we together could do now (or you can try on your own later)</h4>
<p>Compile and run the demo program, find an explanation for its partially strange behavior, and confirm these by trying further modifications.</p>
<p>The general rule is (more or less):</p>
<ul>
<li>As long as something originally non-const is handed over unmodifiable, you may succeed casting away const and actually see or not see the modifications made.</li>
<li>As it is hard to find a precise wording for this &quot;may or may not&quot; and casting away constness may even crash the program, the ISO standard simply turned all <code>const_cast</code>-ing into be <em>undefined behaviour</em>.</li>
</ul>
<p>With that, the compiler has any freedom to enforce constness or give leeway.</p>
</section>
<section class="slide level1" id="section-129">
<h1 id="section-129"></h1>
<h4 id="conversion-with-reinterpret_cast">Conversion with <code>reinterpret_cast</code></h4>
<p>Such allow to turn anything into anything and will especially be required in embedded programming to set up pointers (or references) to reach device registers for doing memory-mapped I/O.</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">volatile</span> <span class="kw">struct</span> uart {
    <span class="dt">unsigned</span> <span class="dt">char</span> in;
    <span class="dt">unsigned</span> <span class="dt">char</span> out;
    <span class="dt">unsigned</span> <span class="dt">short</span> ctl;
} *serial_port = <span class="kw">reinterpret_cast</span>&lt;<span class="kw">struct</span> uart *&gt;(<span class="bn">0xAFFE</span>);
<span class="co">// ...</span>
serial_port-&gt;out = &#39;z&#39;; <span class="co">// send character</span>
<span class="kw">while</span> (!serial_port.ctl &amp; (<span class="dv">1</span> &lt;&lt; <span class="dv">12</span>))
    ; <span class="co">// wait for send completes</span></code></pre>
<p>(... assuming bit 13 in the control register is some kind of ready indicator ...)</p>
</section>
<section class="slide level1" id="section-130">
<h1 id="section-130"></h1>
<h4 id="conversion-with-dynamic_cast">Conversion with <code>dynamic_cast</code></h4>
<p>The main area where this is applied is with down-casts in class hierarchies that do some checking (and avoid complete havoc on failure). It will therefore be covered later together with <em>runtime type identification</em> (aka. RTTI).</p>
</section>
<section class="slide level1" id="section-131">
<h1 id="section-131"></h1>
<h3 id="type-safe-io-in-c">Type-safe I/O in C++</h3>
<p>See AToC §8 (from page 85)</p>
</section>
<section class="slide level1" id="section-132">
<h1 id="section-132"></h1>
<h3 id="other-areas-improved-by-c">Other Areas Improved by C++</h3>
<p>Besides the big &quot;add on&quot;-s that will receive chapters of their own there is a number of small areas where C++ has been improved over C, most of which would be nice to have available for C programming too ...</p>
<p>... so they may give some justification to compile &quot;purce C&quot; with <code>g++</code>.</p>
<ul>
<li>Function overloading and default arguments.</li>
<li>Range-based syntax for <code>for</code>-loops.</li>
<li>Narrower scope and selectable representation for enumerations.</li>
<li>Type-safe allocation and better alignment control for heap memory.</li>
<li>...</li>
</ul>
<p>(just to name a few)</p>
</section>
<section class="slide level1" id="section-133">
<h1 id="section-133"></h1>
<h4 id="default-arguments">Default Arguments</h4>
<p>This is a quite simple feature, e.g. a function that throws a dice could take defaults arguments for the range 1..6 but allow other values too:</p>
<pre><code>int dice(int from = 1, int to = 6) {
    return from + rand() % (to - from + 1);
}</code></pre>
<p>If the above were just a prototype declaration, it could be written</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> dice(<span class="dt">int</span> from = <span class="dv">1</span>, <span class="dt">int</span> to = <span class="dv">6</span>);</code></pre>
<p>as well as:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> dice(<span class="dt">int</span> = <span class="dv">1</span>, <span class="dt">int</span> = <span class="dv">6</span>);</code></pre>
</section>
<section class="slide level1" id="section-134">
<h1 id="section-134"></h1>
<h4 id="something-you-may-want-to-think-about-later-or-even-now">Something you may want to think about later (or even now)</h4>
<p>Why do default values have to go with the prototype declaration and not with the implementation?</p>
<p>Furthermore: Given that with the parametrization shown the following calls are possible</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">dice();     <span class="co">// throws 1..6</span>
dice(<span class="dv">3</span>);    <span class="co">// throws 3..6</span>
dice(<span class="dv">0</span>, <span class="dv">1</span>); <span class="co">// throws 0..1</span></code></pre>
<p>why would the order of arguments better be changed if the most typical use case were to vary the upper limit only leaving the lower limit at <code>1</code>?</p>
</section>
<section class="slide level1" id="section-135">
<h1 id="section-135"></h1>
<h4 id="function-overloading">Function Overloading</h4>
<p>While you can specify arguments of completly different types</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> print(<span class="dt">const</span> <span class="dt">char</span> *name, <span class="dt">int</span> value);
<span class="dt">void</span> print(<span class="dt">const</span> <span class="dt">char</span> *name, <span class="dt">double</span> value);</code></pre>
<p>or different length argument lists</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> dice(<span class="dt">int</span> from, <span class="dt">int</span> to);  <span class="co">// see above</span>
<span class="dt">int</span> dice(<span class="dt">int</span> to) { <span class="kw">return</span> dice(<span class="dv">1</span>, to); }</code></pre>
<p>the more interresting part is how constness and references attribute to the mechanism.</p>
</section>
<section class="slide level1" id="section-136">
<h1 id="section-136"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-12">Something to try out later (if you have no other ideas)</h4>
<p>Go through the example <a href="CCppCode/Introductory/overload_details.cpp">Introductory/overload_details.cpp</a> to understand which of several overloaded functions is selected in each case.</p>
<p>Test your understanding by slightly modifying the example to leave out some of the overloads or add other possibilities.</p>
</section>
<section class="slide level1" id="section-137">
<h1 id="section-137"></h1>
<h2 id="major-steps-in-the-evolution-of-c">Major Steps in the Evolution of C++</h2>
<p>The main purpose of this section is to introduce the terminolgy used to denote some major versions and extensions of the C++ language and to understand how these parts relate to each other.</p>
<p>See AToC $14.1.1 (from page 154).</p>
</section>
<section class="slide level1" id="section-138">
<h1 id="section-138"></h1>
<h3 id="from-a-de-facto-standard-to-c98">From a &quot;de facto Standard&quot; to C++98</h3>
<p>See AToC $14.1.2 (from page 155).</p>
</section>
<section class="slide level1" id="section-139">
<h1 id="section-139"></h1>
<h3 id="informal-extension-by-tr1">Informal Extension by TR1</h3>
<p>Besides official ISO standards there have sometimes been inofficial extensions like <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1836.pdf">TR1</a> or documents dealing with special areas like the <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/TR18015.pdf">Performance of C++</a>, the latter having a special impact on embedded programming.</p>
</section>
<section class="slide level1" id="section-140">
<h1 id="section-140"></h1>
<h3 id="the-role-of-the-boost-platform">The Role of the Boost Platform</h3>
<p>In the finalizing phase of the first ISO standard for C++ a number of comitee members as well as interrested persons from outside founded the <em>Boost Group</em> which since then has stimulated the development of many extensions libraries which are publicly available at: <a href="http://www.boost.org"><code class="url">http://www.boost.org</code></a></p>
<p>Those with a very common applicability have often been a model for a similar or even identical feature finally standardised with C++11.</p>
</section>
<section class="slide level1" id="section-141">
<h1 id="section-141"></h1>
<h3 id="adopting-the-c11-standard">Adopting the C++11 Standard</h3>
<p>Now, nearly three years after the new C++ standard (formerly known as C++0x) has been finished, and about five years after this new version of C++ has been feature complete, still not all compilers offer all of the language and library.</p>
<p>An overview can be found here: <a href="https://wiki.apache.org/stdcxx/C++0xCompilerSupport"><code class="url">https://wiki.apache.org/stdcxx/C++0xCompilerSupport</code></a></p>
</section>
<section class="slide level1" id="section-142">
<h1 id="section-142"></h1>
<h3 id="future-directions">Future Directions</h3>
<p>Working groups have already been formed to discuss future directions of C++.</p>
<ul>
<li>What is currently named <a href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3690.pdf">C++14</a> will rather cleanup some minor issues, not again add major features to the language.</li>
<li>A major release is currently planned under the name <a href="http://isocpp.org/std/status">C++17</a>.</li>
</ul>
</section>
<section class="slide level1" id="section-143">
<h1 id="section-143"></h1>
<h2 id="first-stations-on-the-road-from-c-to-c">First Stations on the Road from C to C++</h2>
<p>Again for a first overview and introduction to the topics that follow let's look at AToC §4 (from page 33).</p>
</section>
<section class="slide level1" id="section-144">
<h1 id="section-144"></h1>
<h3 id="structuring-data">Structuring Data</h3>
<p>Purely combining related data in a struct is the first step like shown in <a href="CCppCode/Thermostate/Using_a_struct/thermostate.h">Thermostate/Using_a_struct/thermostate.h</a> and <a href="CCppCode/Thermostate/Using_a_struct/thermostate.c">Thermostate/Using_a_struct/thermostate.c</a></p>
<p>Note that this can still be compiled as pure C.</p>
</section>
<section class="slide level1" id="section-145">
<h1 id="section-145"></h1>
<h4 id="something-to-complete-later-if-you-want-to">Something to complete later (if you want to)</h4>
<p>Complete this example with respect to the other parts that have been once available in <a href="CCppCode/Thermostate/Using_a_struct">Thermostate/Using_a_struct</a>.</p>
</section>
<section class="slide level1" id="section-146">
<h1 id="section-146"></h1>
<h3 id="encapsulating-data-and-operations">Encapsulating Data and Operations</h3>
<p>Turning the thermostate example into a class will be done as a live demo.</p>
<p>For applying the initial idea see: <a href="CCppCode/Thermostate/Using_a_class_v1">Thermostate/Using_class_v1</a></p>
</section>
<section class="slide level1" id="section-147">
<h1 id="section-147"></h1>
<h3 id="user-defined-types-and-type-safety">User defined Types and Type Safety</h3>
<p>Classes constitue user defined types and as such should make available all the operations they support.</p>
<p><strong>Have the object instance do for you what needs to be done - don't handle its data from the outside!</strong></p>
<p>For applying more C++ features see: <a href="CCppCode/Thermostate/Using_a_class_v2">Thermostate/Using_class_v2</a></p>
</section>
<section class="slide level1" id="section-148">
<h1 id="section-148"></h1>
<h4 id="something-to-complete-later-if-you-want-to-1">Something to complete later (if you want to)</h4>
<p>Complete this example with respect to the other parts that have been once available in</p>
<ul>
<li><a href="CCppCode/Thermostate/Using_a_class_v1">Thermostate/Using_a_class_v1</a> or</li>
<li><a href="CCppCode/Thermostate/Using_a_class_v2">Thermostate/Using_a_class_v2</a>.</li>
</ul>
<p>(Depending on the steps saved doing the live demo there may be more intermediate versions - so if you particular diligent this afternoon you may complete all of them).</p>
</section>
<section class="slide level1" id="section-149">
<h1 id="section-149"></h1>
<h3 id="const-based-overloading-of-member-functions">Const-based Overloading of Member Functions</h3>
<p>In addition to the overloading possibilities for plain functions, also the <code>const</code> after the member function name is part of the signature.</p>
<p>So you can do the following:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">class</span> MyVector {
    <span class="co">// ...</span>
    <span class="dt">double</span> &amp;at(<span class="dt">int</span> index) { ... }
    <span class="dt">const</span> <span class="dt">double</span> &amp;at(<span class="dt">int</span> index) <span class="dt">const</span> { ... }
};</code></pre>
<p>(If the meaning of this keyword at that position did escape your attention, see AToC §4.2.1 page 35.)</p>
</section>
<section class="slide level1" id="section-150">
<h1 id="section-150"></h1>
<h3 id="member-data-and-operations">Member Data and Operations</h3>
<p>Data and operations encapsulated inside a class are individual for each object (instance) of this class.</p>
<ul>
<li>The code generated to access some data member has to use the object address as base (adding a member specific offset).</li>
<li>Any member function receives the object (instance) address as additional argument.</li>
</ul>
<p>Of course, the usual opitmizations may take place - especially such involved with inlining.</p>
<p>(If you have forgotten about inlining see AToC §4.2.1 page 35.)</p>
</section>
<section class="slide level1" id="section-151">
<h1 id="section-151"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-13">Something to try out later (if you have no other ideas)</h4>
<p>Run an assembly analyses over some code generated on behalf of structs or classes and their members (data and functions) and observe the effects of inlining.</p>
</section>
<section class="slide level1" id="section-152">
<h1 id="section-152"></h1>
<h3 id="class-data-and-operations">Class Data and Operations</h3>
<p>C++ provides an easy means to associate data not with objects (instances) but with their class by adding the keyword <code>static</code>.</p>
<ul>
<li>In effect this introduces just scoped global data and</li>
<li>scoped global functions (with special access rights).</li>
</ul>
<p>No, you didn't miss anything so far, this is NOT covered in AToC.</p>
<p>As a substitute here is a link to that feature in <a href="http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=%2Fcom.ibm.xlcpp8l.doc%2Flanguage%2Fref%2Fcplr038.htm">IBM's compiler documentation</a></p>
</section>
<section class="slide level1" id="section-153">
<h1 id="section-153"></h1>
<h4 id="short-insertion-about-the-ibm-documentation">Short Insertion About the IBM Documentation</h4>
<p>The documentation linked on the last page is very well and good structured if your C/C++ skills are already beyond the beginner's level. I would have set links to this site more often but as the link policiy - when links are allowed and when forbidden - is not quite obvious to me and especially as I do not want to get into an argument with IBM's lawyers I will leave it with this one link.</p>
<p>Of course you are free to use the IBM online documentation as often as you like and I even recommend it if you think that a specific language feature might become clearer by looking it up there.</p>
</section>
<section class="slide level1" id="section-154">
<h1 id="section-154"></h1>
<h3 id="information-hiding-access-control">Information Hiding / Access Control</h3>
<p>To really enforce member data access through member functions only, access can be controlled with labels inserted between the members:</p>
<ul>
<li><code>private:</code> - only accessible for mebers and friends</li>
<li><code>protected:</code> - in addition accessible for derived classes</li>
<li><code>public:</code> - in addition accessible from everywhere</li>
</ul>
</section>
<section class="slide level1" id="section-155">
<h1 id="section-155"></h1>
<h2 id="summarizing-so-far-and-more-about-classes">Summarizing So Far and More about Classes</h2>
<p>Here is another <a href="InfoGraphics/ClassToMemoryMapping.png">Info-Graphic</a> that may be useful to summarize what has been covered so far and prepare for more.</p>
</section>
<section class="slide level1" id="section-156">
<h1 id="section-156"></h1>
<h3 id="base-classes-and-overriding">Base-Classes and Overriding</h3>
<p>The different meaning of <em>overriding</em> and <em>overloading</em> should be noted:</p>
<ul>
<li>Overloading is provding several global or member functions with identical names, that can be distinguished by their parameterization.</li>
<li>Overriding is providing a member function in a derived class that has the same name as a member function that already exists in the base class.</li>
</ul>
<p>A basic example, only demonstracting the feature and some of its possible pitfalls will be given as live demo from the code prepared in: <a href="CCppCode/Introductory/overriding.cpp">Introductory/overriding.cpp</a></p>
</section>
<section class="slide level1" id="section-157">
<h1 id="section-157"></h1>
<h2 id="automatically-generated-member-functions">Automatically Generated Member Functions</h2>
<p>C++ will generate default versions for a number of member functions.</p>
<p>Such are basically demonstrated in the following code examples:</p>
<ul>
<li><a href="CCppCode/Introductory/default_ctor.cpp">Introductory/default_ctor.cpp</a></li>
<li><a href="CCppCode/Introductory/copy_ctor.cpp">Introductory/copy_ctor.cpp</a></li>
<li><a href="CCppCode/Introductory/move_ctor.cpp">Introductory/move_ctor.cpp</a></li>
<li><a href="CCppCode/Introductory/copy_assign.cpp">Introductory/copy_assign.cpp</a></li>
<li><a href="CCppCode/Introductory/move_assign.cpp">Introductory/move_assign.cpp</a></li>
</ul>
</section>
<section class="slide level1" id="section-158">
<h1 id="section-158"></h1>
<h3 id="default--copy--and-move-constructor">Default-, Copy-, and Move-Constructor</h3>
<p>These are the rules in more detail:</p>
<ul>
<li>A default constructor is automatically provided <em>if no other constructor exists</em> and will recursively call default constructors for member data of class type and <strong>leaves member data of basic type unintialized</strong>.</li>
<li>A copy constructor is automatically provided if no copy constructur is supplied and will do a <strong>member-wise copy</strong> (using assembler level moves for basic types).</li>
<li>A move constructor is automatically provided if no move constructor and no copy constructur is supplied and will do a <strong>member-wise move</strong> (using assembler level moves for basic types).</li>
</ul>
</section>
<section class="slide level1" id="section-159">
<h1 id="section-159"></h1>
<h3 id="copy--and-move-assignment">Copy- and Move-Assignment</h3>
<p>These are the rules in more detail:</p>
<ul>
<li>A default copy assignment provided if no copy assignment is supplied and will do a <strong>member-wise assignment</strong> (using assembler level moves for basic types).</li>
<li>A default move assignmemnt is automatically provided if no move assignment and no copy assignment is supplied and will do a <strong>member-wise move</strong> (using assembler level moves for basic types).</li>
</ul>
</section>
<section class="slide level1" id="section-160">
<h1 id="section-160"></h1>
<h3 id="cleanup-destructors">Cleanup (Destructors)</h3>
<p>These are the rules in more detail:</p>
<ul>
<li><p>A destructor is automatically provided if none is supplied and will recursively call destructors for member data.</p></li>
<li><p><strong>For base classes the destructor is automatically called when the destructor for the derived class has finished.</strong></p></li>
</ul>
<p><strong>The latter does not depend on the origin of the derived class destructor: it may have been explicitely supplied or automatically generated.</strong></p>
</section>
<section class="slide level1" id="section-161">
<h1 id="section-161"></h1>
<h2 id="so-far-the-topics-planned-for-monday-...">So far the topics planned for Monday ...</h2>
<p>... and for the rest of the day you may want to review the language features covered so far once more for yourself and - maybe - go into more depth with topics of special interrest to you.</p>
<p>If you have no ideas yourself or the suggestions made so far are insufficient or not what you like to do you may also continue with the proposals made from here:</p>
</section>
<section class="slide level1" id="section-162">
<h1 id="section-162"></h1>
<h3 id="the-smiley-example-series">The Smiley Example Series</h3>
<p>This series contains a total of seven source files which you may best inspect in the order given following.</p>
<p>To summarize:</p>
<ul>
<li>Four of the examples print a small ASCII graphic from a data structure.</li>
<li>The other three help to prepare the data structure from a text file.</li>
</ul>
</section>
<section class="slide level1" id="section-163">
<h1 id="section-163"></h1>
<h4 id="the-c-version-of-the-smiley-printer">The C Version of the Smiley Printer</h4>
<p>Start with this: <a href="CCppCode/Smileys/smiley_print1.c">Smileys/smiley_print1.c</a></p>
<ul>
<li>Compile and run and - taking the source file name as a clue - compare the output to your expectations.</li>
<li>Review the code and understand how it works.</li>
<li>Could you have guessed the output from the source without actually compiling and running?</li>
</ul>
<p>(If you train your eyes a bit you might actually see the smiley shining through the <code>0</code>s and <code>1</code>s used for initialisation.)</p>
<p><strong>And if there are any questions, ask me.</strong></p>
<p>That's the whole purpose I'm still here now!</p>
</section>
<section class="slide level1" id="section-164">
<h1 id="section-164"></h1>
<h4 id="another-c-version-of-the-smiley-printer">Another C Version of the Smiley Printer</h4>
<p>Continue with this: <a href="CCppCode/Smileys/smiley_print2.c">Smileys/smiley_print2.c</a></p>
<ul>
<li>Compile and run this too.</li>
<li>Review the code and understand how it works.</li>
</ul>
<p>(And if there are any questions, ask me.)</p>
</section>
<section class="slide level1" id="section-165">
<h1 id="section-165"></h1>
<h4 id="preparing-pic_data-for-c-version">Preparing <code>pic_data</code> for C Version</h4>
<p>The initialised data array from which the smiley is generated in these examples could have been prepared manually.</p>
<p><strong>But of course you don't think I did it that way ... or am I looking such insane?</strong></p>
<p>For the C versions shown so far it has been prepared with this program: <a href="CCppCode/Smileys/smiley_get.c">Smileys/smiley_get.c</a></p>
<p>Review its code now.</p>
<p>(And yes, I'm still here in case you have any questions.)</p>
</section>
<section class="slide level1" id="section-166">
<h1 id="section-166"></h1>
<h4 id="a-c-version-of-the-printer">A C++ version of the printer</h4>
<p>Continue with this: <a href="CCppCode/Smileys/smiley_print.cpp">Smileys/smiley_print.cpp</a></p>
<ul>
<li>Compile and run this too.</li>
<li>Review the code and understand how it works.</li>
<li>Could you have guessed the output from the source without actually compiling and running?</li>
</ul>
<p>(And if there are any questions ...)</p>
</section>
<section class="slide level1" id="section-167">
<h1 id="section-167"></h1>
<h4 id="preparing-pic_data-for-c-version-1">Preparing <code>pic_data</code> for C++ Version</h4>
<p>The initialised data for C++ is much similar except the data type used here as base type is <code>bool</code>, not <code>int</code>.</p>
<ul>
<li>There are some more differences if you review the code in <a href="CCppCode/Smileys/smiley_get.cpp">Smileys/smiley_get.cpp</a> now and compare it to the former.</li>
<li>What might be more interesting is whether changing the array type from <code>int</code> to <code>bool</code> will safe memory.</li>
</ul>
<p>Any idea how you could find out?</p>
<p>(... yes, I'm still here ...)</p>
</section>
<section class="slide level1" id="section-168">
<h1 id="section-168"></h1>
<h4 id="storing-the-data-in-a-more-compact-form">Storing the Data in a More Compact Form</h4>
<p>Now continue with the program <a href="CCppCode/Smileys/smiley_zprint.c">Smileys/smiley_zprint.c</a>.</p>
<p>The data array uses a single bit only for each asterisk to print, so there should really be some memory safed.</p>
<ul>
<li>Can you find out how much?</li>
<li>Could you have guessed the output without running the program?</li>
</ul>
<p>(With respect to the last question: you might of course base your guess on the source file name but if you are really see a happy face &quot;shining through&quot; <strong>from the initialisation data</strong> you are a true hero in my eyes ... or just boldly hamming up.)</p>
</section>
<section class="slide level1" id="section-169">
<h1 id="section-169"></h1>
<h4 id="preparing-the-data-in-compact-form">Preparing the Data in Compact Form</h4>
<p>The helper to generate the initialized data is this: <a href="CCppCode/Smileys/smiley_getz.c">Smileys/smiley_getz.c</a>.</p>
<p>Yes, it's structure could be improved by putting some parts of it into subroutines and separate concerns like generating the bytes from bits and generating nicely formatted output.</p>
<p>I wouldn't like to make it too complicate for this first run, but if you want to try your hands on it, feel free to do it now.</p>
<p>You may also rework some of the other examples, or ...</p>
</section>
<section class="slide level1" id="section-170">
<h1 id="section-170"></h1>
<h3 id="now-for-something-completely-different">... <a href="http://www.youtube.com/watch?v=FGK8IC-bGnU">Now for Something Completely Different</a></h3>
<p>If you rather want to try your hands on <code>make</code>, this is your chance.</p>
<p>That's the idea:</p>
<ul>
<li>The programs to generate the initialised data might well leave their result in a file ...</li>
<li>... which the programs requiring such data array simply <code>#include</code>.</li>
</ul>
<p>In this situation it would make sense to automatically re-generate the included files in case <a href="CCppCode/Smileys/smiley.txt">Smileys/smiley.txt</a> changes and also trigger a recompilation of the various printers.</p>
<p>Furthermore, as changes in the generators might be important too, the generated products should have the appropriate dependencies.</p>
</section>
<section class="slide level1" id="tuesday">
<h1 id="tuesday">Tuesday</h1>
</section>
<section class="slide level1" id="section-171">
<h1 id="section-171"></h1>
<h2 id="overloading-operators">Overloading Operators</h2>
<p><a href="http://en.wikipedia.org/wiki/Operator_overloading">Overloading operators</a> was one of the early features C++.</p>
<p>In the 80s it was a popular field, especially for new programming languages, though today it is not seen without criticism and some languages (like Java) openly argue against it.</p>
</section>
<section class="slide level1" id="section-172">
<h1 id="section-172"></h1>
<h3 id="overloading-with-member-functions">Overloading with Member Functions</h3>
<p>The first possibility is to define a member function inside the class that constitutes the left hand side operand.</p>
<ul>
<li>For a unary operator there is no additional explicit argument.</li>
<li>For a binary operator there is <strong>one</strong> additional argument, constituting the right hand side operand.</li>
</ul>
<p><strong>For some operators this is the only possibility, like for assigmnent, indexing and function call.</strong></p>
</section>
<section class="slide level1" id="section-173">
<h1 id="section-173"></h1>
<h3 id="overloading-with-global-functions">Overloading with Global Functions</h3>
<p>The other possibility is to define a global function (outside any class).</p>
<ul>
<li>For a unary operator there is <strong>one</strong> explicit argument.</li>
<li>For a binary operator there are <strong>two</strong> arguments arguments.</li>
</ul>
</section>
<section class="slide level1" id="section-174">
<h1 id="section-174"></h1>
<h3 id="type-safe-inputoutput-stream-insertion-and-extraction">Type-Safe Input/Output (Stream Insertion and Extraction)</h3>
<p>A live example will be given with the result in <a href="CCppCode/Introductory/overload_io.cpp">Introductory/overload_io.cpp</a></p>
</section>
<section class="slide level1" id="section-175">
<h1 id="section-175"></h1>
<h3 id="overloading-indexing-and-alternatives">Overloading Indexing (and Alternatives)</h3>
<p>A live example will be given with the result in <a href="CCppCode/Introductory/overloading.cpp">Introductory/overloading.cpp</a></p>
</section>
<section class="slide level1" id="section-176">
<h1 id="section-176"></h1>
<h3 id="overloading-function-calls-functors">Overloading Function Calls (Functors)</h3>
<p>This feature allows to write classes for which the objects may be used followed by round parentheses enclosing a parameter list. i.e. instead of</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">MyClass obj;
obj.do_something(one, <span class="dv">2</span>, <span class="dv">1</span>/<span class="fl">3.0</span>);</code></pre>
<p>you are enabled to write:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">obj(one, <span class="dv">2</span>, <span class="dv">1</span>/<span class="fl">3.0</span>);</code></pre>
<p>It other words: you may consider this feature to give you kind of an unnamed member function in addition to all the named member function a class can have.</p>
<p>Therefore this feature may seem as (too much of) syntactic sugar initially, but it has a long tradition where it is applied in the STL library.</p>
</section>
<section class="slide level1" id="section-177">
<h1 id="section-177"></h1>
<h4 id="something-you-might-look-up-in-advance-if-you-are-impatient">Something you might look up in advance if you are impatient</h4>
<p>There is an example for overloading the function call operator in AToC §5.5 (from page 64) which will be covered later with the template feature.</p>
</section>
<section class="slide level1" id="section-178">
<h1 id="section-178"></h1>
<h2 id="exceptions">Exceptions</h2>
<p>Exceptions have alread been shortly mentioned based on AToC §3.4 (from page 27).</p>
<p>In the following sections they will be revisited shortly.</p>
<p>This <a href="InfoGraphics/ExceptionBasics.png">Info-Graphic</a> is meant to give a brief overview of the concept.</p>
</section>
<section class="slide level1" id="section-179">
<h1 id="section-179"></h1>
<h3 id="escaping-from-errors">Escaping from Errors</h3>
<p>The main purpose of exceptions is to signal the inability to complete some piece of work without the risk of going unnoticed.</p>
<p>E.g. if reading some input with <code>scanf</code>, the return value would have to be tested explicitely, otherwise errors will go unnoticed:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> height, width;
scanf(<span class="st">&quot;%d %d&quot;</span>, &amp;height, &amp;width);</code></pre>
<p>If there is insufficient or non-numeric input the program will fail silently.</p>
<p>In C++ I/O-failures can be turned into execptions:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> height, width; 
cin &gt;&gt; height &gt;&gt; width;</code></pre>
</section>
<section class="slide level1" id="section-180">
<h1 id="section-180"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-14">Something to try out later (if you have no other ideas)</h4>
<p>The last two code fragments are actually excerpts from <a href="CCppCode/Introductory/input_demo.c">Introductory/input_demo.c</a> and <a href="CCppCode/Introductory/input_demo.cpp">Introductory/input_demo.cpp</a>.</p>
<p>Compile and run both programs and check their behavior in case of bad input (incomplete, not numeric, partially numeric ...).</p>
<p>Then compare to their counterparts <a href="CCppCode/Introductory/input_demo2.c">Introductory/input_demo2.c</a> and <a href="CCppCode/Introductory/input_demo2.cpp">Introductory/input_demo2.cpp</a> which handle errors.</p>
<p>Small challenge: is error detection in the C version really sufficient or can you still enter input that makes the program (silently) fail ...?</p>
</section>
<section class="slide level1" id="section-181">
<h1 id="section-181"></h1>
<h3 id="non-local-branching">Non-Local Branching</h3>
<p>Basically exceptions are kind of a non-local branching feature which always goes back in the hierarchy of (unterminated) function calls.</p>
<p><strong>This is also possible in pure C but would skip the execution of destructors.</strong></p>
<p>There will be an example later in Part 2 (the Linux System Programming section).</p>
</section>
<section class="slide level1" id="section-182">
<h1 id="section-182"></h1>
<h3 id="best-practices">Best Practices</h3>
<p>A few common pitfals with respect to execptions are summarized in this <a href="InfoGraphics/ExceptionDetails.png">Info-Graphic</a>.</p>
<p>A rather good in depth treatment with recommendations in check-list style can be found <a href="http://www.bleading-edge.com/Publications/C++Report/v9603/Article2a.htm">here</a> and <a href="http://www.bleading-edge.com/Publications/C++Report/v9605/Column1.htm">here</a>.</p>
<p>(BTW: Personally I think there is more stuff worth reading from that author, <a href="http://www.bleading-edge.com/Publications/list.htm">Jack Reeves</a>.)</p>
</section>
<section class="slide level1" id="section-183">
<h1 id="section-183"></h1>
<h4 id="something-you-should-not-defer-to-next-week-...">Something you should not defer to next week ...</h4>
<p>... at least if you are strongly interrested to use exceptions in your future C++ projects:</p>
<p><strong>Plan some time for at least giving the above articles a cursory view so that you can ask me questions as long as I'm available here.</strong></p>
<p>On the other hand: some embedded projects using C++ make an explicit decision not to use exceptions, so you may never need a deeper knowledge (and same of course if you stick with C).</p>
</section>
<section class="slide level1" id="section-184">
<h1 id="section-184"></h1>
<h3 id="alternatives">Alternatives</h3>
<p>Generally exceptions introduce a cost that gives a C++ program a larger memory footprint - they <strong>DO NOT FIT WELL</strong> to the otherwise used philosophy in the design of C++:</p>
<p><strong>You only pay for what you use.</strong></p>
</section>
<section class="slide level1" id="section-185">
<h1 id="section-185"></h1>
<h4 id="something-to-try-out-later-if-you-have-no-other-ideas-15">Something to try out later (if you have no other ideas)</h4>
<p>Come up with an example demonstrating the cost of exceptions. It should be comprised of at least three separately compiled modules.</p>
<p>The first one should be a function that conditionally may throw an execption. You may control this via a global:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">extern</span> <span class="dt">bool</span> have_problem;
<span class="dt">void</span> foo() {
    <span class="co">// ... before</span>
    <span class="kw">if</span> (have_problem)
        <span class="kw">throw</span> <span class="dv">42</span>;
    <span class="co">// ... after</span>
}</code></pre>
<p>This function should then be called from an intermediate level function bar in a separatedly complied module:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">extern</span> <span class="dt">void</span> foo();
<span class="dt">void</span> bar() {
    <span class="co">// ... before</span>
    foo();
    <span class="co">// ... after</span>
}</code></pre>
<p>Finally there <code>main</code> program should call <code>bar</code> and allow - e.g. controlled by a command line argument - to make <code>foo</code> throw the execption or not.</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">bool</span> have_problem;
<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> *argv[]) {
    have_problem = (argc &gt; <span class="dv">1</span>);
    <span class="kw">try</span> {
        bar();
        <span class="kw">return</span> <span class="dv">0</span>;
    }
    <span class="kw">catch</span> (<span class="dt">int</span> err) {
        <span class="kw">return</span> <span class="dv">1</span>;
    }
}</code></pre>
<p>Hint: when you run the program as shown you may make it throw an execption via running it with (any) command line argument (or leave it out not to throw) and view the result code returned from <code>main</code> as the content of the shell variable <code>$?</code>.</p>
<p>After everything works (as expected) restructure the example (or yet better: create a second one so that you can better compare) which does basically the same but indicates that it has problems via a return value from <code>foo</code>:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">extern</span> <span class="dt">bool</span> have_problem;
<span class="dt">bool</span> foo() {
    <span class="co">// ... before</span>
    <span class="kw">if</span> (have_problem)
        <span class="kw">return</span> <span class="kw">false</span>;
    <span class="co">// ... after</span>
}</code></pre>
<p>Of course, the intermediary <code>bar</code> will now have to forward the problem notification:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">bool</span> bar() {
    <span class="co">// ... before</span>
    <span class="kw">if</span> (!foo())
        <span class="kw">return</span> <span class="kw">false</span>;
    <span class="co">// ... after</span>
    <span class="kw">return</span> <span class="kw">true</span>;
}</code></pre>
<p>And <code>main</code> needs to be modified test the value returned from <code>bar</code>:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> *argv) {
    <span class="kw">if</span> (bar()) {
        <span class="kw">return</span> <span class="dv">0</span>;
    }
    <span class="kw">else</span> {
        <span class="kw">return</span> <span class="dv">1</span>;
    }
}</code></pre>
<p>You may well add some lines of code printing messages at various points (e.g. at before / after) so that you can better trace which parts of your code are executed, but this of course will add to the memory footprint so be careful what you investigate. At least make sure that both versions contain exactly the same (printing) code or you that you can disable the printing code completely for memory footprint comparisons.</p>
</section>
<section class="slide level1" id="section-186">
<h1 id="section-186"></h1>
<h2 id="concrete-vs.-abstract-types">Concrete vs. Abstract Types</h2>
<p>See AToC §4 (from page 33).</p>
</section>
<section class="slide level1" id="section-187">
<h1 id="section-187"></h1>
<h3 id="from-data-containers-to-services">From Data-Containers to Services</h3>
<p>This general route has already been mentioned:</p>
<ul>
<li>Avoid the data centric view with separate functions working <strong>on</strong> some pieces of otherwise &quot;dead&quot; data.</li>
<li>Instead package data and functions with each other and define <strong>services</strong> an object can or needs to offer to its clients.</li>
</ul>
</section>
<section class="slide level1" id="section-188">
<h1 id="section-188"></h1>
<h4 id="a-very-personal-comment">A Very Personal Comment</h4>
<p>Well, well, I used this high level &quot;Object Oriented&quot; way of speaking so long for many years that it still comes fluently, but with time my view has shifted:</p>
<p>Any somewhat experienced software developer who follows some natural core principles like</p>
<ul>
<li>structuring along logical separations of concerns,</li>
<li>avoiding repetition, striving for reuse,</li>
<li>hardening software where it should be robust,</li>
<li>but make it adaptable where it helps to support different use cases</li>
</ul>
<p>will soon see when and how encapsulation into objects comes in handy.</p>
<p>Teaching Object Orientation by abstract principles and rules to follow in a guideline style - at least to my experience - has seldom improved software quality in a project.</p>
<p>To me it seems far better to have the experienced developers guide the newcomers so that the latter could adopt good style and best practices from conrete models, not from abstract rules.</p>
</section>
<section class="slide level1" id="section-189">
<h1 id="section-189"></h1>
<h3 id="invariants-pre--and-post-conditions">Invariants, Pre- and Post-Conditions</h3>
<ul>
<li>An invarant is a condition that is always true throughout the lifetime of some object.</li>
<li>A precondition is something that must be fullfilled prior to some operation, like calling a certain member function.</li>
<li>A postcondition is something a client that uses some obkect (instance) can rely on at some point.</li>
</ul>
<p>All of the above are more or less theoretical concepts that manifest themselves mostly in comments or reference documentation.</p>
</section>
<section class="slide level1" id="section-190">
<h1 id="section-190"></h1>
<h3 id="virtual-member-functions">Virtual Member Functions</h3>
<p>This <a href="InfoGraphics/RuntimeTypeIdentification.png">Info-Graphic</a> explains the implementation on its left half.</p>
<p>Typical usages will be shown in later examples.</p>
<p>(The right half of this Info-Graphic will not be not be covered right now but it may get a short coverage in a later example, based on your request.)</p>
</section>
<section class="slide level1" id="section-191">
<h1 id="section-191"></h1>
<h3 id="parameterizing-interfaces">Parameterizing Interfaces</h3>
<p>Interfaces may be compared to a contract which two parties agree on. They can help much to separate concerns, make software more modular and testable and hence have a lot of positive appraisal.</p>
</section>
<section class="slide level1" id="section-192">
<h1 id="section-192"></h1>
<h4 id="interfaces-in-object-oriented-style">Interfaces in Object Oriented Style</h4>
<p>In object oriented languages like C++ they are often seen as a special case of abstract classes, which is in fact <em>one</em> way an interface may be realized and has in fact lots of advantages.</p>
</section>
<section class="slide level1" id="section-193">
<h1 id="section-193"></h1>
<h4 id="interfaces-viewn-more-generally">Interfaces Viewn More Generally</h4>
<p>From a more general viewpoint interfaces may also be parametrized via template arguments (called policies then and covered later) and viewn from the technical side an object file with a given set of entry points and global data definitions offers an interface which some other object file may use.</p>
</section>
<section class="slide level1" id="section-194">
<h1 id="section-194"></h1>
<h2 id="generalization-vs.-composition">Generalization vs. Composition</h2>
<p>This is the part that has so far not been covered in <a href="InfoGraphics/ClassToMemoryMapping.png">Info-Graphic</a>.</p>
</section>
<section class="slide level1" id="section-195">
<h1 id="section-195"></h1>
<h3 id="public-base-classes">Public Base Classes</h3>
<p>With a public base the &quot;is a&quot; relationship between two class is formalized.</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">class</span> Derived : <span class="kw">public</span> Base {
    <span class="co">// ...</span>
};</code></pre>
<ul>
<li>Class <code>Derived</code> inherits everything that is public in <code>Base</code></li>
<li>and can of course add its own members (data as well as functions).</li>
</ul>
</section>
<section class="slide level1" id="section-196">
<h1 id="section-196"></h1>
<h3 id="liskov-substitution-principles">Liskov Substitution Principles</h3>
<p>The one thing that makes public inheritance special is the LSP named after <a href="http://en.wikipedia.org/wiki/Barbara_Liskov">Barbara Liskov</a>:</p>
<ul>
<li>A derived class should always be usable as replacement for one of its bases.</li>
<li>This can be implemented in C++ at no cost (for single inheritance).</li>
</ul>
<p>The LSP limits in important ways to which degree a derived class may replace the implementation of some inherited (public) member function.</p>
</section>
<section class="slide level1" id="section-197">
<h1 id="section-197"></h1>
<h4 id="limits-for-overriding-inherited-member-functions">Limits for Overriding Inherited Member Functions</h4>
<p><strong>A Derived Class Must Never Require Stronger Preconditions:</strong></p>
<p>Otherwise, as due to the LSP the compiler allows a derived class object to replace its base, a client might be surprised because some operation fails yet he has done everything right!</p>
<p><strong>A Derived Class Must Never Give Weaker Postconditions:</strong></p>
<p>Otherwise, as due to the LSP the compiler allows a derived class object to replace its base, a client might be surprised because it doesn't get on what it relies.</p>
</section>
<section class="slide level1" id="section-198">
<h1 id="section-198"></h1>
<h3 id="private-base-classes">Private Base Classes</h3>
<p>With a private base the &quot;has a&quot; relationship between two class is formalized.</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">class</span> Composite : <span class="kw">private</span> Part {
    <span class="co">// ...</span>
};</code></pre>
</section>
<section class="slide level1" id="section-199">
<h1 id="section-199"></h1>
<h3 id="class-as-member">Class as Member</h3>
<p>An alternative is explicit containment as member:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">class</span> Composite {
    <span class="co">// ...</span>
    Part part;
};</code></pre>
</section>
<section class="slide level1" id="section-200">
<h1 id="section-200"></h1>
<h3 id="components-with-adaptable-details-1st-technique">Components with Adaptable Details (1st Technique)</h3>
<p>Public or private base classes may be used to make certain aspects of a class adaptable by a client using this class, be it</p>
<ul>
<li>as a public base, or</li>
<li>as a private base.</li>
</ul>
<p><strong>Note that this technique does not apply to explicitely contained members!</strong></p>
<p>It is based on virtual member functions called by the base at strategic points where a client might modify the general code.</p>
<p><strong>A design pattern based on this technique is named <em>Template Methode Pattern</em> but it has nothing to do with C++ Templates.</strong></p>
</section>
<section class="slide level1" id="section-201">
<h1 id="section-201"></h1>
<h4 id="if-time-allows-and-you-are-interrested-...">If Time Allows and You are Interrested ...</h4>
<p>... we can go through it now in a life demo modifying the Thermostate Example to give it different strategies to apply the hysteresis when switching on and off.</p>
</section>
<section class="slide level1" id="section-202">
<h1 id="section-202"></h1>
<h2 id="introduction-to-programming-with-templates">Introduction to Programming with Templates</h2>
<p>See AToC §5 (from page 59) and also this <a href="InfoGraphics/ParametrizedTypesAndSizes.png">Info-Graphic</a> for a motivation.</p>
</section>
<section class="slide level1" id="section-203">
<h1 id="section-203"></h1>
<h3 id="template-functions-parametrizing-types">Template Functions (Parametrizing Types)</h3>
<p>In case of template function the goal is frequently to get some type independance from a generic implementation. An example might be a sort algorithm that works on an array with any type of element.</p>
<p>This is also schematically illustrated in the right half of this <a href="InfoGraphics/TemplateBasics.png">Info-Graphic</a>.</p>
</section>
<section class="slide level1" id="section-204">
<h1 id="section-204"></h1>
<h3 id="template-classes-e.g.-as-base-for-containers">Template Classes (E.g. as Base for Containers)</h3>
<p>In case of a template class also types may be parameterized, but other compile time constants may be as well, like buffer sizes.</p>
<p>This is also schematically illustrated in the left half of this <a href="InfoGraphics/TemplateBasics.png">Info-Graphic</a>.</p>
</section>
<section class="slide level1" id="section-205">
<h1 id="section-205"></h1>
<h3 id="components-with-adaptable-details-2nd-technique">Components with Adaptable Details (2nd Technique)</h3>
<p>Also templates allow to make certain aspects of a class adaptable. Then this technique is sometimes called policies.</p>
<p>It is based on calling member functions inherited from a base which can be freely set from via an template argument.</p>
</section>
<section class="slide level1" id="section-206">
<h1 id="section-206"></h1>
<h4 id="if-time-allows-and-you-are-interrested-...-1">If Time Allows and You are Interrested ...</h4>
<p>... we can go through it now in a life demo modifying the Thermostate Example to give it different strategies to apply the hysteresis when switching on and off.</p>
</section>
<section class="slide level1" id="section-207">
<h1 id="section-207"></h1>
<h3 id="comparing-class-adaption-techniques">Comparing Class Adaption Techniques</h3>
<p>In the same vein as demonstrated with the two class adaption techniques is the example in this <a href="InfoGraphics/TypeBasedBranching.png">Info-Graphic</a>.</p>
</section>
<section class="slide level1" id="section-208">
<h1 id="section-208"></h1>
<h2 id="more-advanced-template-usages">More Advanced Template Usages</h2>
<p>Another view on templates is to consider them as type transformation (functions) to be executed at compile time. This enhances C++ with the power of functional programming at compile time.</p>
<p>For certain real live problems this can yield highly efficient solutions but is probably better left to a few experts (if applied seriously, not for demonstration pruposes only) while the fruits may be very attractive for the mortals.</p>
</section>
<section class="slide level1" id="section-209">
<h1 id="section-209"></h1>
<h3 id="something-you-might-want-to-look-at-as-a-motivating-example">Something you might want to look at as a motivating example</h3>
<p>The <a href="http://www.boost.org/doc/libs/1_55_0/doc/html/boost_units.html">Boost.units</a> library extends type checking to physical units (e.g. from the SI system, but this is configurable)</p>
<ul>
<li>thus turning it into a compile time error if you assign a speed to a length,</li>
<li>but still allowing to assign a speed multiplied with a time to a length,</li>
<li>or a length divided by a squared time to an acceleration,</li>
<li>(... etc. you get the idea?)</li>
<li>and also care for the appropriate conversion if a length meassured in inch is assigned to (or otherwise combined with) a lenght meassured im millimetres.</li>
</ul>
</section>
<section class="slide level1" id="section-210">
<h1 id="section-210"></h1>
<h3 id="what-is-functional-programming">What is Functional Programming?</h3>
<p><a href="http://en.wikipedia.org/wiki/Functional_programming">Functional Programming</a> in its pure form deals with transformations by functions in the mathematical sense, i.e. there is no internal state that may have an influence on the outcome.</p>
<p>Functions are said to be <em>first class citiziens</em> and often not only data but also functions are manipulated by functions, for which the term <em>higher order functional programming</em> has been coined.</p>
<p>Recently functional programming has gained a little more attention, as when applied in its pure form in a functional programming language, a program lends itself ideally to heavy optimizations, possibly exploiting massive parallelism.</p>
</section>
<section class="slide level1" id="section-211">
<h1 id="section-211"></h1>
<h3 id="calculations-at-compile-time">Calculations at Compile-Time</h3>
<p>A famous example that calculates the factorial of a number at compile time using templates as a way of functional programming is in <a href="CCppCode/Templates/fp_factorial.cpp">Templates/fp_factorial.cpp</a></p>
</section>
<section class="slide level1" id="section-212">
<h1 id="section-212"></h1>
<h3 id="type-mapping-at-compile-time">Type-Mapping at Compile-Time</h3>
<p>The the more pragmatic uses of functional programming for type mapping at compile time are demonstrated in the final versions of the series of examples implementing an algorithm in STL style:</p>
<ul>
<li><a href="CCppCode/Templates/unique_copy4.cpp">Templates/unique_copy4.cpp</a></li>
<li><a href="CCppCode/Templates/unique_copy5.cpp">Templates/unique_copy5.cpp</a></li>
<li><a href="CCppCode/Templates/unique_copy6.cpp">Templates/unique_copy6.cpp</a></li>
</ul>
</section>
<section class="slide level1" id="section-213">
<h1 id="section-213"></h1>
<h3 id="standard-traits-library">Standard Traits (Library)</h3>
<p>See AToC §11.6 (from page 128).</p>
</section>
<section class="slide level1" id="wednesday">
<h1 id="wednesday">Wednesday</h1>
</section>
<section class="slide level1" id="section-214">
<h1 id="section-214"></h1>
<h2 id="essential-c-standard-library-overwiew">Essential C++ Standard Library (Overwiew)</h2>
</section>
<section class="slide level1" id="section-215">
<h1 id="section-215"></h1>
<h3 id="the-c-library-as-a-subset">The C Library as a Subset</h3>
<p>All of the C library is available in C++ too.</p>
<ul>
<li>The traditional names of the C header get a <code>c</code> added as first character and the <code>.h</code> at the end removed.</li>
<li>All of the contained functions are in the name space <code>std</code>.</li>
<li>Owing to function oveloading some solutions are nicer in C++, like mathematical functions for floating types of various precission.</li>
</ul>
</section>
<section class="slide level1" id="section-216">
<h1 id="section-216"></h1>
<h3 id="strings-replacing-char-arrays">Strings (Replacing <code>char</code>-Arrays)</h3>
<p>See AToC §7.2 (from page 75) and this <a href="InfoGraphics/StringBasics.png">Info-Graphic</a>.</p>
</section>
<section class="slide level1" id="section-217">
<h1 id="section-217"></h1>
<h3 id="streams-replacing-file-s">Streams (Replacing <code>FILE</code>-s)</h3>
<p>For a design overview see this <a href="InfoGraphics/IOStreamBasics.png">Info-Graphic</a>.</p>
</section>
<section class="slide level1" id="section-218">
<h1 id="section-218"></h1>
<h3 id="regular-expressions">Regular Expressions</h3>
<p>AToC §7.3 (from page 78) gives a good coverage.</p>
</section>
<section class="slide level1" id="section-219">
<h1 id="section-219"></h1>
<h2 id="containers-and-algorithms">Containers and Algorithms</h2>
<p>Coverage in AToC starts in §9 (from page 95).</p>
<p>Furthermore the following Info-Graphics deal with aspects of STL containers and algorithms:</p>
<ul>
<li><a href="InfoGraphics/STL-SequenceContainers.png">Sequence Containers</a></li>
<li><a href="InfoGraphics/STL-AssociativeContainers.png">Associative Containers</a></li>
<li><a href="InfoGraphics/STL-ContainerIterators.png">Concept of Iterators</a></li>
<li><a href="InfoGraphics/STL-IteratorDetails.png">Iterators in More Detail</a></li>
<li><a href="InfoGraphics/STL-IteratorCategories.png">Categories of Iterators</a></li>
<li><a href="InfoGraphics/STL-IteratorUsages.png">Iterators as Glue to Algorithms</a></li>
</ul>
</section>
<section class="slide level1" id="section-220">
<h1 id="section-220"></h1>
<h3 id="sequential-containers">Sequential Containers</h3>
<p>There have traditionally been three of them in C++98 with a fourth added in C++11:</p>
<ul>
<li><code>vector</code>, <code>deque</code>, and <code>list</code> (in C++98)</li>
<li><code>forward_list</code> (introduced with C++11)</li>
</ul>
<p>A short coverage is given in AToC §9.2 and §9.3 (from page 96).</p>
</section>
<section class="slide level1" id="section-221">
<h1 id="section-221"></h1>
<h3 id="associative-containers">Associative Containers</h3>
<p>Such come in eight flavours, four have been introduces with C++98:</p>
<ul>
<li><code>set</code> and <code>multi_set</code></li>
<li><code>map</code> and <code>multi_map</code></li>
</ul>
<p>C++11 has added the <code>unordered_</code>-variant.</p>
<p>A overview is given in AToC §9.4 (from page 101) and $9.5 (from page 102) which is very brief and cursory.</p>
</section>
<section class="slide level1" id="section-222">
<h1 id="section-222"></h1>
<h3 id="iterators-abstracting-traversal">Iterators (Abstracting Traversal)</h3>
<p>Iterators as introduced beginning with AToC §10.1 continuing to §10.5 provide the glue between STL containes and STL algorithms.</p>
</section>
<section class="slide level1" id="section-223">
<h1 id="section-223"></h1>
<h3 id="algorithms-in-general">Algorithms in General</h3>
<p>AToC §10.6 gives a very brief overview.</p>
</section>
<section class="slide level1" id="section-224">
<h1 id="section-224"></h1>
<h3 id="parameterizing-call-backs">Parameterizing Call-Backs</h3>
<p>One of the most important applications of this technique in C++ are STL algorithms requiring a predicate like demonstrated in AToC §10.5 (from page 113).</p>
</section>
<section class="slide level1" id="section-225">
<h1 id="section-225"></h1>
<h4 id="function-pointers">Function Pointers</h4>
<p>There are old style function pointers as known from C, which are simply memory cells holding addresses from the code segment and the modern <code>std::function</code> class as introduced in AToC $11.5.3 (from page 127) which can be covered in more depth on request with as live demo.</p>
</section>
<section class="slide level1" id="section-226">
<h1 id="section-226"></h1>
<h4 id="overloading-function-call-functors">Overloading Function Call (Functors)</h4>
<p>See AToC §5.5 (from page 64) going already beyond the basic technique as it combines the introduction of this mechanism with an application to template classes.</p>
</section>
<section class="slide level1" id="section-227">
<h1 id="section-227"></h1>
<h4 id="lambdas-function-literals">Lambdas (Function Literals)</h4>
<p>Also see AToC §5.5 (from page 64) for this feature, which has been originated from LISP and is known from many other programming, but relatively new for C++.</p>
</section>
<section class="slide level1" id="section-228">
<h1 id="section-228"></h1>
<h2 id="ressource-management">Ressource-Management</h2>
<p>Generally ressource management is a far broader topic than only memory management, though it - and its problems - often expose themselves first as memory manegment problems like:</p>
<ul>
<li>Resource Leaks or</li>
<li>Dangling References</li>
</ul>
</section>
<section class="slide level1" id="section-229">
<h1 id="section-229"></h1>
<h3 id="memory-and-other-ressources">Memory and Other Ressources</h3>
<p>See also this <a href="InfoGraphics/ResourceManagement.png">Info-Graphic</a>.</p>
</section>
<section class="slide level1" id="section-230">
<h1 id="section-230"></h1>
<h3 id="smart-pointers">Smart Pointers</h3>
<p>See AToC §11.2.1 and this <a href="InfoGraphics/SmartPointers.png">Info-Graphic</a>.</p>
</section>
<section class="slide level1" id="section-231">
<h1 id="section-231"></h1>
<h3 id="resource-wrappers-raii">Resource-Wrappers (RAII)</h3>
<p>RAII is a basic technique once proposed by Bjarne Stroustrup for an idomatic handling of ressources. It combines operations which complement each other in constructor and destructor of a helper class.</p>
<p>It is very briefly introduced at the end of AToC §11.2 (from page 118) and gets also a very short mention in AToC §4.2.2, but there are numerous external resources explaining it in great detail, like it is here: <a href="http://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Resource_Acquisition_Is_Initialization"><code class="url">http://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Resource_Acquisition_Is_Initialization</code></a></p>
<p>See also at the right hand side (not covered so far) of this <a href="InfoGraphics/ResourceManagement.png">Info-Graphic</a>.</p>
</section>
<section class="slide level1" id="section-232">
<h1 id="section-232"></h1>
<h2 id="more-c-standard-library-overview">More C++ Standard-Library (Overview)</h2>
<p>This is a small selection only which will be extended on request.</p>
</section>
<section class="slide level1" id="section-233">
<h1 id="section-233"></h1>
<h3 id="random-numbers-1">Random Numbers</h3>
<p>See AToC $12.5 (from page 136).</p>
<p>(Some live demos based on these examples can be done on request.)</p>
</section>
<section class="slide level1" id="section-234">
<h1 id="section-234"></h1>
<h3 id="time-points-and-durations">Time-Points and Durations</h3>
<p>See AToC §11.4 (from page 125).</p>
<p>As the above is extremely scarce, here is some source where the topic receives a deeper coverage: <a href="http://www.informit.com/articles/article.aspx?p=1881386&amp;seqNum=2"><code class="url">http://www.informit.com/articles/article.aspx?p=1881386&amp;seqNum=2</code></a></p>
</section>
<section class="slide level1" id="section-235">
<h1 id="section-235"></h1>
<h3 id="simple-concurrency">Simple Concurrency</h3>
<p>See AToC §13.7.2 and $13.7.3 <em>packaged tasks</em> and the <code>std::async</code> helper utility for:</p>
<ul>
<li>providing a very easy to use solution for concurrency</li>
<li>if the data to process can be separated into strictly independant chunks</li>
<li>so that no synchronisation is necessary,</li>
<li>except for collecting the results.</li>
</ul>
</section>
<section class="slide level1" id="thursday">
<h1 id="thursday">Thursday</h1>
</section>
<section class="slide level1" id="section-236">
<h1 id="section-236"></h1>
<h2 id="c11-vs.-posix-multithreading">C++11 vs. Posix-Multithreading</h2>
<p>C++11 has added basic support for multi threading that typically builds on some threading facility of the platform (i.e. operating system) for which the C++ implementation was done.</p>
<p>As the same API has to be available for a possibly different underlying host functionality, only common abstractions are defined and anything that is special and cannot be commonly expected has been left out.</p>
<p>Mainly missing are priorities, scheduling policies and related advanced features like priority ceiling, so e.g. solutions to practical problems like priority inversion can not build on C++11 mechanism alone.</p>
</section>
<section class="slide level1" id="section-237">
<h1 id="section-237"></h1>
<h3 id="creating-threads">Creating Threads</h3>
<p>See AToC §13.2 (from page 142) and how a client may supply subroutine to be executed concurrently.</p>
</section>
<section class="slide level1" id="section-238">
<h1 id="section-238"></h1>
<h3 id="exchanging-data">Exchanging Data</h3>
<p>When threads are involved this is - contrary to processes - never a problem since all execute in the same address space and can reach each others data.</p>
<p>While this is true in principal, data must not only be accessible but have a life time long enough to be valid throughout any thread accesses it. Therefore it typically lives</p>
<ul>
<li>either on a fixed address as a global;</li>
<li>or somewhere on the heap (maybe accessed by <code>shared_ptr</code>-s);</li>
<li>or local to a thread (that must not prematurely be cleaned up).</li>
</ul>
</section>
<section class="slide level1" id="section-239">
<h1 id="section-239"></h1>
<h3 id="race-conditions">Race Conditions</h3>
<p>Getting a short mention in §13.5 (from page 144) and serving as an example why there is a helper utility to lock a set of mutexes without failing (i.e. get all of them or none at all).</p>
</section>
<section class="slide level1" id="section-240">
<h1 id="section-240"></h1>
<h2 id="synchronisation-between-threads">Synchronisation between Threads</h2>
<p>Synchronisation between threads is necessary in two typical scenarios:</p>
<ul>
<li><p>Caused by a member function called in one thread a class invariant may be temporarily invaldidated and it therefore is to avoid that any another thread steps in between.</p></li>
<li>In a consumer/producer scenario with some intermediate buffering one side is too far ahead of the other, i.e.:</li>
<li>there is no data yet to consume because the producer didn't deliver fast enough;</li>
<li><p>the intermediate buffer is completely filled because the consumer couldn't keep step with the producer.</p></li>
</ul>
</section>
<section class="slide level1" id="section-241">
<h1 id="section-241"></h1>
<h3 id="mutexes-and-locks">Mutexes and Locks</h3>
<p>See AToC §13.5 (from page 144) illustrating the problem of some data structure with a temporarily invalidated invariant.</p>
</section>
<section class="slide level1" id="section-242">
<h1 id="section-242"></h1>
<h3 id="condition-variables">Condition Variables</h3>
<p>See AToC §13.6 (from page 146) illustrating the consumer/producer-scenario.</p>
</section>
<section class="slide level1" id="section-243">
<h1 id="section-243"></h1>
<h3 id="joining-with-a-thread">Joining with a Thread</h3>
<p>See AToC §13.3 (from page 143)</p>
</section>
<section class="slide level1" id="part-2-linux-system-programming---starting-thursday">
<h1 id="part-2-linux-system-programming---starting-thursday">Part 2: Linux System Programming - Starting Thursday</h1>
<center>
Note: From here on the course is to a large part a guided tour through a selection of the many examples from the TLPI-Book.
</center>

</section>
<section class="slide level1" id="section-244">
<h1 id="section-244"></h1>
<h2 id="major-concepts-in-overview">Major Concepts in Overview</h2>
<p>It is hardly possibly to give in less than two days an overview of moderate depth over the rich system call interface now offered by Linux. Introducing concepts will therefore accompany the tour through the source.</p>
<p>Feel free to ask questions if you feel too little familiar with the concepts the instructor introduces as background.</p>
<p><strong>Again: PLEASE ask your questions to slow down the pace if you think you will fall behind or even get lost otherwise.</strong></p>
</section>
<section class="slide level1" id="section-245">
<h1 id="section-245"></h1>
<h3 id="general-utilities-used-in-the-examples">General Utilities Used In The Examples</h3>
<p>There is a <code>lib</code> subdirectory with some common stuff.</p>
<h4 id="header-file-used-in-all-examples">Header File Used in all Examples</h4>
<p>Most important is a header file used in nearly each example: <a href="SysProg/lib/tlpi_hdr.h">lib/tlpi_hdr.h</a></p>
<p>It includes some system heades and provides a few <code>#define</code>-s.</p>
</section>
<section class="slide level1" id="section-246">
<h1 id="section-246"></h1>
<h4 id="functions-to-print-messages-in-case-of-problems">Functions To Print Messages In Case Of Problems</h4>
<p>The following header has the prototypes for such functions: <a href="Sysprog/lib/error_functions.h">lib/error_functions</a></p>
<p>Implementations are found here: <a href="System/lib/error_functions.c">lib/error_functions.c</a></p>
<p>Some of these function also terminate the program, others just show the message.</p>
</section>
<section class="slide level1" id="section-247">
<h1 id="section-247"></h1>
<h4 id="printable-names-of-error-number-definitions">Printable Names of Error Number Definitions</h4>
<p>The following header helps to turn <code>#define</code>-s of error numbers into something printable: [lib/ename.c.inc](SysProg/lib/ename.c.inc]</p>
</section>
<section class="slide level1" id="section-248">
<h1 id="section-248"></h1>
<h4 id="helper-functions-to-parse-numeric-values-from-strings">Helper Functions to Parse Numeric Values From Strings</h4>
<p>Those functions are declared in the following header: [lib/get_num.h](SysProg/lib/get_num.h]</p>
<p>Their implementation is accordingly found here: <a href="System/lib/get_num.c">lib/get_num.c</a></p>
<p>The main advantage over <code>atoi</code> and cousins is more error checking.</p>
</section>
<section class="slide level1" id="section-249">
<h1 id="section-249"></h1>
<h4 id="other-helper-functions">Other Helper Functions</h4>
<p>Some of the remaining functions in the lib subdirectory are provided for use in specific examples and will be covered together with these examples.</p>
</section>
<section class="slide level1" id="section-250">
<h1 id="section-250"></h1>
<h2 id="unified-io">Unified I/O</h2>
<p>From the viewpoint of the application there is no difference whatever the data source or data sink is:</p>
<ul>
<li>At may be data stored in a classical files or</li>
<li>or data exchanged with another process on the same</li>
<li>or a different system in a networked environment</li>
</ul>
<p>The price to pay is that from the viewpoint of the Linux kernel I/O has no other structure as beeing just a sequence of bytes.</p>
</section>
<section class="slide level1" id="section-251">
<h1 id="section-251"></h1>
<h3 id="basics-of-the-io-modell">Basics of the I/O Modell</h3>
<p>Basic Unix I/O involves the use of four system calls, as the following example shows: <a href="SysProg/fileio/copy.c">fileio/copy.c</a></p>
<p>Such are:</p>
<ul>
<li><code>open</code> - open a file specified by name, open mode and other details</li>
<li><code>read</code> - to transfer a given number of bytes <strong>into</strong> main memory</li>
<li><code>write</code> - to transfer a given number of bytes <strong>out of</strong> main memory</li>
<li><code>close</code> - to release the resources</li>
</ul>
<p>A detailed explanation what each of these system calls does is available in the online manual.</p>
<p>(Putting it differently: RTFM)</p>
</section>
<section class="slide level1" id="section-252">
<h1 id="section-252"></h1>
<h4 id="something-to-look-at-later-if-you-have-no-other-ideas-4">Something to look at later (if you have no other ideas)</h4>
<p>Have a look in the online manual and find out about the relation between <code>open</code> and <code>creat</code>.</p>
<p>Replace the second <code>open</code> with <code>creat</code> and try to find out what happens if the file already exists.</p>
<p>Use <code>creat</code> <em>not</em> including write permission for the newly create file and determine whether the program fails to return a valid file descriptor or later, when it actually writes to the file.</p>
</section>
<section class="slide level1" id="section-253">
<h1 id="section-253"></h1>
<h4 id="changing-the-current-position">Changing the Current Position</h4>
<p>With respect to the file read or written the system maintains the notion of a current position, also called the <em>seek</em> position.</p>
<p>It can be queried and changed, as the following example shows: <a href="SysProg/fileio/seek_io.c">fileio/seek_io.c</a></p>
</section>
<section class="slide level1" id="section-254">
<h1 id="section-254"></h1>
<h3 id="io-in-more-detail">I/O in more Detail</h3>
<p>The following examples are a bit special and may well be skipped without loosing track.</p>
</section>
<section class="slide level1" id="section-255">
<h1 id="section-255"></h1>
<h4 id="exclusive-creation-of-a-file">Exclusive Creation Of A File</h4>
<p>This <em>cannot</em> be achieve by first testing and then opening, as there is a time window for a race condition, what this example shows:</p>
<ul>
<li><a href="SysProg/fileio/bad_exclusive_open.c">fileio/bad_exclusive_open.c</a></li>
</ul>
<p>The solution is to combine the <code>O_CREAT</code> and <code>O_EXCL</code> flags in the <code>open</code>.</p>
</section>
<section class="slide level1" id="section-256">
<h1 id="section-256"></h1>
<h4 id="appending-to-the-end-of-a-file">Appending to the End Of A File</h4>
<p>Done in the wrong way this could also fail due to a race condition. The following example shows how it is done correctly: <a href="SysProg/fileio/atomic_append.c">fileio/atomic_append.c</a></p>
</section>
<section class="slide level1" id="section-257">
<h1 id="section-257"></h1>
<h4 id="scattergather-io">Scatter/Gather I/O</h4>
<p>The relevant system calls ar illustrated in this example:</p>
<ul>
<li>[fileio/t_readv.c](SysProg/fileio/t_readv.c]</li>
</ul>
<p>(A similar facility exists for output but has no example program here.)</p>
</section>
<section class="slide level1" id="section-258">
<h1 id="section-258"></h1>
<h4 id="something-to-look-at-later-if-you-have-no-other-ideas-5">Something to look at later (if you have no other ideas)</h4>
<p>Lookup the system call <code>writev</code> in the online manual and modify the last example to demonstrate its basic use.</p>
<p>Also lookup the system calls <code>preadv</code> and <code>pwritev</code> and try to understand what they add to the versions without the leading <code>p</code>.</p>
</section>
<section class="slide level1" id="section-259">
<h1 id="section-259"></h1>
<h4 id="truncating-a-file">Truncating A File</h4>
<p>The system call <code>truncate</code> for doing this is quite easy to understand but nevertheless here is an example: <a href="SysProg/fileio/t_truncate.c">fileio/t_truncate.c</a></p>
</section>
<section class="slide level1" id="section-260">
<h1 id="section-260"></h1>
<h4 id="something-you-might-try-out-later-if-you-have-no-other-ideas">Something you might try out later (if you have no other ideas)</h4>
<p>Lookup the system call <code>writev</code> in the online manual and modify the last example to demonstrate its basic use.</p>
</section>
<section class="slide level1" id="section-261">
<h1 id="section-261"></h1>
<h4 id="anotherthing-to-look-at-later-if-you-have-no-other-ideas">Anotherthing to look at later (if you have no other ideas)</h4>
<p>Also lookup the system calls <code>preadv</code> and <code>pwritev</code> and try to understand what they add to the versions without the leading <code>p</code>.</p>
</section>
<section class="slide level1" id="section-262">
<h1 id="section-262"></h1>
<h4 id="duplicated-file-descriptors-sharing-of-seek-positions">Duplicated File Descriptors / Sharing of Seek-Positions</h4>
<p>The following example (actually the solution to an exercise for TLPI chapter 5) shows how seek positions may be shared between file descriptors:</p>
<ul>
<li><a href="SysProg/fileio/multi_descriptors.c">fileio/multi_descriptors.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-263">
<h1 id="section-263"></h1>
<h4 id="io-bypassing-the-buffer-cache">I/O Bypassing The Buffer Cache</h4>
<p>The following example shows how this may the be achieved:</p>
<ul>
<li><a href="SysProg/filebuff/direct_read.c">filebuff/direct_read.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-264">
<h1 id="section-264"></h1>
<h4 id="displaying-information-about-a-single-file">Displaying Information About a Single File</h4>
<p>The following example prints information that can be obtained with the system call <code>stat</code> and <code>lstat</code>:</p>
<ul>
<li><a href="SysProg/filebuff/direct_read.c">filebuff/direct_read.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-265">
<h1 id="section-265"></h1>
<h4 id="scanning-directories">Scanning Directories</h4>
<p>The interface to scan directories to find the names of the contained files and sub-directories, as constituted by <code>opendir</code>, <code>readdir´ and</code>closedir`, is demonstrated in the following example:</p>
<ul>
<li><a href="SysProg/dir_links/list_files.c">dir_links/list_files.c</a></li>
</ul>
<p><strong>As <code>readdir</code> maintains some internal state (i.e. how far it progressed) it is NOT reentrant and hence should never be used with multi-threading.</strong></p>
<p>The safe replacement is <code>readdir_r</code> (r is for reentrant).</p>
</section>
<section class="slide level1" id="section-266">
<h1 id="section-266"></h1>
<h4 id="walking-the-file-tree-including-sub-directories">Walking The File Tree Including Sub-Directories</h4>
<p>This can be done with <code>nftw</code> which is not directly a system call but a utility function in the library and hence documented in section 3 of the online manual:</p>
<ul>
<li><a href="SysProg/dir_links/nftw_dir_tree.c">dir_links/nftw_dir_tree.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-267">
<h1 id="section-267"></h1>
<h4 id="monitoring-file-events">Monitoring File Events</h4>
<p>This interface was added with the Linux kernel 2.6.25 and allows for a process to wait on certain state changes of a file without consuming CPU time as shown in the following example:</p>
<ul>
<li><a href="SysProg/inotify/demo_inotify.c">inotify/demo_inotify.c</a></li>
</ul>
<p>It actually replaced an older mechanism introduced in kernel version 2.4 (dnotify).</p>
</section>
<section class="slide level1" id="section-268">
<h1 id="section-268"></h1>
<h2 id="process-management">Process Management</h2>
<p>The secure and efficient implementation of the Unix process modell requires a memory management unit:</p>
<ul>
<li>Each process is a unit of code running in its own memory space.</li>
<li>Without the help of system calls memory space of other processes is not accessible .</li>
<li>Available CPUs will be shared among processes on a time slice basis.</li>
</ul>
</section>
<section class="slide level1" id="section-269">
<h1 id="section-269"></h1>
<h3 id="understanding-memory-layout">Understanding Memory Layout</h3>
<p>The following example aims to show some ways of allocating data space in various regions of the main memory:</p>
<ul>
<li><a href="SysProg/proc/mem_segements.c">proc/mem_segements</a></li>
</ul>
</section>
<section class="slide level1" id="section-270">
<h1 id="section-270"></h1>
<h3 id="accessing-command-line-arguments">Accessing Command Line Arguments</h3>
<p>(Only for completeness here as the topic has been handled already in the part about C/C++ programming: <a href="SysProg/proc/necho.c">proc/necho.c</a>.)</p>
</section>
<section class="slide level1" id="section-271">
<h1 id="section-271"></h1>
<h3 id="accessing-and-modifying-the-process-environment">Accessing and Modifying the Process Environment</h3>
<p>The technique to access the process environment - holding exported shell variables - is similar to the technique accessing the command line, as the following example shows:</p>
<ul>
<li><a href="SysProg/proc/display_env.c">proc/display_env.c</a></li>
</ul>
<p>The process environment can also be modified as the following example shows:</p>
<ul>
<li><a href="SysProg/proc/modify_env.c">proc/modify_env.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-272">
<h1 id="section-272"></h1>
<h4 id="something-to-look-at-later-if-you-have-no-other-ideas-6">Something to look at later (if you have no other ideas)</h4>
<p>Find out which standard command does much the same as the last example program does.</p>
<p>Modify the example to call this program via <code>system</code> while executing.</p>
<p>Then change some value in the <code>env</code>-array before the call and watch how the output changes.</p>
<p>But why isn't the change visible in the environment of the original shell, i.e. the one from which the demo program was called?</p>
</section>
<section class="slide level1" id="section-273">
<h1 id="section-273"></h1>
<h4 id="non-local-branches">Non-Local Branches</h4>
<p>This example is only contained for completeness here - in practice there are rare chances to use the technique shown:</p>
<ul>
<li><a href="SysProg/proc/longjmp.c">proc/longjmp.c</a></li>
<li><a href="SysProg/proc/setjmp_vars.c">proc/setjmp_vars.c</a></li>
</ul>
<p><strong>Never ever use <code>setjmp</code> / <code>longjmp</code> in C++ programs in combination with objects having constructors and destructors AS THE EFFECTS WILL BE UNDEFINED.</strong></p>
<p>(Memory leaks are the least to expect, but complete havoc is very likely too ... soon afterwards or also at a much later point in time.)</p>
</section>
<section class="slide level1" id="section-274">
<h1 id="section-274"></h1>
<h4 id="managing-heap-memory-at-the-lowest-level">Managing Heap Memory at the Lowest Level</h4>
<p>An application program usully will and should not have to rely on techniques in this example, shown only for demonstration purposes.</p>
<p><a href="SysProg/memalloc/free_and_sbrk.c">memalloc/free_and_sbrk.c</a></p>
<p>You also may want to refer to the lower left side of this <a href="InfoGraphics/ExecutionModel.png">Info-Graphic</a> once more.)</p>
</section>
<section class="slide level1" id="section-275">
<h1 id="section-275"></h1>
<h4 id="cpu-time-consumed-by-a-process">CPU Time Consumed by a Process</h4>
<p>The following example shows how to access this information:</p>
<p><a href="SysProg/time/process_time.c">time/process_time.c</a></p>
</section>
<section class="slide level1" id="section-276">
<h1 id="section-276"></h1>
<h4 id="retrieving-system-limits-and-options">Retrieving System Limits and Options</h4>
<p>The following examples shows how to access some of this information:</p>
<ul>
<li><a href="SysProg/syslim/t_sysconf.c">syslim/t_sysconf.c</a></li>
<li><a href="SysProg/syslim/t_fpathconf.c">syslim/t_fpathconf.c</a></li>
<li><a href="SysProg/sysinfo/t_uname.c">sysinfo/t_uname.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-277">
<h1 id="section-277"></h1>
<h4 id="creating-a-process">Creating a Process</h4>
<p>Process creation is done with the system call <code>fork</code>.</p>
<p>It clones the memory space of the creating process (aka parent process) as initial execution space of the newly create process.</p>
<ul>
<li>This seems inefficient at first glance as the next step often is to re-load the code memory from an execuable file and re-initialize the data space of the newly created process accordingly.</li>
<li>But it can be made rather efficient by using COW (copy on write) techniques.</li>
</ul>
</section>
<section class="slide level1" id="section-278">
<h1 id="section-278"></h1>
<h4 id="waiting-for-a-process">Waiting for a Process</h4>
<p>Frequently a process has no useful work to do once it created one or more children. Nevertheless it will have to continue to exist so that it can get or gather the result of its child or children.</p>
<ul>
<li>There is a provision to wait for children not consuming any CPU-time.</li>
<li>This should always be used as the preferred way if the creator has no useful things to do.</li>
<li>In addition, a process can be asynchroneously notified by a <em>signal</em> when one of its children terminates execution</li>
</ul>
</section>
<section class="slide level1" id="section-279">
<h1 id="section-279"></h1>
<h3 id="process-management-1">Process Management</h3>
<p>Processes can be sent <em>signals</em> from other processes (not only from their creator).</p>
<ul>
<li>In both, the original and the revised form introduced with Unix System V, signals are an asynchroneous means of communication.</li>
<li>Their main purpose is to terminate the receiver.</li>
<li>Catching a signal in the receiving process was originally only mainly meant to allow for cleanup.</li>
</ul>
<p>A revision of the design of signals introduced with Unix System V signals had the goal to allow for a more flexible and reliable communication between processes.</p>
</section>
<section class="slide level1" id="section-280">
<h1 id="section-280"></h1>
<h4 id="handling-signals">Handling Signals</h4>
<p>The following example shows how a process can arrange for catching a signal sent by some other process:</p>
<ul>
<li><a href="SysProg/signals/ouch.c">signals/ouch.c</a></li>
<li><a href="SysProg/signals/intquit.c">signals/intquit.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-281">
<h1 id="section-281"></h1>
<h4 id="checking-if-a-process-exists">Checking if a Process Exists</h4>
<p>Sending a signal can be used to check if a process (known by its process id or PID) exists, as shown in this example:</p>
<ul>
<li><a href="SysProg/signals/t_kill.c">signals/t_kill.c</a></li>
</ul>
<p>Well, this can be considered as well as a way to &quot;use of signals&quot; but others might say this is at the border of misusing a system call for the wrong purpose.</p>
</section>
<section class="slide level1" id="section-282">
<h1 id="section-282"></h1>
<h4 id="handling-groups-of-signals">Handling Groups of Signals</h4>
<p>System V introduced a new interface on signals based on signal gropus and attempting to add a bit of reliability, so that signals could neither get lost nor inadvertently terminate a process which had arranged to catch a certain (set of) signals.</p>
<p>An example of this problem is here:</p>
<ul>
<li><a href="SysProg/signals/signal_functions.c">signals/signal_functions.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-283">
<h1 id="section-283"></h1>
<h4 id="signal-pitfal-no-queueing">Signal Pitfal: No Queueing</h4>
<p>One common pitfal with signals is that they don't get queued as shown with the combination of the following two examples:</p>
<ul>
<li><a href="SysProg/signals/sig_sender.c">signals/sig_sender.c</a></li>
<li><a href="SysProg/signals/sig_receiver.c">signals/sig_receiver.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-284">
<h1 id="section-284"></h1>
<h4 id="signal-pitfal-no-reentrancy-control">Signal Pitfal: No Reentrancy Control</h4>
<p>The actions allowed in a signal handler are rather limited, so failure to obey them will often no show in rare cases. The following example tries to illustrate:</p>
<ul>
<li><a href="SysProg/signals/nonreentrant.c">signals/nonreentrant.c</a></li>
</ul>
<p><strong>Though the Unix System V and Posix specification name a lot of functions as reentrant, they may still affect the global <code>errno</code> which hence is not reliable in signal handlers.</strong></p>
<p>The conservative approach would be to just set a variable of type <code>sig_atomic_t</code> and test it where convenient after returning from the handler.</p>
</section>
<section class="slide level1" id="section-285">
<h1 id="section-285"></h1>
<h4 id="non-local-branching-from-a-signal-handler">Non-Local Branching From a Signal Handler</h4>
<p>As long as it is clear that C++ (or at least objects with constructors and destructores and hence the largest part of the C++ standard library is ruled out then), also a non local branch out of a signal handler is possible, as the following example shows:</p>
<ul>
<li><a href="SysProg/signals/sigmask_longjmp.c">signals/sigmask_longjmp.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-286">
<h1 id="section-286"></h1>
<h4 id="the-alternate-signal-stack">The Alternate Signal Stack</h4>
<p>Signals thrown when memory is exhausted cause a special problem: they cannot allocate an ordinary stack frame and hence must use an alternate signal stack, as is shown here:</p>
<ul>
<li><a href="SysProg/signals/t_sigaltstack.c">signals/t_sigaltstack.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-287">
<h1 id="section-287"></h1>
<h4 id="realtime-signals-queueable-and-with-additional-information">Realtime Signals: Queueable And With Additional Information</h4>
<p>Another addition to the original signalling mechanism are realtime signals illustrated in this example:</p>
<ul>
<li><a href="SysProg/signals/t_sigqueue.c">signals/t_sigqueue.c</a></li>
<li><a href="SysProg/signals/catch_rtsigs.c">signals/catch_rtsigs.c</a></li>
</ul>
<p>On important use on Linux with timers follows in a later example.</p>
</section>
<section class="slide level1" id="section-288">
<h1 id="section-288"></h1>
<h4 id="suspending-signals-in-time-critical-sections">Suspending Signals in Time-Critical Sections</h4>
<p>As illustrated by this example, signals my temporarily suspended, what means they will not get lost but queued until enabled again:</p>
<ul>
<li><a href="SysProg/signals/t_sigsuspend.c">signals/t_sigsuspend.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-289">
<h1 id="section-289"></h1>
<h4 id="accepting-signals-synchroneously">Accepting Signals Synchroneously</h4>
<p>As an alternative to signal handlers, some applications communicating via signals might get simplified by synchroneous signal delivery, as shown in the following example:</p>
<ul>
<li><a href="SysProg/signals/t_sigwaitinfo.c">signals/t_sigwaitinfo.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-290">
<h1 id="section-290"></h1>
<h4 id="fetching-signals-from-a-special-file-descriptor">Fetching Signals from a Special File Descriptor</h4>
<p>This mechanism was introduce with the Linux kernel 2.6.22 and allows to process delivered signals as if they were read from a file, like the following example shows:</p>
<ul>
<li><a href="SysProg/signals/signalfd_sigval.c">signals/signalfd_sigval.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-291">
<h1 id="section-291"></h1>
<h4 id="realtime-timers">Realtime Timers</h4>
<p>A program centered around signals may have resulted from an event-driven design and as such will frequently require to sent itself a delayed signal.</p>
<p>This is done in the following example:</p>
<ul>
<li><a href="SysProg/timers/real_timer.c">timers/real_timer.c</a></li>
</ul>
<p>Other possible applications are timeout for (synchroneous) <code>read</code>s and sleeping (very) short amounts of time:</p>
<ul>
<li><a href="SysProg/timers/timed_read.c">timers/timed_read.c</a></li>
<li><a href="SysProg/timers/t_nanosleep.c">timers/t_nanosleep.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-292">
<h1 id="section-292"></h1>
<h4 id="posix-clocks-and-interval-timers">POSIX Clocks and Interval Timers</h4>
<p>With the help of a special library also the API <em>Clocks</em> and <em>Interval Timnrs</em> as defined by POSIX is available. Its use is illustrated in the following examples:</p>
<ul>
<li><a href="SysProg/timers/ptmr_sigev_signal.c">timers/ptmr_sigev_signal.c</a></li>
<li><a href="SysProg/timers/itimerspec_from_str.c">timers/itimerspec_from_str.c</a></li>
<li><a href="SysProg/timers/ptmr_sigev_thread.c">timers/ptmr_sigev_thread.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-293">
<h1 id="section-293"></h1>
<h4 id="receiving-timer-notifications-via-file-descriptor">Receiving Timer Notifications via File Descriptor</h4>
<p>Shortly after introducing the facility to receive signal notifications via a special file descriptor, with Linux kernel 2.6.25 this was extended to receiving timer notifications, as shown in the following example:</p>
<ul>
<li><a href="SysProg/timers/demo_timerfd.c">timers/demo_timerfd.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-294">
<h1 id="section-294"></h1>
<h4 id="classic-process-communication">Classic Process Communication</h4>
<p>The classic and only way processes had to communicate with each other were classic files and pipelines.</p>
<ul>
<li>Due to transparent buffering in main memory, communicating via a file were by no means a slow mechanism.</li>
<li>The main advantage of pipelines was the synchronization inherent in the mechanism.</li>
<li>The limitation with classic pipes is that a common ancestor needs to create the pipeline.</li>
</ul>
<p>Later on this limitation was lifted by introducing <em>Named Pipes</em> in Unix System V.</p>
<p>Another abstraction introduced with the BSD variants of Unix were <em>Sockets</em> allowing to send to messages or data streams from one process to another one.</p>
</section>
<section class="slide level1" id="section-295">
<h1 id="section-295"></h1>
<h2 id="processes-creation-and-control">Processes Creation and Control</h2>
<p>Processes and threads both allow for concurrency. Their main difference on Linux is the degree to which they share resources, which ranges</p>
<ul>
<li>from <em>nearly none</em> for two processes</li>
<li>to <em>nearly everything</em> for two threads.</li>
</ul>
<p>While the classic interface to process and thread creation is very different, the system call <code>clone</code> brings both close together.</p>
<p><strong>Especially noteworthy for newcomers to Unix and Linux is that even process creation is not a heavy weight operation as is often assumed by the uninformed.</strong></p>
</section>
<section class="slide level1" id="section-296">
<h1 id="section-296"></h1>
<h3 id="creating-process-with-fork">Creating Process With <code>fork</code></h3>
<p>A sample program illustrating the basic use of <code>fork</code> for process creation is here:</p>
<ul>
<li><a href="SysProg/procexec/t_fork.c">procexec/t_fork.c</a></li>
</ul>
<p>How it is really lightweight can be further studied here:</p>
<ul>
<li><a href="SysProg/procexec/footprint.c">procexec/footprint.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-297">
<h1 id="section-297"></h1>
<h4 id="parentchild-file-sharing">Parent/Child File Sharing</h4>
<p>Though nearly every resource of the parent is decoupled from that of the child, this is not true for open files, for which the same read/write position is advanced:</p>
<ul>
<li><a href="SysProg/procexec/fork_file_sharing.c">procexec/fork_file_sharing.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-298">
<h1 id="section-298"></h1>
<h4 id="even-lighter-as-fork-vfork">Even Lighter as <code>fork</code> : <code>vfork</code></h4>
<p>There is an alternative to fork that avoids copying altogether, though it is not very useful unless it is combined with <code>exec</code> (covered later).</p>
<ul>
<li><a href="SysProg/procexec/t_vfork.c">procexec/t_vfork.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-299">
<h1 id="section-299"></h1>
<h4 id="race-conditions-with-regular-fork">Race Conditions with Regular <code>fork</code></h4>
<p>It should be noted that <code>vfork</code> is only useful because if gives a guarantee that the child runs first, which is not the case for the classic variant:</p>
<ul>
<li><a href="SysProg/procexec/fork_whos_on_first.c">procexec/fork_whos_on_first.c</a></li>
</ul>
<p>This could be avoided by using signals for explicit synchronisation:</p>
<ul>
<li><a href="SysProg/procexec/fork_sig_sync.c">procexec/fork_sig_sync.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-300">
<h1 id="section-300"></h1>
<h4 id="terminating-a-process">Terminating a Process</h4>
<p>Basically this belongs into the category of the most simple system calls as can be clearly seen from the online manual. The difference between the two alternatives <code>exit</code> and <code>_exit</code> can be nicely shown with an example like this one:</p>
<ul>
<li><a href="SysProg/procexec/fork_stdio_buf.c">procexec/fork_stdio_buf.c</a></li>
</ul>
<p>(A program showing the registration of exit handlers is shown here</p>
<ul>
<li><a href="SysProg/procexec/exit_handlers.c">procexec/exit_handlers.c</a></li>
</ul>
<p>is for completeness only, as this is rather a library function standardized in C but a system call, easily to recognized from the documentation of <code>atexit</code> in section 3 not 2 of the online manual.)</p>
<h4 id="waiting-for-a-child-process-to-terminate">Waiting For a Child Process to Terminate</h4>
</section>
<section class="slide level1" id="section-301">
<h1 id="section-301"></h1>
<p>As a parent may have several children for which it is not clear which one will end first, the <code>wait</code> system call takes care of this:</p>
<ul>
<li><a href="SysProg/procexec/multi_wait.c">procexec/multi_wait.c</a></li>
</ul>
<p>An alternative is <code>waitpid</code> which also allows to find out if a child has been temporarily stopped for debugging.</p>
</section>
<section class="slide level1" id="section-302">
<h1 id="section-302"></h1>
<h4 id="accessing-the-childs-exit-status">Accessing the Child's Exit Status</h4>
<p>The value set when a process terminates will be made avaibalbe to the parent:</p>
<ul>
<li><a href="SysProg/procexec/child_status.c">procexec/child_status.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-303">
<h1 id="section-303"></h1>
<h4 id="zombie-processes">Zombie Processes</h4>
<p>If the parent process terminates before the child, the latter is said to become a zombie. The following example demonstrates this:</p>
<ul>
<li><a href="SysProg/procexec/make_zombie.c">procexec/make_zombie.c</a></li>
</ul>
<p>As the responsibility for cleaning up the final process state moves to the initializer - the grand-grand-grand...-father of all processes in the system, it needs to contain a code sequence like in the following example:</p>
<ul>
<li><a href="SysProg/procexec/multi_SIGCHLD.c">procexec/multi_SIDCHLD.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-304">
<h1 id="section-304"></h1>
<h4 id="chaining-to-a-new-executable">Chaining To a New Executable</h4>
<p>Usually the following happens in a child process immediately after it has been <code>fork</code>-ed by its parent:</p>
<ul>
<li><a href="SysProg/procexec/t_execve.c">procexec/t_execve.c</a></li>
<li><a href="SysProg/procexec/envargs.c">procexec/envargs.c</a></li>
<li><a href="SysProg/procexec/t_execlp.c">procexec/t_execlp.c</a></li>
<li><a href="SysProg/procexec/t_execle.c">procexec/t_execle.c</a></li>
<li><a href="SysProg/procexec/t_execl.c">procexec/t_execl.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-305">
<h1 id="section-305"></h1>
<h4 id="file-descriptors-outliving-exec-and-cousins">File Descriptors Outliving <code>exec</code> (and Cousins)</h4>
<p>The default behaviour for open files is that the child can access such files via the file descriptor even after <code>exec</code> (in all its variants). If this is not desired it needs to be explicitely disabled as shown here:</p>
<ul>
<li><a href="SysProg/procexec/closeonexec.c">procexec/closeonexec.c</a></li>
</ul>
<p>(The default behaviour for signal handling is that it is inherited by the child too, but as the handler is no more valid (its code has been replaced) such signals will be reset to default handling, which is program termination in most cases.)</p>
</section>
<section class="slide level1" id="section-306">
<h1 id="section-306"></h1>
<h4 id="simplified-process-execution-with-synchroneous-waiting">Simplified Process Execution with Synchroneous Waiting</h4>
<p>Behind the following, convenient to use library function,</p>
<ul>
<li><a href="SysProg/procexec/t_system.c">procexec/t_system.c</a></li>
</ul>
<p>all the <code>fork</code> - <code>exec</code> - <code>wait</code> - <code>exit</code> machinery is hidden, so a simplified version might look as follows</p>
<ul>
<li><a href="SysProg/procexec/simple_system.c">procexec/simple_system.c</a></li>
</ul>
<p>and here comes the full-blown one:</p>
<ul>
<li><a href="SysProg/procexec/system.c">procexec/system.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-307">
<h1 id="section-307"></h1>
<h4 id="process-accounting">Process Accounting</h4>
<p>Accounting for resources used by a process can be enabled by a priveledged process (presumably before starting one of its children) and later on retrieved:</p>
<ul>
<li><a href="SysProg/procexec/acct_on.c">procexec/acct_on.c</a></li>
<li><a href="SysProg/procexec/acct_view.c">procexec/acct_view.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-308">
<h1 id="section-308"></h1>
<h3 id="bringing-processes-and-threads-close-together">Bringing Processes and Threads Close Together</h3>
<p>This is exactly what the system call <code>clone</code> does, which was originally introduced with <em>Plan 9</em>, a successor of Unix used mostly internally at <em>Bell Labs</em>:</p>
<ul>
<li><a href="SysProg/procexec/t_clone.c">procexec/t_clone.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-309">
<h1 id="section-309"></h1>
<h2 id="multi-threading">Multi-Threading</h2>
<p>The collection of examples is:</p>
<ul>
<li><a href="SysProg/threads/simple_thread.c">threads/simple_thread.c</a></li>
<li><a href="SysProg/threads/detached_attrib.c">threads/detached_attrib.c</a></li>
<li><a href="SysProg/threads/thread_incr.c">threads/thread_incr.c</a></li>
<li><a href="SysProg/threads/thread_incr_mutex.c">threads/thread_incr_mutex.c</a></li>
<li><a href="SysProg/threads/thread_multijoin.c">threads/thread_multijoin.c</a></li>
<li><a href="SysProg/threads/strerror.c">threads/strerror.c</a></li>
<li><a href="SysProg/threads/strerror_test.c">threads/strerror_test.c</a></li>
<li><a href="SysProg/threads/strerror_tsd.c">threads/strerror_tsd.c</a></li>
<li><a href="SysProg/threads/strerror_tls.c">threads/strerror_tls.c</a></li>
<li><a href="SysProg/threads/thread_cancel.c">threads/thread_cancel.c</a></li>
<li><a href="SysProg/threads/thread_cleanup.c">threads/thread_cleanup.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-310">
<h1 id="section-310"></h1>
<h2 id="process-groups-sessions">Process Groups (Sessions)</h2>
<p>The collection of examples is:</p>
<ul>
<li><a href="SysProg/pgsjc/t_setsid.c">pgsjc/t_setsid.c</a></li>
<li><a href="SysProg/pgsjc/catch_SIGHUP.c">pgsjc/catch_SIGHUP.c</a></li>
<li><a href="SysProg/pgsjc/disc_SIGHUP.c">pgsjc/disc_SIGHUP.c</a></li>
<li><a href="SysProg/pgsjc/job_mon.c">pgsjc/job_mon.c</a></li>
<li><a href="SysProg/pgsjc/handling_SIGTSTP.c">pgsjc/handling_SIGTSTP.c</a></li>
<li><a href="SysProg/pgsjc/orphaned_pgrp_SIGHUP.c">pgsjc/orphaned_pgrp_SIGHUP.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-311">
<h1 id="section-311"></h1>
<h2 id="process-priority-and-scheduling">Process Priority and Scheduling</h2>
<ul>
<li><a href="SysProg/procpri/t_setpriority.c">procpri/t_setpriority.c</a></li>
<li><a href="SysProg/procpri/sched_set.c">procpri/sched_set.c</a></li>
<li><a href="SysProg/procpri/sched_view.c">procpri/sched_view.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-312">
<h1 id="section-312"></h1>
<h2 id="process-ressources">Process Ressources</h2>
<ul>
<li><a href="SysProg/procres/print_rlimit.c">procres/print_rlimit.c</a></li>
<li><a href="SysProg/procres/rlimit_nproc.c">procres/rlimit_nproc.c</a></li>
<li><a href="SysProg/procres/t_setpriority.c">procres/t_setpriority.c</a></li>
<li><a href="SysProg/procres/t_setpriority.c">procres/t_setpriority.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-313">
<h1 id="section-313"></h1>
<p>The collection of examples is:</p>
<ul>
<li>Overview of Mechanisms</li>
<li>Overhead involved with Data Exchange</li>
<li>Sender/Receiver Synchronisation</li>
<li>Asynchroneous I/O (poll)</li>
</ul>
</section>
<section class="slide level1" id="section-314">
<h1 id="section-314"></h1>
<h2 id="pipelines">Pipelines</h2>
<p>A basic example looks as follows:</p>
<ul>
<li><a href="SysProg/pipes/simple_pipe.c">pipes/simple_pipe.c</a></li>
</ul>
<p>A nice application of pipes is to use them for process synchronization:</p>
<ul>
<li><a href="SysProg/pipes/pipe_sync.c">pipes/pipe_sync.c</a></li>
</ul>
<p>And this is - more or less - what the shell does if two Unix commands are run together, one filtering the output of the other:</p>
<ul>
<li><a href="SysProg/pipes/pipe_ls_wc.c">pipes/pipe_ls_wc.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-315">
<h1 id="section-315"></h1>
<h3 id="interface-for-c-file-s">Interface for C <code>FILE</code>-s</h3>
<p>For C programs reading input from a <code>FILE</code> or writing output to a <code>FILE</code> there is a simplified interface in form of the library function <code>popen</code>.</p>
<p>The implementation of this function might look similar to the following code:</p>
<ul>
<li><a href="SysProg/pipes/popen_glob.c">pipes/popen_glob.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-316">
<h1 id="section-316"></h1>
<h3 id="named-pipes">Named pipes</h3>
<p>Such relief the restriction that a common ancestor must have prepared the communication path:</p>
<ul>
<li><a href="SysProg/pipes/fifo_seqnum.h">pipes/fifo_seqnum.h</a></li>
<li><a href="SysProg/pipes/fifo_seqnum_server.c">pipes/fifo_seqnum_server.c</a></li>
<li><a href="SysProg/pipes/fifo_seqnum_client.c">pipes/fifo_seqnum_client.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-317">
<h1 id="section-317"></h1>
<h2 id="system-v-ipc">System V IPC</h2>
<ul>
<li><a href="SysProg/svipc/svmsg_demo_server.c">svipc/svmsg_demo_server.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-318">
<h1 id="section-318"></h1>
<h3 id="sysv-message-queues">SysV Message Queues</h3>
<ul>
<li><a href="SysProg/svmsg/svmsg_create.c">svmsg/svmsg_create.c</a></li>
<li><a href="SysProg/svmsg/svmsg_send.c">svmsg/svmsg_send.c</a></li>
<li><a href="SysProg/svmsg/svmsg_receive.c">svmsg/svmsg_receive.c</a></li>
<li><a href="SysProg/svmsg/svmsg_rm.c">svmsg/svmsg_rm.c</a></li>
<li><a href="SysProg/svmsg/svmsg_chqbytes.c">svmsg/svmsg_chqbytes.c</a></li>
<li><p><a href="SysProg/svmsg/svmsg_ls.c">svmsg/svmsg_ls.c</a></p></li>
<li><a href="SysProg/svmsg/svmsg_file.h">svmsg/svmsg_file.h</a></li>
<li><a href="SysProg/svmsg/svmsg_file_server.c">svmsg/svmsg_file_server.c</a></li>
<li><p><a href="SysProg/svmsg/svmsg_file_client.c">svmsg/svmsg_file_client.c</a></p></li>
</ul>
</section>
<section class="slide level1" id="section-319">
<h1 id="section-319"></h1>
<h3 id="sysv-semaphores">SysV Semaphores</h3>
<ul>
<li><p><a href="SysProg/svsem/svsem_demo.c">svshm/svsem_demo.c</a></p></li>
<li><a href="SysProg/svsem/semun.h">svsem/semun.h</a></li>
<li><a href="SysProg/svsem/svsem_mon.c">svsem/svsem_mon.c</a></li>
<li><a href="SysProg/svsem/svsem_setall.c">svsem/svsem_setall.c</a></li>
<li><a href="SysProg/svsem/svsem_bad_init.c">svsem/svsem_bad_init.c</a></li>
<li><a href="SysProg/svsem/svsem_good_init.c">svsem/svsem_good_init.c</a></li>
<li><p><a href="SysProg/svsem/svsem_op.c">svsem/svsem_op.c</a></p></li>
<li><a href="SysProg/svsem/binary_sems.h">svsem/binary_sems.h</a></li>
<li><p><a href="SysProg/svsem/binary_sems.c">svsem/binary_sems.c</a></p></li>
</ul>
<h3 id="shared-memory">Shared Memory</h3>
<ul>
<li><a href="SysProg/svshm/svshm_xfr_writer.c">svshm/svshm_xfr_writer.c</a></li>
<li><a href="SysProg/svshm/svshm_xfr_reader.c">svshm/svshm_xfr_reader.c</a></li>
</ul>
<h2 id="sysv-memory-mapped-io">SysV Memory Mapped I/O</h2>
<ul>
<li><a href="SysProg/mmap/mmcat.c">mmap/mmcat.c</a></li>
<li><a href="SysProg/mmap/t_mmap.c">mmap/t_mmap.c</a></li>
<li><a href="SysProg/mmap/anon_mmap.c">mmap/anon_mmap.c</a></li>
</ul>
<h2 id="virtual-memory-operations">Virtual Memory Operations</h2>
<ul>
<li><a href="SysProg/vmem/t_mprotect.c">vmem/t_mprotect.c</a></li>
<li><a href="SysProg/vmem/memlock.c">vmem/memlock.c</a></li>
</ul>
<h3 id="posix-message-queues">Posix Message Queues</h3>
<ul>
<li><a href="SysProg/pmsg/pmsg_unlink.c">pmsg/pmsg_unlink.c</a></li>
<li><a href="SysProg/pmsg/pmsg_create.c">pmsg/pmsg_create.c</a></li>
<li><a href="SysProg/pmsg/pmsg_getattr.c">pmsg/pmsg_getattr.c</a></li>
<li><a href="SysProg/pmsg/pmsg_send.c">pmsg/pmsg_send.c</a></li>
<li><a href="SysProg/pmsg/pmsg_unlink.c">pmsg/pmsg_receive.c</a></li>
<li><a href="SysProg/pmsg/mq_notify_sig.c">pmsg/mq_notify_sig.c</a></li>
<li><a href="SysProg/pmsg/mq_notify_thread.c">pmsg/mq_notify_thread.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-320">
<h1 id="section-320"></h1>
<h3 id="posix-semaphores">Posix Semaphores</h3>
<ul>
<li><a href="SysProg/psem/psem_create.c">psem/psem_create.c</a></li>
<li><a href="SysProg/psem/psem_unlink.c">psem/psem_unlink.c</a></li>
<li><a href="SysProg/psem/psem_wait.c">psem/psem_wait.c</a></li>
<li><a href="SysProg/psem/psem_post.c">psem/psem_post.c</a></li>
<li><a href="SysProg/psem/psem_getvalue.c">psem/psem_getvalue.c</a></li>
<li><a href="SysProg/psem/thread_incr_sem.c">psem/thread_incr_sem.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-321">
<h1 id="section-321"></h1>
<h3 id="posix-shared-memory">Posix Shared Memory</h3>
<ul>
<li><a href="SysProg/pshm/pshm_create.c">pshm/pshm_create.c</a></li>
<li><a href="SysProg/pshm/pshm_write.c">pshm/pshm_write.c</a></li>
<li><a href="SysProg/pshm/pshm_read.c">pshm/pshm_read.c</a></li>
<li><a href="SysProg/pshm/pshm_unlink.c">pshm/pshm_unlink.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-322">
<h1 id="section-322"></h1>
<h2 id="unix-domain-sockets">Unix Domain Sockets</h2>
<ul>
<li><a href="SysProg/sockets/us_xfr.h">sockets/us_xfr.h</a></li>
<li><a href="SysProg/sockets/us_xfr_sv.c">sockets/us_xfr_sv.c</a></li>
<li><p><a href="SysProg/sockets/us_xfr_cl.c">sockets/us_xfr_cl.c</a></p></li>
<li><a href="SysProg/sockets/ud_ucase.h">sockets/ud_ucase.h</a></li>
<li><a href="SysProg/sockets/ud_ucase_sv.c">sockets/ud_ucase_sv.c</a></li>
<li><p><a href="SysProg/sockets/ud_ucase_cl.c">sockets/ud_ucase_cl.c</a></p></li>
<li><p><a href="SysProg/sockets/us_abstract_bind.c">sockets/us_abstract_bind.c</a></p></li>
</ul>
</section>
<section class="slide level1" id="section-323">
<h1 id="section-323"></h1>
<h2 id="internet-sockets">Internet Sockets</h2>
<ul>
<li><p><a href="SysProg/sockets/read_line.c">sockets/read_line.c</a></p></li>
<li><a href="SysProg/sockets/i6d_ucase.h">sockets/i6d_ucase.h</a></li>
<li><a href="SysProg/sockets/i6d_ucase_sv.c">sockets/i6d_ucase_sv.c</a></li>
<li><p><a href="SysProg/sockets/i6d_ucase_cl.c">sockets/i6d_ucase_cl.c</a></p></li>
<li><a href="SysProg/sockets/is_seqnum.h">sockets/is_seqnum.h</a></li>
<li><a href="SysProg/sockets/is_seqnum_sv.c">sockets/is_seqnum_sv.c</a></li>
<li><p><a href="SysProg/sockets/is_seqnum_cl.c">sockets/is_seqnum_cl.c</a></p></li>
<li><a href="SysProg/sockets/inet_sockets.h">sockets/inet_sockets.h</a></li>
<li><p><a href="SysProg/sockets/inet_sockets.c">sockets/inet_sockets.c</a></p></li>
<li><p><a href="SysProg/sockets/t_gethostbyname.c">sockets/t_gethostbyname.c</a></p></li>
</ul>
</section>
<section class="slide level1" id="section-324">
<h1 id="section-324"></h1>
<h2 id="sockets-server-design">Sockets Server Design</h2>
<ul>
<li><a href="SysProg/sockets/id_echo.h">sockets/id_echo.h</a></li>
<li><a href="SysProg/sockets/id_echo_sv.c">sockets/id_echo_sv.c</a></li>
<li><p><a href="SysProg/sockets/id_echo_cl.c">sockets/id_echo_cl.c</a></p></li>
<li><a href="SysProg/sockets/is_echo.h">sockets/is_echo.h</a></li>
<li><a href="SysProg/sockets/is_echo_sv.c">sockets/is_echo_sv.c</a></li>
<li><p><a href="SysProg/sockets/is_echo_cl.c">sockets/is_echo_cl.c</a></p></li>
<li><p><a href="SysProg/sockets/is_echo_inetd_sv.c">sockets/is_echo_inetd_sv.c</a></p></li>
<li><p><a href="SysProg/sockets/rdwrn.c">sockets/rdwrn.c</a></p></li>
<li><p><a href="SysProg/sockets/is_echo_cl.c">sockets/is_echo_cl.c</a></p></li>
<li><p><a href="SysProg/sockets/socknames.c">sockets/socknames.c</a></p></li>
</ul>
</section>
<section class="slide level1" id="section-325">
<h1 id="section-325"></h1>
<h2 id="alternative-io-modells">Alternative I/O Modells</h2>
</section>
<section class="slide level1" id="section-326">
<h1 id="section-326"></h1>
<h3 id="multiplexing">Multiplexing</h3>
<ul>
<li><a href="SysProg/altio/t_select.c">altio/t_select.c</a></li>
<li><a href="SysProg/altio/poll_pipes.c">altio/poll_pipes.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-327">
<h1 id="section-327"></h1>
<h3 id="signal-driven">Signal-Driven</h3>
<ul>
<li><a href="SysProg/altio/demo_sigio.c">altio/demo_sigio.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-328">
<h1 id="section-328"></h1>
<h3 id="linux-specific-epoll">Linux specific <code>epoll</code></h3>
</section>
<section class="slide level1" id="section-329">
<h1 id="section-329"></h1>
<ul>
<li><a href="SysProg/altio/epoll_input.c">altio/epoll_input.c</a></li>
<li><a href="SysProg/altio/self_pipe.c">altio/epoll_input.c</a></li>
</ul>
</section>
<section class="slide level1" id="section-330">
<h1 id="section-330"></h1>
<h2 id="goodbye">Goodbye</h2>
</section>
<!-- {{{{ dzslides core
#
#
#     __  __  __       .  __   ___  __
#    |  \  / /__` |    | |  \ |__  /__`
#    |__/ /_ .__/ |___ | |__/ |___ .__/ core :€
#
#
# The following block of code is not supposed to be edited.
# But if you want to change the behavior of these slides,
# feel free to hack it!
#
-->

<!-- Default Style -->
<style>
  * { margin: 0; padding: 0; }
  details { display: none; }
  body {
    width: 800px; height: 600px;
    margin-left: -400px; margin-top: -300px;
    position: absolute; top: 50%; left: 50%;
    overflow: hidden;
  }
  section {
    position: absolute;
    pointer-events: none;
    width: 100%; height: 100%;
  }
  section[aria-selected] { pointer-events: auto; }
  html { overflow: hidden; }
  body { display: none; }
  body.loaded { display: block; }
  .incremental {visibility: hidden; }
  .incremental[active] {visibility: visible; }
</style>

<script>
  var Dz = {
    remoteWindows: [],
    idx: -1,
    step: 0,
    slides: null,
    params: {
      autoplay: "1"
    }
  };

  Dz.init = function() {
    document.body.className = "loaded";
    this.slides = $$("body > section");
    this.setupParams();
    this.onhashchange();
    this.setupTouchEvents();
    this.onresize();
  }
  
  Dz.setupParams = function() {
    var p = window.location.search.substr(1).split('&');
    p.forEach(function(e, i, a) {
      var keyVal = e.split('=');
      Dz.params[keyVal[0]] = decodeURIComponent(keyVal[1]);
    });
  }

  Dz.onkeydown = function(aEvent) {
    // Don't intercept keyboard shortcuts
    if (aEvent.altKey
      || aEvent.ctrlKey
      || aEvent.metaKey
      || aEvent.shiftKey) {
      return;
    }
    if ( aEvent.keyCode == 37 // left arrow
      || aEvent.keyCode == 38 // up arrow
      || aEvent.keyCode == 33 // page up
    ) {
      aEvent.preventDefault();
      this.back();
    }
    if ( aEvent.keyCode == 39 // right arrow
      || aEvent.keyCode == 40 // down arrow
      || aEvent.keyCode == 34 // page down
    ) {
      aEvent.preventDefault();
      this.forward();
    }
    if (aEvent.keyCode == 35) { // end
      aEvent.preventDefault();
      this.goEnd();
    }
    if (aEvent.keyCode == 36) { // home
      aEvent.preventDefault();
      this.goStart();
    }
    if (aEvent.keyCode == 32) { // space
      aEvent.preventDefault();
      this.toggleContent();
    }
  }

  /* Touch Events */

  Dz.setupTouchEvents = function() {
    var orgX, newX;
    var tracking = false;

    var db = document.body;
    db.addEventListener("touchstart", start.bind(this), false);
    db.addEventListener("touchmove", move.bind(this), false);

    function start(aEvent) {
      aEvent.preventDefault();
      tracking = true;
      orgX = aEvent.changedTouches[0].pageX;
    }

    function move(aEvent) {
      if (!tracking) return;
      newX = aEvent.changedTouches[0].pageX;
      if (orgX - newX > 100) {
        tracking = false;
        this.forward();
      } else {
        if (orgX - newX < -100) {
          tracking = false;
          this.back();
        }
      }
    }
  }

  /* Adapt the size of the slides to the window */

  Dz.onresize = function() {
    var db = document.body;
    var sx = db.clientWidth / window.innerWidth;
    var sy = db.clientHeight / window.innerHeight;
    var transform = "scale(" + (1/Math.max(sx, sy)) + ")";

    db.style.MozTransform = transform;
    db.style.WebkitTransform = transform;
    db.style.OTransform = transform;
    db.style.msTransform = transform;
    db.style.transform = transform;
  }


  Dz.getDetails = function(aIdx) {
    var s = $("section:nth-of-type(" + aIdx + ")");
    var d = s.$("details");
    return d ? d.innerHTML : "";
  }

  Dz.onmessage = function(aEvent) {
    var argv = aEvent.data.split(" "), argc = argv.length;
    argv.forEach(function(e, i, a) { a[i] = decodeURIComponent(e) });
    var win = aEvent.source;
    if (argv[0] === "REGISTER" && argc === 1) {
      this.remoteWindows.push(win);
      this.postMsg(win, "REGISTERED", document.title, this.slides.length);
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
      return;
    }
    if (argv[0] === "BACK" && argc === 1)
      this.back();
    if (argv[0] === "FORWARD" && argc === 1)
      this.forward();
    if (argv[0] === "START" && argc === 1)
      this.goStart();
    if (argv[0] === "END" && argc === 1)
      this.goEnd();
    if (argv[0] === "TOGGLE_CONTENT" && argc === 1)
      this.toggleContent();
    if (argv[0] === "SET_CURSOR" && argc === 2)
      window.location.hash = "#" + argv[1];
    if (argv[0] === "GET_CURSOR" && argc === 1)
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
    if (argv[0] === "GET_NOTES" && argc === 1)
      this.postMsg(win, "NOTES", this.getDetails(this.idx));
  }

  Dz.toggleContent = function() {
    // If a Video is present in this new slide, play it.
    // If a Video is present in the previous slide, stop it.
    var s = $("section[aria-selected]");
    if (s) {
      var video = s.$("video");
      if (video) {
        if (video.ended || video.paused) {
          video.play();
        } else {
          video.pause();
        }
      }
    }
  }

  Dz.setCursor = function(aIdx, aStep) {
    // If the user change the slide number in the URL bar, jump
    // to this slide.
    aStep = (aStep != 0 && typeof aStep !== "undefined") ? "." + aStep : ".0";
    window.location.hash = "#" + aIdx + aStep;
  }

  Dz.onhashchange = function() {
    var cursor = window.location.hash.split("#"),
        newidx = 1,
        newstep = 0;
    if (cursor.length == 2) {
      newidx = ~~cursor[1].split(".")[0];
      newstep = ~~cursor[1].split(".")[1];
      if (newstep > Dz.slides[newidx - 1].$$('.incremental > *').length) {
        newstep = 0;
        newidx++;
      }
    }
    if (newidx != this.idx) {
      this.setSlide(newidx);
    }
    if (newstep != this.step) {
      this.setIncremental(newstep);
    }
    for (var i = 0; i < this.remoteWindows.length; i++) {
      this.postMsg(this.remoteWindows[i], "CURSOR", this.idx + "." + this.step);
    }
  }

  Dz.back = function() {
    if (this.idx == 1 && this.step == 0) {
      return;
    }
    if (this.step == 0) {
      this.setCursor(this.idx - 1,
                     this.slides[this.idx - 2].$$('.incremental > *').length);
    } else {
      this.setCursor(this.idx, this.step - 1);
    }
  }

  Dz.forward = function() {
    if (this.idx >= this.slides.length &&
        this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
        return;
    }
    if (this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
      this.setCursor(this.idx + 1, 0);
    } else {
      this.setCursor(this.idx, this.step + 1);
    }
  }

  Dz.goStart = function() {
    this.setCursor(1, 0);
  }

  Dz.goEnd = function() {
    var lastIdx = this.slides.length;
    var lastStep = this.slides[lastIdx - 1].$$('.incremental > *').length;
    this.setCursor(lastIdx, lastStep);
  }

  Dz.setSlide = function(aIdx) {
    this.idx = aIdx;
    var old = $("section[aria-selected]");
    var next = $("section:nth-of-type("+ this.idx +")");
    if (old) {
      old.removeAttribute("aria-selected");
      var video = old.$("video");
      if (video) {
        video.pause();
      }
    }
    if (next) {
      next.setAttribute("aria-selected", "true");
      var video = next.$("video");
      if (video && !!+this.params.autoplay) {
        video.play();
      }
    } else {
      // That should not happen
      this.idx = -1;
      // console.warn("Slide doesn't exist.");
    }
  }

  Dz.setIncremental = function(aStep) {
    this.step = aStep;
    var old = this.slides[this.idx - 1].$('.incremental > *[aria-selected]');
    if (old) {
      old.removeAttribute('aria-selected');
    }
    var incrementals = this.slides[this.idx - 1].$$('.incremental');
    if (this.step <= 0) {
      incrementals.forEach(function(aNode) {
        aNode.removeAttribute('active');
      });
      return;
    }
    var next = this.slides[this.idx - 1].$$('.incremental > *')[this.step - 1];
    if (next) {
      next.setAttribute('aria-selected', true);
      next.parentNode.setAttribute('active', true);
      var found = false;
      incrementals.forEach(function(aNode) {
        if (aNode != next.parentNode)
          if (found)
            aNode.removeAttribute('active');
          else
            aNode.setAttribute('active', true);
        else
          found = true;
      });
    } else {
      setCursor(this.idx, 0);
    }
    return next;
  }
  
  Dz.postMsg = function(aWin, aMsg) { // [arg0, [arg1...]]
    aMsg = [aMsg];
    for (var i = 2; i < arguments.length; i++)
      aMsg.push(encodeURIComponent(arguments[i]));
    aWin.postMessage(aMsg.join(" "), "*");
  }

  window.onload = Dz.init.bind(Dz);
  window.onkeydown = Dz.onkeydown.bind(Dz);
  window.onresize = Dz.onresize.bind(Dz);
  window.onhashchange = Dz.onhashchange.bind(Dz);
  window.onmessage = Dz.onmessage.bind(Dz);
</script>


<script> // Helpers
  if (!Function.prototype.bind) {
    Function.prototype.bind = function (oThis) {

      // closest thing possible to the ECMAScript 5 internal IsCallable
      // function 
      if (typeof this !== "function")
      throw new TypeError(
        "Function.prototype.bind - what is trying to be fBound is not callable"
      );

      var aArgs = Array.prototype.slice.call(arguments, 1),
          fToBind = this,
          fNOP = function () {},
          fBound = function () {
            return fToBind.apply( this instanceof fNOP ? this : oThis || window,
                   aArgs.concat(Array.prototype.slice.call(arguments)));
          };

      fNOP.prototype = this.prototype;
      fBound.prototype = new fNOP();

      return fBound;
    };
  }

  var $ = (HTMLElement.prototype.$ = function(aQuery) {
    return this.querySelector(aQuery);
  }).bind(document);

  var $$ = (HTMLElement.prototype.$$ = function(aQuery) {
    return this.querySelectorAll(aQuery);
  }).bind(document);

  NodeList.prototype.forEach = function(fun) {
    if (typeof fun !== "function") throw new TypeError();
    for (var i = 0; i < this.length; i++) {
      fun.call(this, this[i]);
    }
  }

</script>
<!-- vim: set fdm=marker: }}} -->
</body>
</html>
